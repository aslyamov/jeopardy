{
  "version": 3,
  "sources": ["../src/router.ts", "auto-packs:~packs", "../src/storage.ts", "../src/state.ts", "../src/utils.ts", "../src/modal.ts", "../src/screens/home.ts", "../src/screens/setup.ts", "../src/screens/game-board.ts", "../node_modules/chessground/src/types.ts", "../node_modules/chessground/src/util.ts", "../node_modules/chessground/src/premove.ts", "../node_modules/chessground/src/board.ts", "../node_modules/chessground/src/fen.ts", "../node_modules/chessground/src/config.ts", "../node_modules/chessground/src/anim.ts", "../node_modules/chessground/src/draw.ts", "../node_modules/chessground/src/drag.ts", "../node_modules/chessground/src/explosion.ts", "../node_modules/chessground/src/api.ts", "../node_modules/chessground/src/state.ts", "../node_modules/chessground/src/svg.ts", "../node_modules/chessground/src/wrap.ts", "../node_modules/chessground/src/drop.ts", "../node_modules/chessground/src/events.ts", "../node_modules/chessground/src/render.ts", "../node_modules/chessground/src/sync.ts", "../node_modules/chessground/src/autoPieces.ts", "../node_modules/chessground/src/chessground.ts", "../node_modules/chess.js/src/pgn.js", "../node_modules/src/chess.ts", "../src/chessboard.ts", "../src/screens/question.ts", "../src/screens/results.ts", "../src/screens/editor.ts", "../src/main.ts"],
  "sourcesContent": ["import { ScreenName } from './types';\n\ntype Renderer = (el: HTMLElement) => void;\n\nlet _root: HTMLElement;\nconst _renderers: Partial<Record<ScreenName, Renderer>> = {};\n\nexport function initRouter(root: HTMLElement, renderers: Record<ScreenName, Renderer>): void {\n  _root = root;\n  Object.assign(_renderers, renderers);\n}\n\nexport function navigate(screen: ScreenName): void {\n  _root.innerHTML = '';\n  const render = _renderers[screen];\n  if (render) render(_root);\n}\n", "export const BUILTIN_PACKS = [{\"title\":\"\u041C\u0438\u0442\u0442\u0435\u043B\u044C\u0448\u043F\u0438\u043B\u044C\",\"categories\":[{\"name\":\"\u0411\u043E\u0440\u044C\u0431\u0430 \u0437\u0430 \u0446\u0435\u043D\u0442\u0440\",\"questions\":[{\"value\":100,\"question\":\"\u041A\u0430\u043A\u043E\u0439 \u043A\u043E\u043D\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u0435\u0435 \u0438 \u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0443 \u043D\u0435\u0433\u043E \u0445\u043E\u0434\u043E\u0432?\",\"answer\":\"\u0427\u0435\u0440\u043D\u044B\u0439 \u043A\u043E\u043D\u044C. \u0423 \u043D\u0435\u0433\u043E 8 \u0445\u043E\u0434\u043E\u0432.\",\"fen\":\"8/8/8/3n4/8/8/8/6N1 w - - 0 1\"},{\"value\":200,\"question\":\"\u041A\u0430\u043A\u043E\u0439 \u043A\u043E\u043D\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u0435\u0435 \u0438 \u043F\u043E\u0447\u0435\u043C\u0443?\",\"answer\":\"\u0411\u0435\u043B\u044B\u0439 \u043A\u043E\u043D\u044C, \u043E\u043D \u0441\u0442\u043E\u0438\u0442 \u0431\u043B\u0438\u0436\u0435 \u043A \u0446\u0435\u043D\u0442\u0440\u0443.\",\"fen\":\"1k6/ppp5/n7/8/8/5N2/5PPP/6K1 w - - 0 1\"},{\"value\":300,\"question\":\"\u041A\u0442\u043E \u0432\u043B\u0430\u0434\u0435\u0435\u0442 \u0446\u0435\u043D\u0442\u0440\u043E\u043C?\",\"answer\":\"\u0411\u0435\u043B\u044B\u0435, \u0438\u0445 \u043F\u0435\u0448\u043A\u0438 \u0437\u0430\u043D\u044F\u043B\u0438 \u0446\u0435\u043D\u0442\u0440.\",\"fen\":\"rnbqkbnr/ppp2ppp/3pp3/8/3PP3/8/PPP2PPP/RNBQKBNR w KQkq - 0 3\"},{\"value\":400,\"question\":\"\u0423\u0441\u0438\u043B\u044C \u0441\u0432\u043E\u0435\u0433\u043E \u0431\u0435\u043B\u043E\u0433\u043E \u043A\u043E\u043D\u044F, \u043F\u0435\u0440\u0435\u0432\u0435\u0434\u044F \u0435\u0433\u043E \u0432 \u0446\u0435\u043D\u0442\u0440\",\"answer\":\"\u041Af1-e3-d5\",\"fen\":\"6k1/p5pp/np3p2/2p1p3/2P1P3/1P3P2/P5PP/1K3N2 w - - 0 1\"},{\"value\":500,\"question\":\"\u0423\u0441\u0438\u043B\u044C \u0441\u0432\u043E\u0435\u0433\u043E \u0431\u0435\u043B\u043E\u0433\u043E \u0441\u043B\u043E\u043D\u0430, \u043F\u0435\u0440\u0435\u0432\u0435\u0434\u044F \u0435\u0433\u043E \u0432 \u0446\u0435\u043D\u0442\u0440\",\"answer\":\"\u0421a3-c1-f4-e5\",\"fen\":\"2k5/ppp4p/4p1p1/3p1n2/3P3P/BPP3P1/P5K1/8 w - - 0 1\"}]},{\"name\":\"\u041E\u0442\u043A\u0440\u044B\u0442\u044B\u0435 \u043B\u0438\u043D\u0438\u0438\",\"questions\":[{\"value\":100,\"question\":\"\u041D\u0430\u0439\u0434\u0438 \u043E\u0442\u043A\u0440\u044B\u0442\u0443\u044E \u043B\u0438\u043D\u0438\u044E\",\"answer\":\"\u041B\u0438\u043D\u0438\u044F b\",\"fen\":\"2kr4/2p3p1/3p1p1p/p2p4/8/3P1P1P/P1PKP1P1/7R w - - 0 1\"},{\"value\":200,\"question\":\"\u041A\u0442\u043E \u0432\u043B\u0430\u0434\u0435\u0435\u0442 \u043E\u0442\u043A\u0440\u044B\u0442\u043E\u0439 \u043B\u0438\u043D\u0438\u0435\u0439?\",\"answer\":\"\u0427\u0435\u0440\u043D\u044B\u0435, \u043B\u0438\u043D\u0438\u044F F.\",\"fen\":\"5rk1/5rpp/p3p3/3pP3/2pP4/2P5/P5PP/R2R2K1 w - - 0 1\"},{\"value\":300,\"question\":\"\u0415\u0441\u0442\u044C \u043B\u0438 \u0437\u0434\u0435\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u0430\u044F \u043B\u0438\u043D\u0438\u044F?\",\"answer\":\"\u0414\u0430, \u043B\u0438\u043D\u0438\u044F d.\",\"fen\":\"4r1k1/pp3p1p/2p1p1p1/4P3/3B1P2/P1P3P1/1P4KP/8 w - - 0 1\"},{\"value\":400,\"question\":\"\u0413\u0434\u0435 \u0441\u043A\u043E\u0440\u043E \u043F\u043E\u044F\u0432\u0438\u0442\u0441\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0430\u044F \u043B\u0438\u043D\u0438\u044F? \u041A\u0430\u043A \u0431\u0435\u043B\u044B\u043C \u043F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u0438\u0442\u044C\u0441\u044F \u043A \u044D\u0442\u043E\u043C\u0443?\",\"answer\":\"\u0424h1!\",\"fen\":\"1kq4r/p6r/Pp3p1p/1Pp1pPp1/2PpP1PP/3P3R/1K5R/3Q4 w - - 0 1\"},{\"value\":500,\"question\":\"\u0413\u0434\u0435 \u0441\u043A\u043E\u0440\u043E \u043F\u043E\u044F\u0432\u0438\u0442\u0441\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0430\u044F \u043B\u0438\u043D\u0438\u044F? \u041A\u0430\u043A \u043F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u0438\u0442\u044C\u0441\u044F \u043A \u044D\u0442\u043E\u043C\u0443?\",\"answer\":\"\u041B\u0438\u043D\u0438\u044F a. \u041D\u0430\u0434\u043E \u0442\u044F\u0436\u0435\u043B\u044B\u0435 \u0431\u0435\u043B\u044B\u0435 \u0444\u0438\u0433\u0443\u0440\u044B \u043F\u0435\u0440\u0435\u043C\u0435\u0441\u0442\u0438\u0442\u044C \u043D\u0430 \u043B\u0438\u043D\u0438\u044E \u0430. \u041B\u0430\u0434\u044C\u0438 \u0432\u043F\u0435\u0440\u0435\u0434\u0438, \u0444\u0435\u0440\u0437\u044C \u043F\u043E\u0437\u0430\u0434\u0438.\",\"fen\":\"2qrr1k1/p3p3/1p1p1p2/PPpP2p1/2P1P1Pp/5P1P/6K1/3RRQ2 w - - 0 1\"}]},{\"name\":\"\u041F\u0435\u0448\u0435\u0447\u043D\u044B\u0435 \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u0438\",\"questions\":[{\"value\":100,\"question\":\"\u0415\u0441\u0442\u044C \u043B\u0438 \u0437\u0434\u0435\u0441\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0430\u044F \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?\",\"answer\":\"\u0414\u0430, \u043F\u0435\u0448\u043A\u0438 c7 \u0438 c6, \u0441\u0434\u0432\u043E\u0435\u043D\u043D\u044B\u0435.\",\"fen\":\"r1bqkb1r/ppp2ppp/2p2n2/4p3/4P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 5\"},{\"value\":200,\"question\":\"\u0415\u0441\u0442\u044C \u043B\u0438 \u0437\u0434\u0435\u0441\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0430\u044F \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?\",\"answer\":\"\u0414\u0430, \u043F\u0435\u0448\u043A\u0430 \u043D\u0430 e4 - \u0438\u0437\u043E\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F.\",\"fen\":\"6k1/p5p1/1p3p2/2p1p3/4P3/8/PPP3PP/6K1 w - - 0 1\"},{\"value\":300,\"question\":\"\u041D\u0430\u0437\u043E\u0432\u0438 \u0432\u0441\u0435 \u043F\u0435\u0448\u0435\u0447\u043D\u044B\u0435 \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u0438\",\"answer\":\"\u041F\u0435\u0448\u043A\u0438 a3 \u0438 e2 - \u043E\u0442\u0441\u0442\u0430\u043B\u044B\u0435, \u043F\u0435\u0448\u043A\u0438 f4 \u0438 d6 - \u0438\u0437\u043E\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0435, \u043F\u0435\u0448\u043A\u0438 b5 \u0438 b6 - \u0441\u0434\u0432\u043E\u0435\u043D\u043D\u044B\u0435.\",\"fen\":\"6k1/8/1p1p4/1p6/1P3p2/P4P2/4P3/6K1 w - - 0 1\"},{\"value\":400,\"question\":\"\u041A\u0430\u043A \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0443\u044E \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?\",\"answer\":\"\u0421f6:g5\",\"fen\":\"rnb2rk1/ppq2ppp/2pbpn2/3p2B1/2PP4/2NBPN2/PP3PPP/R2QK2R w KQ - 3 8\"},{\"value\":500,\"question\":\"\u041A\u0430\u043A \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0443\u044E \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?\",\"answer\":\"b4!\",\"fen\":\"8/p4k2/8/1p6/8/1P6/P7/7K w - - 0 1\"}]},{\"name\":\"\u0421\u043B\u0430\u0431\u044B\u0435 \u043F\u043E\u043B\u044F\",\"questions\":[{\"value\":100,\"question\":\"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435? \u041A\u0430\u043A \u0435\u0433\u043E \u0437\u0430\u043D\u044F\u0442\u044C?\",\"answer\":\"\u041Ab3-c5\",\"fen\":\"4b1k1/8/p1p3p1/Pp1p1pPp/1P1PpP1P/1N2P3/6K1/8 w - - 0 1\"},{\"value\":200,\"question\":\"\u041A\u0430\u043A \u0437\u0430\u043D\u044F\u0442\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435?\",\"answer\":\"\u041Bc8-f8-f4\",\"fen\":\"1kr4r/ppp5/3p3p/3Pp1pP/4P3/5P2/PPP5/1KR4R w - - 0 1\"},{\"value\":300,\"question\":\"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435? \u041A\u0430\u043A \u0435\u0433\u043E \u0437\u0430\u043D\u044F\u0442\u044C?\",\"answer\":\"e6. \u041A\u0440e2-f3, \u041Bf1-\u04351, \u041Be1-e6\",\"fen\":\"6kr/p5pp/Pp1p1p2/1PpP1P2/2P2P2/6P1/4K2P/5R2 w - - 0 1\"},{\"value\":400,\"question\":\"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u044B\u0435 \u043F\u043E\u043B\u044F? \u041A\u0430\u043A \u0438\u0445 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C?\",\"answer\":\"b2 \u0438 a3. \u0421b4-a3, \u0433\u0440\u043E\u0437\u0438\u0442 \u043C\u0430\u0442!\",\"fen\":\"r1b2rk1/1p3p1p/p3pqp1/2p5/1bP1QNPP/1P2P3/P1B2P2/1K4RR b - - 0 14\"},{\"value\":500,\"question\":\"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435? \u041A\u0430\u043A \u0435\u0433\u043E \u0437\u0430\u043D\u044F\u0442\u044C?\",\"answer\":\"e5. \u041Ab1-d2-f3-e5.\",\"fen\":\"r3rnk1/pp1b2pp/2p4q/3p1p2/3P1P2/P1NBP3/1P3QPP/4RRK1 w - - 0 1\"}]}]}];", "import { GameState, SaveSlot, Pack } from './types';\n\nconst SAVES_KEY  = 'jeopardy_saves';\nconst PACKS_KEY  = 'jeopardy_packs';\n\n// \u2500\u2500 Pack storage \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadStoredPacks(): Pack[] {\n  try {\n    const raw = localStorage.getItem(PACKS_KEY);\n    return raw ? (JSON.parse(raw) as Pack[]) : [];\n  } catch { return []; }\n}\n\nexport function saveStoredPacks(packs: Pack[]): void {\n  localStorage.setItem(PACKS_KEY, JSON.stringify(packs));\n}\n\nexport function upsertStoredPack(pack: Pack, idx?: number): void {\n  const all = loadStoredPacks();\n  if (idx !== undefined && idx >= 0) all[idx] = pack; else all.push(pack);\n  saveStoredPacks(all);\n}\n\nexport function deleteStoredPack(idx: number): void {\n  const all = loadStoredPacks();\n  all.splice(idx, 1);\n  saveStoredPacks(all);\n}\n\n// \u2500\u2500 Serialization (Set \u2192 array and back) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ninterface RawState {\n  id: string;\n  pack: GameState['pack'];\n  players: GameState['players'];\n  timerSecs: number;\n  answered: string[];\n}\n\ninterface RawSlot {\n  id: string;\n  name: string;\n  savedAt: number;\n  state: RawState;\n}\n\nfunction toRaw(g: GameState): RawState {\n  return {\n    id: g.id,\n    pack: g.pack,\n    players: g.players,\n    timerSecs: g.timerSecs,\n    answered: [...g.answered],\n  };\n}\n\nfunction fromRaw(r: RawState): GameState {\n  return {\n    id: r.id,\n    pack: r.pack,\n    players: r.players,\n    timerSecs: r.timerSecs,\n    answered: new Set(r.answered),\n    cur: null,\n  };\n}\n\n// \u2500\u2500 Public API \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadSaves(): SaveSlot[] {\n  try {\n    const raw = localStorage.getItem(SAVES_KEY);\n    if (!raw) return [];\n    return (JSON.parse(raw) as RawSlot[]).map(s => ({ ...s, state: fromRaw(s.state) }));\n  } catch {\n    return [];\n  }\n}\n\nexport function upsertSave(slot: SaveSlot): void {\n  const saves = loadSaves();\n  const idx = saves.findIndex(s => s.id === slot.id);\n  const raw: RawSlot = {\n    id: slot.id, name: slot.name, savedAt: slot.savedAt, state: toRaw(slot.state),\n  };\n  const raws = saves.map(s => ({\n    id: s.id, name: s.name, savedAt: s.savedAt, state: toRaw(s.state),\n  }));\n  if (idx >= 0) raws[idx] = raw; else raws.push(raw);\n  localStorage.setItem(SAVES_KEY, JSON.stringify(raws));\n}\n\nexport function deleteSave(id: string): void {\n  const saves = loadSaves().filter(s => s.id !== id);\n  localStorage.setItem(SAVES_KEY, JSON.stringify(\n    saves.map(s => ({ id: s.id, name: s.name, savedAt: s.savedAt, state: toRaw(s.state) }))\n  ));\n}\n\n/** Convenience wrapper \u2014 save/update the current game. */\nexport function saveGame(game: GameState): void {\n  const playerNames = game.players.map(p => p.name).join(', ');\n  upsertSave({\n    id: game.id,\n    name: `${game.pack.title} \u00B7 ${playerNames}`,\n    savedAt: Date.now(),\n    state: game,\n  });\n}\n", "import { Pack, GameState } from './types';\nimport { BUILTIN_PACKS } from './data';\nimport { loadStoredPacks } from './storage';\n\nexport const packs: Pack[] = [...BUILTIN_PACKS, ...loadStoredPacks()];\nexport const BUILTIN_PACK_COUNT = BUILTIN_PACKS.length;\n\nexport let selectedPackIdx = 0;\nexport let setupPlayers: string[] = ['\u0418\u0433\u0440\u043E\u043A 1', '\u0418\u0433\u0440\u043E\u043A 2'];\nexport let setupTimerSecs = 0;\nexport let game: GameState | null = null;\n\nexport function setSelectedPackIdx(i: number): void { selectedPackIdx = i; }\nexport function setSetupPlayers(p: string[]): void { setupPlayers = p; }\nexport function setSetupTimerSecs(s: number): void { setupTimerSecs = s; }\nexport function setGame(g: GameState | null): void { game = g; }\nexport function addPack(p: Pack): void { packs.push(p); }\n\n/** Sync the in-memory packs array with localStorage (call before setup renders). */\nexport function refreshPacks(): void {\n  packs.splice(0, packs.length, ...BUILTIN_PACKS, ...loadStoredPacks());\n}\n", "export function escHtml(s: string | number): string {\n  return String(s)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\n/** Allow only http/https image URLs to prevent javascript: injection. */\nexport function sanitizeImageUrl(url: string): string {\n  const trimmed = url.trim();\n  if (!trimmed) return '';\n  try {\n    const parsed = new URL(trimmed);\n    if (parsed.protocol === 'http:' || parsed.protocol === 'https:') return trimmed;\n  } catch {}\n  return '';\n}\n", "/**\n * Beautiful custom modals \u2014 replaces system alert() / confirm()\n */\n\nconst BASE_OVERLAY =\n  'fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 px-4';\nconst BASE_PANEL =\n  'bg-gray-900 border border-gray-700 rounded-2xl p-6 w-full shadow-2xl space-y-5';\n\nfunction createOverlay(): HTMLDivElement {\n  const el = document.createElement('div');\n  el.className = BASE_OVERLAY;\n  return el;\n}\n\n// \u2500\u2500 Alert \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nexport function showAlert(msg: string, onClose?: () => void): void {\n  const overlay = createOverlay();\n  overlay.innerHTML = `\n    <div class=\"${BASE_PANEL}\" style=\"max-width:380px\">\n      <p class=\"text-center text-white text-base leading-relaxed\">${msg}</p>\n      <button id=\"modal-ok\"\n        class=\"w-full py-2.5 bg-blue-600 hover:bg-blue-500 rounded-xl border-0 text-white\n               font-bold cursor-pointer transition-colors\">\n        \u041E\u041A\n      </button>\n    </div>\n  `;\n  document.body.appendChild(overlay);\n\n  const close = () => { overlay.remove(); onClose?.(); };\n  overlay.querySelector('#modal-ok')!.addEventListener('click', close);\n  overlay.addEventListener('click', e => { if (e.target === overlay) close(); });\n}\n\n// \u2500\u2500 Confirm \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nexport function showConfirm(\n  msg: string,\n  onConfirm: () => void,\n  options?: { confirmLabel?: string; confirmClass?: string },\n): void {\n  const overlay = createOverlay();\n  const confirmLabel = options?.confirmLabel ?? '\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C';\n  const confirmCls   = options?.confirmClass\n    ?? 'bg-red-600 hover:bg-red-500';\n\n  overlay.innerHTML = `\n    <div class=\"${BASE_PANEL}\" style=\"max-width:380px\">\n      <p class=\"text-center text-white text-base leading-relaxed\">${msg}</p>\n      <div class=\"flex gap-3\">\n        <button id=\"modal-cancel\"\n          class=\"flex-1 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-xl border-0 text-white\n                 cursor-pointer transition-colors\">\n          \u041E\u0442\u043C\u0435\u043D\u0430\n        </button>\n        <button id=\"modal-confirm\"\n          class=\"flex-1 py-2.5 ${confirmCls} rounded-xl border-0 text-white font-bold\n                 cursor-pointer transition-colors\">\n          ${confirmLabel}\n        </button>\n      </div>\n    </div>\n  `;\n  document.body.appendChild(overlay);\n\n  const close = () => overlay.remove();\n  overlay.querySelector('#modal-cancel')!.addEventListener('click', close);\n  overlay.querySelector('#modal-confirm')!.addEventListener('click', () => {\n    close();\n    onConfirm();\n  });\n  overlay.addEventListener('click', e => { if (e.target === overlay) close(); });\n}\n", "import { navigate } from '../router';\nimport { setGame } from '../state';\nimport { loadSaves, deleteSave } from '../storage';\nimport { escHtml } from '../utils';\nimport { showConfirm } from '../modal';\n\nexport function render(container: HTMLElement): void {\n  const saves = loadSaves().sort((a, b) => b.savedAt - a.savedAt);\n\n  container.innerHTML = `\n    <div class=\"flex flex-col items-center justify-center min-h-screen gap-4 p-8\">\n      <h1 class=\"font-black text-yellow-400 text-center tracking-wider\"\n          style=\"font-size:clamp(3rem,12vw,6rem);line-height:1\">\n        \u0421\u0412\u041E\u042F \u0418\u0413\u0420\u0410\n      </h1>\n      <p class=\"text-gray-500 text-lg\" style=\"margin-bottom:16px\">\n        \u0421\u043E\u0437\u0434\u0430\u0432\u0430\u0439 \u0432\u043E\u043F\u0440\u043E\u0441\u044B. \u0418\u0433\u0440\u0430\u0439 \u0441 \u0434\u0440\u0443\u0437\u044C\u044F\u043C\u0438.\n      </p>\n\n      <div class=\"flex flex-col gap-3 w-full max-w-xs\">\n        <button id=\"btn-new\"\n          class=\"py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-lg\n                 transition-colors cursor-pointer border-0 text-white\">\n          \u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430\n        </button>\n\n        ${saves.length > 0 ? `\n          <button id=\"btn-continue\"\n            class=\"py-4 bg-emerald-600 hover:bg-emerald-500 rounded-xl font-bold text-lg\n                   transition-colors cursor-pointer border-0 text-white\">\n            \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C\n          </button>\n        ` : ''}\n\n        <button id=\"btn-editor\"\n          class=\"py-4 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold text-lg\n                 transition-colors cursor-pointer border-0 text-white\">\n          \u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432\n        </button>\n      </div>\n    </div>\n  `;\n\n  container.querySelector<HTMLButtonElement>('#btn-new')!.onclick = () => navigate('setup');\n  container.querySelector<HTMLButtonElement>('#btn-editor')!.onclick = () => navigate('editor');\n\n  container.querySelector<HTMLButtonElement>('#btn-continue')?.addEventListener('click', () => {\n    showSavePicker(container, saves);\n  });\n}\n\n// \u2500\u2500 Save picker modal \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction showSavePicker(\n  container: HTMLElement,\n  saves: ReturnType<typeof loadSaves>,\n): void {\n  document.getElementById('save-picker-modal')?.remove();\n\n  const modal = document.createElement('div');\n  modal.id = 'save-picker-modal';\n  modal.className =\n    'fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4';\n\n  modal.innerHTML = `\n    <div class=\"bg-gray-900 border border-gray-700 rounded-2xl p-6 w-full shadow-2xl space-y-4\"\n         style=\"max-width:420px\">\n      <h3 class=\"text-xl font-bold text-center\">\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0433\u0440\u0443</h3>\n      <div class=\"space-y-2\" style=\"max-height:18rem;overflow-y:auto\">\n        ${saves.map(s => `\n          <div class=\"bg-gray-800 rounded-xl p-4 flex items-center gap-3\">\n            <div class=\"min-w-0 flex-1\">\n              <div class=\"font-bold text-sm truncate\">${escHtml(s.name)}</div>\n              <div class=\"text-xs text-gray-400\">${formatDate(s.savedAt)}</div>\n            </div>\n            <div class=\"flex gap-2 shrink-0\">\n              <button data-resume=\"${escHtml(s.id)}\"\n                class=\"bg-emerald-600 hover:bg-emerald-500 px-3 py-1.5 rounded-lg text-sm\n                       font-bold transition-colors border-0 cursor-pointer text-white\">\u25B6</button>\n              <button data-del=\"${escHtml(s.id)}\"\n                class=\"bg-red-700/80 hover:bg-red-600 px-3 py-1.5 rounded-lg text-sm\n                       transition-colors border-0 cursor-pointer text-white\">\u2715</button>\n            </div>\n          </div>\n        `).join('')}\n      </div>\n      <button id=\"picker-close\"\n        class=\"w-full py-2.5 bg-gray-700 hover:bg-gray-600 rounded-xl text-sm\n               transition-colors border-0 cursor-pointer text-white\">\n        \u0417\u0430\u043A\u0440\u044B\u0442\u044C\n      </button>\n    </div>\n  `;\n\n  document.body.appendChild(modal);\n\n  // Resume\n  modal.querySelectorAll<HTMLButtonElement>('[data-resume]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const id = btn.dataset.resume!;\n      const slot = loadSaves().find(s => s.id === id);\n      if (!slot) return;\n      closePicker();\n      setGame(slot.state);\n      navigate('game-board');\n    });\n  });\n\n  // Delete\n  modal.querySelectorAll<HTMLButtonElement>('[data-del]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const id = btn.dataset.del!;\n      showConfirm('\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435?', () => {\n        deleteSave(id);\n        closePicker();\n        render(container);\n      }, { confirmLabel: '\u0423\u0434\u0430\u043B\u0438\u0442\u044C' });\n    });\n  });\n\n  document.getElementById('picker-close')?.addEventListener('click', closePicker);\n  modal.addEventListener('click', e => { if (e.target === modal) closePicker(); });\n}\n\nfunction closePicker(): void {\n  document.getElementById('save-picker-modal')?.remove();\n}\n\nfunction formatDate(ms: number): string {\n  return new Date(ms).toLocaleString('ru-RU', {\n    day: '2-digit', month: '2-digit', year: 'numeric',\n    hour: '2-digit', minute: '2-digit',\n  });\n}\n", "import { navigate } from '../router';\nimport {\n  packs, setupPlayers, setupTimerSecs, selectedPackIdx,\n  setSelectedPackIdx, setSetupPlayers, setSetupTimerSecs, setGame, addPack,\n  refreshPacks,\n} from '../state';\nimport { showAlert } from '../modal';\nimport { saveGame } from '../storage';\nimport { GameState, Pack } from '../types';\nimport { escHtml } from '../utils';\n\nlet localPlayers: string[] = [];\n\nexport function render(container: HTMLElement): void {\n  refreshPacks();\n  localPlayers = [...setupPlayers];\n  buildShell(container);\n  rebuildPlayersList(container);\n  attachEvents(container);\n}\n\nfunction buildShell(container: HTMLElement): void {\n  container.innerHTML = `\n    <div class=\"min-h-screen flex flex-col justify-center py-6 px-8\" style=\"max-width:480px;margin:0 auto\">\n      <div class=\"flex justify-between items-center mb-8\">\n        <h2 class=\"text-2xl font-bold\">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0438\u0433\u0440\u044B</h2>\n        <button id=\"btn-back\"\n          class=\"text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer text-base\">\n          \u2190 \u041D\u0430\u0437\u0430\u0434\n        </button>\n      </div>\n\n      <div class=\"mb-6\">\n        <label class=\"block text-gray-400 text-sm mb-2\">\u041D\u0430\u0431\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</label>\n        <div class=\"flex gap-2\">\n          <select id=\"pack-select\"\n            class=\"flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white cursor-pointer\">\n            ${packs.map((p, i) => `\n              <option value=\"${i}\" ${i === selectedPackIdx ? 'selected' : ''}>\n                ${escHtml(p.title)} (${p.categories.length} \u043A\u0430\u0442.)\n              </option>\n            `).join('')}\n          </select>\n          <button id=\"btn-import\"\n            class=\"px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg border-0 text-white\n                   cursor-pointer text-sm whitespace-nowrap\">\n            \u0418\u043C\u043F\u043E\u0440\u0442\n          </button>\n          <input type=\"file\" id=\"file-input\" accept=\".json\" class=\"hidden\">\n        </div>\n      </div>\n\n      <div class=\"mb-6\">\n        <label class=\"block text-gray-400 text-sm mb-2\">\u0418\u0433\u0440\u043E\u043A\u0438</label>\n        <div id=\"players-list\" class=\"flex flex-col gap-2 mb-2\"></div>\n        <button id=\"btn-add-player\"\n          class=\"text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer text-sm\">\n          + \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0438\u0433\u0440\u043E\u043A\u0430\n        </button>\n      </div>\n\n      <div class=\"mb-8\">\n        <label class=\"block text-gray-400 text-sm mb-2\">\n          \u0422\u0430\u0439\u043C\u0435\u0440 \u043D\u0430 \u0432\u043E\u043F\u0440\u043E\u0441 (\u0441\u0435\u043A), 0 = \u0431\u0435\u0437 \u0442\u0430\u0439\u043C\u0435\u0440\u0430\n        </label>\n        <input type=\"number\" id=\"timer-input\" value=\"${setupTimerSecs}\" min=\"0\" max=\"600\" step=\"5\"\n          class=\"w-24 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white\">\n      </div>\n\n      <button id=\"btn-start\"\n        class=\"w-full py-4 bg-green-600 hover:bg-green-700 rounded-xl font-bold text-lg\n               border-0 text-white cursor-pointer transition-colors\">\n        \u041D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443\n      </button>\n    </div>\n  `;\n}\n\nfunction rebuildPlayersList(container: HTMLElement): void {\n  const list = container.querySelector<HTMLElement>('#players-list')!;\n  list.innerHTML = localPlayers.map((name, i) => `\n    <div class=\"flex gap-2 items-center\">\n      <input type=\"text\" value=\"${escHtml(name)}\" data-idx=\"${i}\"\n        class=\"flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white\">\n      <button class=\"btn-remove text-red-400 bg-transparent border-0 cursor-pointer\n                     text-xl px-2 hover:text-red-300\" data-idx=\"${i}\">\u2715</button>\n    </div>\n  `).join('');\n\n  list.querySelectorAll<HTMLInputElement>('input').forEach(inp => {\n    inp.oninput = () => { localPlayers[Number(inp.dataset.idx)] = inp.value; };\n  });\n\n  list.querySelectorAll<HTMLButtonElement>('.btn-remove').forEach(btn => {\n    btn.onclick = () => {\n      if (localPlayers.length <= 1) return;\n      syncPlayersFromInputs(container);\n      localPlayers.splice(Number(btn.dataset.idx), 1);\n      rebuildPlayersList(container);\n    };\n  });\n}\n\nfunction syncPlayersFromInputs(container: HTMLElement): void {\n  container.querySelectorAll<HTMLInputElement>('#players-list input').forEach((inp, i) => {\n    localPlayers[i] = inp.value.trim() || `\u0418\u0433\u0440\u043E\u043A ${i + 1}`;\n  });\n}\n\nfunction attachEvents(container: HTMLElement): void {\n  container.querySelector('#btn-back')!.addEventListener('click', () => navigate('home'));\n\n  container.querySelector('#btn-import')!.addEventListener('click', () => {\n    container.querySelector<HTMLInputElement>('#file-input')!.click();\n  });\n\n  container.querySelector<HTMLInputElement>('#file-input')!.addEventListener('change', e => {\n    const file = (e.target as HTMLInputElement).files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      try {\n        const pack = JSON.parse(reader.result as string) as Pack;\n        if (!pack.title || !Array.isArray(pack.categories))\n          throw new Error('\u041D\u0435\u0442 \u043F\u043E\u043B\u0435\u0439 \"title\" \u0438\u043B\u0438 \"categories\"');\n        addPack(pack);\n        setSelectedPackIdx(packs.length - 1);\n        showAlert(`\u041D\u0430\u0431\u043E\u0440 \u00AB${pack.title}\u00BB \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D!`, () => render(container));\n      } catch (err) {\n        showAlert('\u041E\u0448\u0438\u0431\u043A\u0430 JSON: ' + (err as Error).message);\n      }\n    };\n    reader.readAsText(file);\n    (e.target as HTMLInputElement).value = '';\n  });\n\n  container.querySelector('#btn-add-player')!.addEventListener('click', () => {\n    syncPlayersFromInputs(container);\n    localPlayers.push(`\u0418\u0433\u0440\u043E\u043A ${localPlayers.length + 1}`);\n    rebuildPlayersList(container);\n  });\n\n  container.querySelector('#btn-start')!.addEventListener('click', () => {\n    syncPlayersFromInputs(container);\n    const packIdx = Number(container.querySelector<HTMLSelectElement>('#pack-select')!.value);\n    const timerSecs = Number(container.querySelector<HTMLInputElement>('#timer-input')!.value) || 0;\n\n    setSelectedPackIdx(packIdx);\n    setSetupPlayers([...localPlayers]);\n    setSetupTimerSecs(timerSecs);\n\n    const pack = packs[packIdx];\n    const players = localPlayers.map(p => ({ name: p.trim() || '\u0418\u0433\u0440\u043E\u043A', score: 0 }));\n\n    const newGame: GameState = {\n      id: Date.now().toString(),\n      pack,\n      players,\n      timerSecs,\n      answered: new Set(),\n      cur: null,\n    };\n    setGame(newGame);\n    saveGame(newGame);\n    navigate('game-board');\n  });\n}\n", "import { navigate } from '../router';\nimport { game } from '../state';\nimport { escHtml } from '../utils';\nimport { showConfirm } from '../modal';\n\nexport function render(container: HTMLElement): void {\n  if (!game) { navigate('home'); return; }\n\n  container.innerHTML = `\n    <div class=\"min-h-screen flex flex-col justify-center py-4 px-4 w-full\"\n         style=\"max-width:1280px;margin:0 auto\">\n\n      <div class=\"flex items-center justify-between mb-3\">\n        <h1 class=\"text-xl font-bold\">\u0421\u0432\u043E\u044F \u0418\u0433\u0440\u0430</h1>\n        <div class=\"flex gap-2 items-center\">\n          <button id=\"btn-finish\"\n            class=\"px-3 py-1.5 bg-red-600/80 hover:bg-red-500 rounded-lg border-0\n                   text-white text-xs cursor-pointer transition-colors\">\n            \u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C\n          </button>\n          <button id=\"btn-home\"\n            class=\"text-gray-400 hover:text-white bg-transparent border-0 cursor-pointer text-xs\">\n            \u2190 \u0413\u043B\u0430\u0432\u043D\u0430\u044F\n          </button>\n        </div>\n      </div>\n\n      <div id=\"board-grid\" class=\"gboard w-full\"></div>\n\n      <div id=\"scores-bar\" class=\"mt-3 flex justify-center flex-wrap gap-3\"></div>\n    </div>\n  `;\n\n  buildGrid(container);\n  renderScores(container);\n\n  container.querySelector('#btn-finish')!.addEventListener('click', () => navigate('results'));\n  container.querySelector('#btn-home')!.addEventListener('click', () => {\n    showConfirm('\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u043D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E?<br><span class=\"text-gray-400 text-sm\">\u041F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D.</span>', () => navigate('home'), {\n      confirmLabel: '\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E',\n      confirmClass: 'bg-blue-600 hover:bg-blue-500',\n    });\n  });\n}\n\nfunction buildGrid(container: HTMLElement): void {\n  const g = game!;\n  const cats = g.pack.categories;\n\n  const allVals = [...new Set(cats.flatMap(c => c.questions.map(q => q.value)))].sort((a, b) => a - b);\n\n  const grid = container.querySelector<HTMLElement>('#board-grid')!;\n  grid.style.gridTemplateColumns = `minmax(160px,260px) ${allVals.map(() => 'minmax(0,1fr)').join(' ')}`;\n\n  cats.forEach((cat, catIdx) => {\n    const catCell = document.createElement('div');\n    catCell.className = 'cat-cell';\n    catCell.textContent = cat.name;\n    grid.appendChild(catCell);\n\n    allVals.forEach(val => {\n      const qIdx = cat.questions.findIndex(q => q.value === val);\n      const cell = document.createElement('div');\n\n      if (qIdx === -1) {\n        cell.className = 'val-cell done';\n      } else {\n        const key = `${catIdx}-${qIdx}`;\n        const done = g.answered.has(key);\n        cell.className = 'val-cell' + (done ? ' done' : '');\n        if (!done) {\n          cell.textContent = String(val);\n          cell.addEventListener('click', () => {\n            g.cur = { catIdx, qIdx };\n            navigate('question');\n          });\n        }\n      }\n      grid.appendChild(cell);\n    });\n  });\n}\n\nexport function renderScores(container: HTMLElement): void {\n  const bar = container.querySelector<HTMLElement>('#scores-bar')!;\n  bar.innerHTML = game!.players.map(p => `\n    <div class=\"score-card\">\n      <div class=\"sc-name\">${escHtml(p.name)}</div>\n      <div class=\"sc-val\">${p.score}</div>\n    </div>\n  `).join('');\n}\n", "export type Color = (typeof colors)[number];\nexport type Role = (typeof roles)[number];\nexport type File = (typeof files)[number];\nexport type Rank = (typeof ranks)[number];\nexport type Key = 'a0' | `${File}${Rank}`;\nexport type FEN = string;\nexport type Pos = [number, number];\nexport interface Piece {\n  role: Role;\n  color: Color;\n  promoted?: boolean;\n}\nexport interface Drop {\n  role: Role;\n  key: Key;\n}\nexport type Pieces = Map<Key, Piece>;\nexport type PiecesDiff = Map<Key, Piece | undefined>;\n\nexport type KeyPair = [Key, Key];\n\nexport type NumberPair = [number, number];\n\nexport type NumberQuad = [number, number, number, number];\n\nexport interface Rect {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n}\n\nexport type Dests = Map<Key, Key[]>;\n\nexport interface Elements {\n  board: HTMLElement;\n  wrap: HTMLElement;\n  container: HTMLElement;\n  ghost?: HTMLElement;\n  svg?: SVGElement;\n  customSvg?: SVGElement;\n  autoPieces?: HTMLElement;\n}\nexport interface Dom {\n  elements: Elements;\n  bounds: Memo<DOMRectReadOnly>;\n  redraw: () => void;\n  redrawNow: (skipSvg?: boolean) => void;\n  unbind?: Unbind;\n  destroyed?: boolean;\n}\nexport interface Exploding {\n  stage: number;\n  keys: readonly Key[];\n}\n\nexport interface MoveMetadata {\n  premove: boolean;\n  ctrlKey?: boolean;\n  holdTime?: number;\n  captured?: Piece;\n  predrop?: boolean;\n}\nexport interface SetPremoveMetadata {\n  ctrlKey?: boolean;\n}\n\nexport type MouchEvent = Event & Partial<MouseEvent & TouchEvent>;\n\nexport interface KeyedNode extends HTMLElement {\n  cgKey: Key;\n}\nexport interface PieceNode extends KeyedNode {\n  tagName: 'PIECE';\n  cgPiece: string;\n  cgAnimating?: boolean;\n  cgFading?: boolean;\n  cgDragging?: boolean;\n  cgScale?: number;\n}\nexport interface SquareNode extends KeyedNode {\n  tagName: 'SQUARE';\n}\n\nexport interface Memo<A> {\n  (): A;\n  clear: () => void;\n}\n\nexport interface Timer {\n  start: () => void;\n  cancel: () => void;\n  stop: () => number;\n}\n\nexport type Redraw = () => void;\nexport type Unbind = () => void;\nexport type Milliseconds = number;\nexport type KHz = number;\n\nexport const colors = ['white', 'black'] as const;\nexport const roles = ['pawn', 'knight', 'bishop', 'rook', 'queen', 'king'] as const;\nexport const files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'] as const;\nexport const ranks = ['1', '2', '3', '4', '5', '6', '7', '8'] as const;\n\nexport type RanksPosition = 'left' | 'right';\n\nexport type BrushColor = 'green' | 'red' | 'blue' | 'yellow';\n\nexport type SquareClasses = Map<Key, string>;\n", "import * as cg from './types.js';\n\nexport const invRanks: readonly cg.Rank[] = [...cg.ranks].reverse();\n\nexport const allKeys: readonly cg.Key[] = Array.prototype.concat(\n  ...cg.files.map(c => cg.ranks.map(r => c + r)),\n);\n\nexport const pos2key = (pos: cg.Pos): cg.Key => allKeys[8 * pos[0] + pos[1]];\n\nexport const key2pos = (k: cg.Key): cg.Pos => [k.charCodeAt(0) - 97, k.charCodeAt(1) - 49];\n\nexport const uciToMove = (uci: string | undefined): cg.Key[] | undefined => {\n  if (!uci) return undefined;\n  if (uci[1] === '@') return [uci.slice(2, 4) as cg.Key];\n  return [uci.slice(0, 2), uci.slice(2, 4)] as cg.Key[];\n};\n\nexport const allPos: readonly cg.Pos[] = allKeys.map(key2pos);\n\nexport function memo<A>(f: () => A): cg.Memo<A> {\n  let v: A | undefined;\n  const ret = (): A => {\n    if (v === undefined) v = f();\n    return v;\n  };\n  ret.clear = () => {\n    v = undefined;\n  };\n  return ret;\n}\n\nexport const timer = (): cg.Timer => {\n  let startAt: number | undefined;\n  return {\n    start() {\n      startAt = performance.now();\n    },\n    cancel() {\n      startAt = undefined;\n    },\n    stop() {\n      if (!startAt) return 0;\n      const time = performance.now() - startAt;\n      startAt = undefined;\n      return time;\n    },\n  };\n};\n\nexport const opposite = (c: cg.Color): cg.Color => (c === 'white' ? 'black' : 'white');\n\nexport const distanceSq = (pos1: cg.Pos, pos2: cg.Pos): number => {\n  const dx = pos1[0] - pos2[0],\n    dy = pos1[1] - pos2[1];\n  return dx * dx + dy * dy;\n};\n\nexport const samePiece = (p1: cg.Piece, p2: cg.Piece): boolean =>\n  p1.role === p2.role && p1.color === p2.color;\n\nexport const posToTranslate =\n  (bounds: DOMRectReadOnly): ((pos: cg.Pos, asWhite: boolean) => cg.NumberPair) =>\n  (pos, asWhite) => [\n    ((asWhite ? pos[0] : 7 - pos[0]) * bounds.width) / 8,\n    ((asWhite ? 7 - pos[1] : pos[1]) * bounds.height) / 8,\n  ];\n\nexport const translate = (el: HTMLElement, pos: cg.NumberPair): void => {\n  el.style.transform = `translate(${pos[0]}px,${pos[1]}px)`;\n};\n\nexport const translateAndScale = (el: HTMLElement, pos: cg.NumberPair, scale = 1): void => {\n  el.style.transform = `translate(${pos[0]}px,${pos[1]}px) scale(${scale})`;\n};\n\nexport const setVisible = (el: HTMLElement, v: boolean): void => {\n  el.style.visibility = v ? 'visible' : 'hidden';\n};\n\nexport const eventPosition = (e: cg.MouchEvent): cg.NumberPair | undefined => {\n  if (e.clientX || e.clientX === 0) return [e.clientX, e.clientY!];\n  if (e.targetTouches?.[0]) return [e.targetTouches[0].clientX, e.targetTouches[0].clientY];\n  return; // touchend has no position!\n};\n\nexport const isRightButton = (e: cg.MouchEvent): boolean => e.button === 2;\n\nexport const createEl = (tagName: string, className?: string): HTMLElement => {\n  const el = document.createElement(tagName);\n  if (className) el.className = className;\n  return el;\n};\n\nexport function computeSquareCenter(key: cg.Key, asWhite: boolean, bounds: DOMRectReadOnly): cg.NumberPair {\n  const pos = key2pos(key);\n  if (!asWhite) {\n    pos[0] = 7 - pos[0];\n    pos[1] = 7 - pos[1];\n  }\n  return [\n    bounds.left + (bounds.width * pos[0]) / 8 + bounds.width / 16,\n    bounds.top + (bounds.height * (7 - pos[1])) / 8 + bounds.height / 16,\n  ];\n}\n", "import * as util from './util.js';\nimport * as cg from './types.js';\n\ntype Mobility = (x1: number, y1: number, x2: number, y2: number) => boolean;\n\nconst diff = (a: number, b: number): number => Math.abs(a - b);\n\nconst pawn =\n  (color: cg.Color): Mobility =>\n  (x1, y1, x2, y2) =>\n    diff(x1, x2) < 2 &&\n    (color === 'white'\n      ? // allow 2 squares from first two ranks, for horde\n        y2 === y1 + 1 || (y1 <= 1 && y2 === y1 + 2 && x1 === x2)\n      : y2 === y1 - 1 || (y1 >= 6 && y2 === y1 - 2 && x1 === x2));\n\nexport const knight: Mobility = (x1, y1, x2, y2) => {\n  const xd = diff(x1, x2);\n  const yd = diff(y1, y2);\n  return (xd === 1 && yd === 2) || (xd === 2 && yd === 1);\n};\n\nconst bishop: Mobility = (x1, y1, x2, y2) => {\n  return diff(x1, x2) === diff(y1, y2);\n};\n\nconst rook: Mobility = (x1, y1, x2, y2) => {\n  return x1 === x2 || y1 === y2;\n};\n\nexport const queen: Mobility = (x1, y1, x2, y2) => {\n  return bishop(x1, y1, x2, y2) || rook(x1, y1, x2, y2);\n};\n\nconst king =\n  (color: cg.Color, rookFiles: number[], canCastle: boolean): Mobility =>\n  (x1, y1, x2, y2) =>\n    (diff(x1, x2) < 2 && diff(y1, y2) < 2) ||\n    (canCastle &&\n      y1 === y2 &&\n      y1 === (color === 'white' ? 0 : 7) &&\n      ((x1 === 4 && ((x2 === 2 && rookFiles.includes(0)) || (x2 === 6 && rookFiles.includes(7)))) ||\n        rookFiles.includes(x2)));\n\nfunction rookFilesOf(pieces: cg.Pieces, color: cg.Color) {\n  const backrank = color === 'white' ? '1' : '8';\n  const files = [];\n  for (const [key, piece] of pieces) {\n    if (key[1] === backrank && piece.color === color && piece.role === 'rook') {\n      files.push(util.key2pos(key)[0]);\n    }\n  }\n  return files;\n}\n\nexport function premove(pieces: cg.Pieces, key: cg.Key, canCastle: boolean): cg.Key[] {\n  const piece = pieces.get(key);\n  if (!piece) return [];\n  const pos = util.key2pos(key),\n    r = piece.role,\n    mobility: Mobility =\n      r === 'pawn'\n        ? pawn(piece.color)\n        : r === 'knight'\n          ? knight\n          : r === 'bishop'\n            ? bishop\n            : r === 'rook'\n              ? rook\n              : r === 'queen'\n                ? queen\n                : king(piece.color, rookFilesOf(pieces, piece.color), canCastle);\n  return util.allPos\n    .filter(pos2 => (pos[0] !== pos2[0] || pos[1] !== pos2[1]) && mobility(pos[0], pos[1], pos2[0], pos2[1]))\n    .map(util.pos2key);\n}\n", "import { HeadlessState } from './state.js';\nimport { pos2key, key2pos, opposite, distanceSq, allPos, computeSquareCenter } from './util.js';\nimport { premove, queen, knight } from './premove.js';\nimport * as cg from './types.js';\n\nexport function callUserFunction<T extends (...args: any[]) => void>(\n  f: T | undefined,\n  ...args: Parameters<T>\n): void {\n  if (f) setTimeout(() => f(...args), 1);\n}\n\nexport function toggleOrientation(state: HeadlessState): void {\n  state.orientation = opposite(state.orientation);\n  state.animation.current = state.draggable.current = state.selected = undefined;\n}\n\nexport function reset(state: HeadlessState): void {\n  state.lastMove = undefined;\n  unselect(state);\n  unsetPremove(state);\n  unsetPredrop(state);\n}\n\nexport function setPieces(state: HeadlessState, pieces: cg.PiecesDiff): void {\n  for (const [key, piece] of pieces) {\n    if (piece) state.pieces.set(key, piece);\n    else state.pieces.delete(key);\n  }\n}\n\nexport function setCheck(state: HeadlessState, color: cg.Color | boolean): void {\n  state.check = undefined;\n  if (color === true) color = state.turnColor;\n  if (color)\n    for (const [k, p] of state.pieces) {\n      if (p.role === 'king' && p.color === color) {\n        state.check = k;\n      }\n    }\n}\n\nfunction setPremove(state: HeadlessState, orig: cg.Key, dest: cg.Key, meta: cg.SetPremoveMetadata): void {\n  unsetPredrop(state);\n  state.premovable.current = [orig, dest];\n  callUserFunction(state.premovable.events.set, orig, dest, meta);\n}\n\nexport function unsetPremove(state: HeadlessState): void {\n  if (state.premovable.current) {\n    state.premovable.current = undefined;\n    callUserFunction(state.premovable.events.unset);\n  }\n}\n\nfunction setPredrop(state: HeadlessState, role: cg.Role, key: cg.Key): void {\n  unsetPremove(state);\n  state.predroppable.current = { role, key };\n  callUserFunction(state.predroppable.events.set, role, key);\n}\n\nexport function unsetPredrop(state: HeadlessState): void {\n  const pd = state.predroppable;\n  if (pd.current) {\n    pd.current = undefined;\n    callUserFunction(pd.events.unset);\n  }\n}\n\nfunction tryAutoCastle(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  if (!state.autoCastle) return false;\n\n  const king = state.pieces.get(orig);\n  if (!king || king.role !== 'king') return false;\n\n  const origPos = key2pos(orig);\n  const destPos = key2pos(dest);\n  if ((origPos[1] !== 0 && origPos[1] !== 7) || origPos[1] !== destPos[1]) return false;\n  if (origPos[0] === 4 && !state.pieces.has(dest)) {\n    if (destPos[0] === 6) dest = pos2key([7, destPos[1]]);\n    else if (destPos[0] === 2) dest = pos2key([0, destPos[1]]);\n  }\n  const rook = state.pieces.get(dest);\n  if (!rook || rook.color !== king.color || rook.role !== 'rook') return false;\n\n  state.pieces.delete(orig);\n  state.pieces.delete(dest);\n\n  if (origPos[0] < destPos[0]) {\n    state.pieces.set(pos2key([6, destPos[1]]), king);\n    state.pieces.set(pos2key([5, destPos[1]]), rook);\n  } else {\n    state.pieces.set(pos2key([2, destPos[1]]), king);\n    state.pieces.set(pos2key([3, destPos[1]]), rook);\n  }\n  return true;\n}\n\nexport function baseMove(state: HeadlessState, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const origPiece = state.pieces.get(orig),\n    destPiece = state.pieces.get(dest);\n  if (orig === dest || !origPiece) return false;\n  const captured = destPiece && destPiece.color !== origPiece.color ? destPiece : undefined;\n  if (dest === state.selected) unselect(state);\n  callUserFunction(state.events.move, orig, dest, captured);\n  if (!tryAutoCastle(state, orig, dest)) {\n    state.pieces.set(dest, origPiece);\n    state.pieces.delete(orig);\n  }\n  state.lastMove = [orig, dest];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  return captured || true;\n}\n\nexport function baseNewPiece(state: HeadlessState, piece: cg.Piece, key: cg.Key, force?: boolean): boolean {\n  if (state.pieces.has(key)) {\n    if (force) state.pieces.delete(key);\n    else return false;\n  }\n  callUserFunction(state.events.dropNewPiece, piece, key);\n  state.pieces.set(key, piece);\n  state.lastMove = [key];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  state.movable.dests = undefined;\n  state.turnColor = opposite(state.turnColor);\n  return true;\n}\n\nfunction baseUserMove(state: HeadlessState, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const result = baseMove(state, orig, dest);\n  if (result) {\n    state.movable.dests = undefined;\n    state.turnColor = opposite(state.turnColor);\n    state.animation.current = undefined;\n  }\n  return result;\n}\n\nexport function userMove(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const holdTime = state.hold.stop();\n      unselect(state);\n      const metadata: cg.MoveMetadata = {\n        premove: false,\n        ctrlKey: state.stats.ctrlKey,\n        holdTime,\n      };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      return true;\n    }\n  } else if (canPremove(state, orig, dest)) {\n    setPremove(state, orig, dest, {\n      ctrlKey: state.stats.ctrlKey,\n    });\n    unselect(state);\n    return true;\n  }\n  unselect(state);\n  return false;\n}\n\nexport function dropNewPiece(state: HeadlessState, orig: cg.Key, dest: cg.Key, force?: boolean): void {\n  const piece = state.pieces.get(orig);\n  if (piece && (canDrop(state, orig, dest) || force)) {\n    state.pieces.delete(orig);\n    baseNewPiece(state, piece, dest, force);\n    callUserFunction(state.movable.events.afterNewPiece, piece.role, dest, {\n      premove: false,\n      predrop: false,\n    });\n  } else if (piece && canPredrop(state, orig, dest)) {\n    setPredrop(state, piece.role, dest);\n  } else {\n    unsetPremove(state);\n    unsetPredrop(state);\n  }\n  state.pieces.delete(orig);\n  unselect(state);\n}\n\nexport function selectSquare(state: HeadlessState, key: cg.Key, force?: boolean): void {\n  callUserFunction(state.events.select, key);\n  if (state.selected) {\n    if (state.selected === key && !state.draggable.enabled) {\n      unselect(state);\n      state.hold.cancel();\n      return;\n    } else if ((state.selectable.enabled || force) && state.selected !== key) {\n      if (userMove(state, state.selected, key)) {\n        state.stats.dragged = false;\n        return;\n      }\n    }\n  }\n  if (\n    (state.selectable.enabled || state.draggable.enabled) &&\n    (isMovable(state, key) || isPremovable(state, key))\n  ) {\n    setSelected(state, key);\n    state.hold.start();\n  }\n}\n\nexport function setSelected(state: HeadlessState, key: cg.Key): void {\n  state.selected = key;\n  if (isPremovable(state, key)) {\n    // calculate chess premoves if custom premoves are not passed\n    if (!state.premovable.customDests) {\n      state.premovable.dests = premove(state.pieces, key, state.premovable.castle);\n    }\n  } else state.premovable.dests = undefined;\n}\n\nexport function unselect(state: HeadlessState): void {\n  state.selected = undefined;\n  state.premovable.dests = undefined;\n  state.hold.cancel();\n}\n\nfunction isMovable(state: HeadlessState, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    (state.movable.color === 'both' ||\n      (state.movable.color === piece.color && state.turnColor === piece.color))\n  );\n}\n\nexport const canMove = (state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean =>\n  orig !== dest &&\n  isMovable(state, orig) &&\n  (state.movable.free || !!state.movable.dests?.get(orig)?.includes(dest));\n\nfunction canDrop(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    (orig === dest || !state.pieces.has(dest)) &&\n    (state.movable.color === 'both' ||\n      (state.movable.color === piece.color && state.turnColor === piece.color))\n  );\n}\n\nfunction isPremovable(state: HeadlessState, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    state.premovable.enabled &&\n    state.movable.color === piece.color &&\n    state.turnColor !== piece.color\n  );\n}\n\nfunction canPremove(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  const validPremoves: cg.Key[] =\n    state.premovable.customDests?.get(orig) ?? premove(state.pieces, orig, state.premovable.castle);\n  return orig !== dest && isPremovable(state, orig) && validPremoves.includes(dest);\n}\n\nfunction canPredrop(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  const destPiece = state.pieces.get(dest);\n  return (\n    !!piece &&\n    (!destPiece || destPiece.color !== state.movable.color) &&\n    state.predroppable.enabled &&\n    (piece.role !== 'pawn' || (dest[1] !== '1' && dest[1] !== '8')) &&\n    state.movable.color === piece.color &&\n    state.turnColor !== piece.color\n  );\n}\n\nexport function isDraggable(state: HeadlessState, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    state.draggable.enabled &&\n    (state.movable.color === 'both' ||\n      (state.movable.color === piece.color && (state.turnColor === piece.color || state.premovable.enabled)))\n  );\n}\n\nexport function playPremove(state: HeadlessState): boolean {\n  const move = state.premovable.current;\n  if (!move) return false;\n  const orig = move[0],\n    dest = move[1];\n  let success = false;\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const metadata: cg.MoveMetadata = { premove: true };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      success = true;\n    }\n  }\n  unsetPremove(state);\n  return success;\n}\n\nexport function playPredrop(state: HeadlessState, validate: (drop: cg.Drop) => boolean): boolean {\n  const drop = state.predroppable.current;\n  let success = false;\n  if (!drop) return false;\n  if (validate(drop)) {\n    const piece = {\n      role: drop.role,\n      color: state.movable.color,\n    } as cg.Piece;\n    if (baseNewPiece(state, piece, drop.key)) {\n      callUserFunction(state.movable.events.afterNewPiece, drop.role, drop.key, {\n        premove: false,\n        predrop: true,\n      });\n      success = true;\n    }\n  }\n  unsetPredrop(state);\n  return success;\n}\n\nexport function cancelMove(state: HeadlessState): void {\n  unsetPremove(state);\n  unsetPredrop(state);\n  unselect(state);\n}\n\nexport function stop(state: HeadlessState): void {\n  state.movable.color = state.movable.dests = state.animation.current = undefined;\n  cancelMove(state);\n}\n\nexport function getKeyAtDomPos(\n  pos: cg.NumberPair,\n  asWhite: boolean,\n  bounds: DOMRectReadOnly,\n): cg.Key | undefined {\n  let file = Math.floor((8 * (pos[0] - bounds.left)) / bounds.width);\n  if (!asWhite) file = 7 - file;\n  let rank = 7 - Math.floor((8 * (pos[1] - bounds.top)) / bounds.height);\n  if (!asWhite) rank = 7 - rank;\n  return file >= 0 && file < 8 && rank >= 0 && rank < 8 ? pos2key([file, rank]) : undefined;\n}\n\nexport function getSnappedKeyAtDomPos(\n  orig: cg.Key,\n  pos: cg.NumberPair,\n  asWhite: boolean,\n  bounds: DOMRectReadOnly,\n): cg.Key | undefined {\n  const origPos = key2pos(orig);\n  const validSnapPos = allPos.filter(\n    pos2 =>\n      queen(origPos[0], origPos[1], pos2[0], pos2[1]) || knight(origPos[0], origPos[1], pos2[0], pos2[1]),\n  );\n  const validSnapCenters = validSnapPos.map(pos2 => computeSquareCenter(pos2key(pos2), asWhite, bounds));\n  const validSnapDistances = validSnapCenters.map(pos2 => distanceSq(pos, pos2));\n  const [, closestSnapIndex] = validSnapDistances.reduce(\n    (a, b, index) => (a[0] < b ? a : [b, index]),\n    [validSnapDistances[0], 0],\n  );\n  return pos2key(validSnapPos[closestSnapIndex]);\n}\n\nexport const whitePov = (s: HeadlessState): boolean => s.orientation === 'white';\n", "import { pos2key, invRanks } from './util.js';\nimport * as cg from './types.js';\n\nexport const initial: cg.FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\n\nconst roles: { [letter: string]: cg.Role } = {\n  p: 'pawn',\n  r: 'rook',\n  n: 'knight',\n  b: 'bishop',\n  q: 'queen',\n  k: 'king',\n};\n\nconst letters = {\n  pawn: 'p',\n  rook: 'r',\n  knight: 'n',\n  bishop: 'b',\n  queen: 'q',\n  king: 'k',\n};\n\nexport function read(fen: cg.FEN): cg.Pieces {\n  if (fen === 'start') fen = initial;\n  const pieces: cg.Pieces = new Map();\n  let row = 7,\n    col = 0;\n  for (const c of fen) {\n    switch (c) {\n      case ' ':\n      case '[':\n        return pieces;\n      case '/':\n        --row;\n        if (row < 0) return pieces;\n        col = 0;\n        break;\n      case '~': {\n        const piece = pieces.get(pos2key([col - 1, row]));\n        if (piece) piece.promoted = true;\n        break;\n      }\n      default: {\n        const nb = c.charCodeAt(0);\n        if (nb < 57) col += nb - 48;\n        else {\n          const role = c.toLowerCase();\n          pieces.set(pos2key([col, row]), {\n            role: roles[role],\n            color: c === role ? 'black' : 'white',\n          });\n          ++col;\n        }\n      }\n    }\n  }\n  return pieces;\n}\n\nexport function write(pieces: cg.Pieces): cg.FEN {\n  return invRanks\n    .map(y =>\n      cg.files\n        .map(x => {\n          const piece = pieces.get((x + y) as cg.Key);\n          if (piece) {\n            let p = letters[piece.role];\n            if (piece.color === 'white') p = p.toUpperCase();\n            if (piece.promoted) p += '~';\n            return p;\n          } else return '1';\n        })\n        .join(''),\n    )\n    .join('/')\n    .replace(/1{2,}/g, s => s.length.toString());\n}\n", "import { HeadlessState } from './state.js';\nimport { setCheck, setSelected } from './board.js';\nimport { read as fenRead } from './fen.js';\nimport { DrawShape, DrawBrushes } from './draw.js';\nimport * as cg from './types.js';\n\nexport interface Config {\n  fen?: cg.FEN; // chess position in Forsyth notation\n  orientation?: cg.Color; // board orientation. white | black\n  turnColor?: cg.Color; // turn to play. white | black\n  check?: cg.Color | boolean; // true for current color, false to unset\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\", \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates?: boolean; // include coords attributes\n  coordinatesOnSquares?: boolean; // include coords attributes on every square\n  autoCastle?: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly?: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu?: boolean; // because who needs a context menu on a chessboard\n  addPieceZIndex?: boolean; // adds z-index values to pieces (for 3D)\n  addDimensionsCssVarsTo?: HTMLElement; // add ---cg-width and ---cg-height CSS vars containing the board's dimensions to this element\n  blockTouchScroll?: boolean; // block scrolling via touch dragging on the board, e.g. for coordinate training\n  // pieceKey: boolean; // add a data-key attribute to piece elements\n  trustAllEvents?: boolean; // disable checking for human only input (e.isTrusted)\n  highlight?: {\n    lastMove?: boolean; // add last-move class to squares\n    check?: boolean; // add check class to squares\n    custom?: cg.SquareClasses; // add custom classes to custom squares\n  };\n  animation?: {\n    enabled?: boolean;\n    duration?: number;\n  };\n  movable?: {\n    free?: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both | undefined\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests?: boolean; // whether to add the move-dest class on squares\n    events?: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle?: boolean; // castle by moving the king to the rook\n  };\n  premovable?: {\n    enabled?: boolean; // allow premoves for color that can not move\n    showDests?: boolean; // whether to add the premove-dest class on squares\n    castle?: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    customDests?: cg.Dests; // use custom valid premoves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    events?: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void; // called after the premove has been unset\n    };\n  };\n  predroppable?: {\n    enabled?: boolean; // allow predrops for color that can not move\n    events?: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable?: {\n    enabled?: boolean; // allow moves & premoves to use drag'n drop\n    distance?: number; // minimum distance to initiate a drag; in pixels\n    autoDistance?: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost?: boolean; // show ghost of piece being dragged\n    deleteOnDropOff?: boolean; // delete a piece when it is dropped off the board\n  };\n  selectable?: {\n    // disable to enforce dragging over click-click move\n    enabled?: boolean;\n  };\n  events?: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable?: {\n    enabled?: boolean; // can draw\n    visible?: boolean; // can view\n    defaultSnapToValidMove?: boolean;\n    // false to keep the drawing if a movable piece is clicked.\n    // Clicking an empty square or immovable piece will clear the drawing regardless.\n    eraseOnClick?: boolean;\n    shapes?: DrawShape[];\n    autoShapes?: DrawShape[];\n    brushes?: DrawBrushes;\n    onChange?: (shapes: DrawShape[]) => void; // called after drawable shapes change\n  };\n}\n\nexport function applyAnimation(state: HeadlessState, config: Config): void {\n  if (config.animation) {\n    deepMerge(state.animation, config.animation);\n    // no need for such short animations\n    if ((state.animation.duration || 0) < 70) state.animation.enabled = false;\n  }\n}\n\nexport function configure(state: HeadlessState, config: Config): void {\n  // don't merge destinations and autoShapes. Just override.\n  if (config.movable?.dests) state.movable.dests = undefined;\n  if (config.drawable?.autoShapes) state.drawable.autoShapes = [];\n\n  deepMerge(state, config);\n\n  // if a fen was provided, replace the pieces\n  if (config.fen) {\n    state.pieces = fenRead(config.fen);\n    state.drawable.shapes = config.drawable?.shapes || [];\n  }\n\n  // apply config values that could be undefined yet meaningful\n  if ('check' in config) setCheck(state, config.check || false);\n  if ('lastMove' in config && !config.lastMove) state.lastMove = undefined;\n  // in case of ZH drop last move, there's a single square.\n  // if the previous last move had two squares,\n  // the merge algorithm will incorrectly keep the second square.\n  else if (config.lastMove) state.lastMove = config.lastMove;\n\n  // fix move/premove dests\n  if (state.selected) setSelected(state, state.selected);\n\n  applyAnimation(state, config);\n\n  if (!state.movable.rookCastle && state.movable.dests) {\n    const rank = state.movable.color === 'white' ? '1' : '8',\n      kingStartPos = ('e' + rank) as cg.Key,\n      dests = state.movable.dests.get(kingStartPos),\n      king = state.pieces.get(kingStartPos);\n    if (!dests || !king || king.role !== 'king') return;\n    state.movable.dests.set(\n      kingStartPos,\n      dests.filter(\n        d =>\n          !(d === 'a' + rank && dests.includes(('c' + rank) as cg.Key)) &&\n          !(d === 'h' + rank && dests.includes(('g' + rank) as cg.Key)),\n      ),\n    );\n  }\n}\n\nfunction deepMerge(base: any, extend: any): void {\n  for (const key in extend) {\n    if (key === '__proto__' || key === 'constructor' || !Object.prototype.hasOwnProperty.call(extend, key))\n      continue;\n    if (\n      Object.prototype.hasOwnProperty.call(base, key) &&\n      isPlainObject(base[key]) &&\n      isPlainObject(extend[key])\n    )\n      deepMerge(base[key], extend[key]);\n    else base[key] = extend[key];\n  }\n}\n\nfunction isPlainObject(o: unknown): boolean {\n  if (typeof o !== 'object' || o === null) return false;\n  const proto = Object.getPrototypeOf(o);\n  return proto === Object.prototype || proto === null;\n}\n", "import { State } from './state.js';\nimport * as util from './util.js';\nimport * as cg from './types.js';\n\nexport type Mutation<A> = (state: State) => A;\n\n// 0,1 animation goal\n// 2,3 animation current status\nexport type AnimVector = cg.NumberQuad;\n\nexport type AnimVectors = Map<cg.Key, AnimVector>;\n\nexport type AnimFadings = Map<cg.Key, cg.Piece>;\n\nexport interface AnimPlan {\n  anims: AnimVectors;\n  fadings: AnimFadings;\n}\n\nexport interface AnimCurrent {\n  start: DOMHighResTimeStamp;\n  frequency: cg.KHz;\n  plan: AnimPlan;\n}\n\nexport const anim = <A>(mutation: Mutation<A>, state: State): A =>\n  state.animation.enabled ? animate(mutation, state) : render(mutation, state);\n\nexport function render<A>(mutation: Mutation<A>, state: State): A {\n  const result = mutation(state);\n  state.dom.redraw();\n  return result;\n}\n\ninterface AnimPiece {\n  key: cg.Key;\n  pos: cg.Pos;\n  piece: cg.Piece;\n}\ntype AnimPieces = Map<cg.Key, AnimPiece>;\n\nconst makePiece = (key: cg.Key, piece: cg.Piece): AnimPiece => ({\n  key: key,\n  pos: util.key2pos(key),\n  piece: piece,\n});\n\nconst closer = (piece: AnimPiece, pieces: AnimPiece[]): AnimPiece | undefined =>\n  pieces.sort((p1, p2) => util.distanceSq(piece.pos, p1.pos) - util.distanceSq(piece.pos, p2.pos))[0];\n\nfunction computePlan(prevPieces: cg.Pieces, current: State): AnimPlan {\n  const anims: AnimVectors = new Map(),\n    animedOrigs: cg.Key[] = [],\n    fadings: AnimFadings = new Map(),\n    missings: AnimPiece[] = [],\n    news: AnimPiece[] = [],\n    prePieces: AnimPieces = new Map();\n  let curP: cg.Piece | undefined, preP: AnimPiece | undefined, vector: cg.NumberPair;\n  for (const [k, p] of prevPieces) {\n    prePieces.set(k, makePiece(k, p));\n  }\n  for (const key of util.allKeys) {\n    curP = current.pieces.get(key);\n    preP = prePieces.get(key);\n    if (curP) {\n      if (preP) {\n        if (!util.samePiece(curP, preP.piece)) {\n          missings.push(preP);\n          news.push(makePiece(key, curP));\n        }\n      } else news.push(makePiece(key, curP));\n    } else if (preP) missings.push(preP);\n  }\n  for (const newP of news) {\n    preP = closer(\n      newP,\n      missings.filter(p => util.samePiece(newP.piece, p.piece)),\n    );\n    if (preP) {\n      vector = [preP.pos[0] - newP.pos[0], preP.pos[1] - newP.pos[1]];\n      anims.set(newP.key, vector.concat(vector) as AnimVector);\n      animedOrigs.push(preP.key);\n    }\n  }\n  for (const p of missings) {\n    if (!animedOrigs.includes(p.key)) fadings.set(p.key, p.piece);\n  }\n\n  return {\n    anims: anims,\n    fadings: fadings,\n  };\n}\n\nfunction step(state: State, now: DOMHighResTimeStamp): void {\n  const cur = state.animation.current;\n  if (cur === undefined) {\n    // animation was canceled :(\n    if (!state.dom.destroyed) state.dom.redrawNow();\n    return;\n  }\n  const rest = 1 - (now - cur.start) * cur.frequency;\n  if (rest <= 0) {\n    state.animation.current = undefined;\n    state.dom.redrawNow();\n  } else {\n    const ease = easing(rest);\n    for (const cfg of cur.plan.anims.values()) {\n      cfg[2] = cfg[0] * ease;\n      cfg[3] = cfg[1] * ease;\n    }\n    state.dom.redrawNow(true); // optimisation: don't render SVG changes during animations\n    requestAnimationFrame((now = performance.now()) => step(state, now));\n  }\n}\n\nfunction animate<A>(mutation: Mutation<A>, state: State): A {\n  // clone state before mutating it\n  const prevPieces: cg.Pieces = new Map(state.pieces);\n\n  const result = mutation(state);\n  const plan = computePlan(prevPieces, state);\n  if (plan.anims.size || plan.fadings.size) {\n    const alreadyRunning = state.animation.current && state.animation.current.start;\n    state.animation.current = {\n      start: performance.now(),\n      frequency: 1 / state.animation.duration,\n      plan: plan,\n    };\n    if (!alreadyRunning) step(state, performance.now());\n  } else {\n    // don't animate, just render right away\n    state.dom.redraw();\n  }\n  return result;\n}\n\n// https://gist.github.com/gre/1650294\nconst easing = (t: number): number => (t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1);\n", "import { State } from './state.js';\nimport { unselect, cancelMove, getKeyAtDomPos, getSnappedKeyAtDomPos, whitePov } from './board.js';\nimport { eventPosition, isRightButton } from './util.js';\nimport * as cg from './types.js';\n\nexport interface DrawShape {\n  orig: cg.Key;\n  dest?: cg.Key;\n  brush?: string; // if no brush, no shape. label moved to top right of square\n  modifiers?: DrawModifiers;\n  piece?: DrawShapePiece;\n  customSvg?: { html: string; center?: 'orig' | 'dest' | 'label' }; // 100 x 100 viewbox cenetered at [50,50]\n  label?: { text: string; fill?: string }; // fill is in '#rrggbb' format\n}\n\nexport interface DrawModifiers {\n  lineWidth?: number;\n  hilite?: boolean;\n}\n\nexport interface DrawShapePiece {\n  role: cg.Role;\n  color: cg.Color;\n  scale?: number;\n}\n\nexport interface DrawBrush {\n  key: string;\n  color: string;\n  opacity: number;\n  lineWidth: number;\n}\n\nexport interface DrawBrushes {\n  green: DrawBrush;\n  red: DrawBrush;\n  blue: DrawBrush;\n  yellow: DrawBrush;\n  [color: string]: DrawBrush;\n}\n\nexport interface Drawable {\n  enabled: boolean; // can draw\n  visible: boolean; // can view\n  defaultSnapToValidMove: boolean;\n  eraseOnClick: boolean;\n  onChange?: (shapes: DrawShape[]) => void;\n  shapes: DrawShape[]; // user shapes\n  autoShapes: DrawShape[]; // computer shapes\n  current?: DrawCurrent;\n  brushes: DrawBrushes;\n  prevSvgHash: string;\n}\n\nexport interface DrawCurrent {\n  orig: cg.Key; // orig key of drawing\n  dest?: cg.Key; // shape dest, or undefined for circle\n  mouseSq?: cg.Key; // square being moused over\n  pos: cg.NumberPair; // relative current position\n  brush: cg.BrushColor; // brush name for shape\n  snapToValidMove: boolean; // whether to snap to valid piece moves\n}\n\nconst brushes: cg.BrushColor[] = ['green', 'red', 'blue', 'yellow'];\n\nexport function start(state: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (e.touches && e.touches.length > 1) return;\n  e.stopPropagation();\n  e.preventDefault();\n  e.ctrlKey ? unselect(state) : cancelMove(state);\n  const pos = eventPosition(e)!,\n    orig = getKeyAtDomPos(pos, whitePov(state), state.dom.bounds());\n  if (!orig) return;\n  state.drawable.current = {\n    orig,\n    pos,\n    brush: eventBrush(e),\n    snapToValidMove: state.drawable.defaultSnapToValidMove,\n  };\n\n  processDraw(state);\n}\n\nexport function processDraw(state: State): void {\n  requestAnimationFrame(() => {\n    const cur = state.drawable.current;\n    if (cur) {\n      const keyAtDomPos = getKeyAtDomPos(cur.pos, whitePov(state), state.dom.bounds());\n      if (!keyAtDomPos) {\n        cur.snapToValidMove = false;\n      }\n      const mouseSq = cur.snapToValidMove\n        ? getSnappedKeyAtDomPos(cur.orig, cur.pos, whitePov(state), state.dom.bounds())\n        : keyAtDomPos;\n      if (mouseSq !== cur.mouseSq) {\n        cur.mouseSq = mouseSq;\n        cur.dest = mouseSq !== cur.orig ? mouseSq : undefined;\n        state.dom.redrawNow();\n      }\n      processDraw(state);\n    }\n  });\n}\n\nexport function move(state: State, e: cg.MouchEvent): void {\n  if (state.drawable.current) state.drawable.current.pos = eventPosition(e)!;\n}\n\nexport function end(state: State): void {\n  const cur = state.drawable.current;\n  if (cur) {\n    if (cur.mouseSq) addShape(state.drawable, cur);\n    cancel(state);\n  }\n}\n\nexport function cancel(state: State): void {\n  if (state.drawable.current) {\n    state.drawable.current = undefined;\n    state.dom.redraw();\n  }\n}\n\nexport function clear(state: State): void {\n  if (state.drawable.shapes.length) {\n    state.drawable.shapes = [];\n    state.dom.redraw();\n    onChange(state.drawable);\n  }\n}\n\nfunction eventBrush(e: cg.MouchEvent): cg.BrushColor {\n  const modA = (e.shiftKey || e.ctrlKey) && isRightButton(e);\n  const modB = e.altKey || e.metaKey || e.getModifierState?.('AltGraph');\n  return brushes[(modA ? 1 : 0) + (modB ? 2 : 0)];\n}\n\nfunction addShape(drawable: Drawable, cur: DrawCurrent): void {\n  const sameShape = (s: DrawShape) => s.orig === cur.orig && s.dest === cur.dest;\n  const similar = drawable.shapes.find(sameShape);\n  if (similar) drawable.shapes = drawable.shapes.filter(s => !sameShape(s));\n  if (!similar || similar.brush !== cur.brush)\n    drawable.shapes.push({\n      orig: cur.orig,\n      dest: cur.dest,\n      brush: cur.brush,\n    });\n  onChange(drawable);\n}\n\nfunction onChange(drawable: Drawable): void {\n  if (drawable.onChange) drawable.onChange(drawable.shapes);\n}\n", "import { State } from './state.js';\nimport * as board from './board.js';\nimport * as util from './util.js';\nimport { clear as drawClear } from './draw.js';\nimport * as cg from './types.js';\nimport { anim } from './anim.js';\n\nexport interface DragCurrent {\n  orig: cg.Key; // orig key of dragging piece\n  piece: cg.Piece;\n  origPos: cg.NumberPair; // first event position\n  pos: cg.NumberPair; // latest event position\n  started: boolean; // whether the drag has started; as per the distance setting\n  element: cg.PieceNode | (() => cg.PieceNode | undefined);\n  newPiece?: boolean; // it it a new piece from outside the board\n  force?: boolean; // can the new piece replace an existing one (editor)\n  previouslySelected?: cg.Key;\n  originTarget: EventTarget | null;\n  keyHasChanged: boolean; // whether the drag has left the orig key\n}\n\nexport function start(s: State, e: cg.MouchEvent): void {\n  if (!(s.trustAllEvents || e.isTrusted)) return; // only trust when trustAllEvents is enabled\n  if (e.buttons !== undefined && e.buttons > 1) return; // only touch or left click\n  if (e.touches && e.touches.length > 1) return; // support one finger touch only\n  const bounds = s.dom.bounds(),\n    position = util.eventPosition(e)!,\n    orig = board.getKeyAtDomPos(position, board.whitePov(s), bounds);\n  if (!orig) return;\n  const piece = s.pieces.get(orig);\n  const previouslySelected = s.selected;\n  if (\n    !previouslySelected &&\n    s.drawable.enabled &&\n    (s.drawable.eraseOnClick || !piece || piece.color !== s.turnColor)\n  )\n    drawClear(s);\n  // Prevent touch scroll and create no corresponding mouse event, if there\n  // is an intent to interact with the board.\n  if (\n    e.cancelable !== false &&\n    (!e.touches || s.blockTouchScroll || piece || previouslySelected || pieceCloseTo(s, position))\n  )\n    e.preventDefault();\n  else if (e.touches) return; // Handle only corresponding mouse event https://github.com/lichess-org/chessground/pull/268\n\n  const hadPremove = !!s.premovable.current;\n  const hadPredrop = !!s.predroppable.current;\n  s.stats.ctrlKey = e.ctrlKey;\n  if (s.selected && board.canMove(s, s.selected, orig)) {\n    anim(state => board.selectSquare(state, orig), s);\n  } else {\n    board.selectSquare(s, orig);\n  }\n  const stillSelected = s.selected === orig;\n  const element = pieceElementByKey(s, orig);\n  if (piece && element && stillSelected && board.isDraggable(s, orig)) {\n    s.draggable.current = {\n      orig,\n      piece,\n      origPos: position,\n      pos: position,\n      started: s.draggable.autoDistance && s.stats.dragged,\n      element,\n      previouslySelected,\n      originTarget: e.target,\n      keyHasChanged: false,\n    };\n    element.cgDragging = true;\n    element.classList.add('dragging');\n    // place ghost\n    const ghost = s.dom.elements.ghost;\n    if (ghost) {\n      ghost.className = `ghost ${piece.color} ${piece.role}`;\n      util.translate(ghost, util.posToTranslate(bounds)(util.key2pos(orig), board.whitePov(s)));\n      util.setVisible(ghost, true);\n    }\n    processDrag(s);\n  } else {\n    if (hadPremove) board.unsetPremove(s);\n    if (hadPredrop) board.unsetPredrop(s);\n  }\n  s.dom.redraw();\n}\n\nfunction pieceCloseTo(s: State, pos: cg.NumberPair): boolean {\n  const asWhite = board.whitePov(s),\n    bounds = s.dom.bounds(),\n    radiusSq = Math.pow(bounds.width / 8, 2);\n  for (const key of s.pieces.keys()) {\n    const center = util.computeSquareCenter(key, asWhite, bounds);\n    if (util.distanceSq(center, pos) <= radiusSq) return true;\n  }\n  return false;\n}\n\nexport function dragNewPiece(s: State, piece: cg.Piece, e: cg.MouchEvent, force?: boolean): void {\n  const key: cg.Key = 'a0';\n  s.pieces.set(key, piece);\n  s.dom.redraw();\n\n  const position = util.eventPosition(e)!;\n\n  s.draggable.current = {\n    orig: key,\n    piece,\n    origPos: position,\n    pos: position,\n    started: true,\n    element: () => pieceElementByKey(s, key),\n    originTarget: e.target,\n    newPiece: true,\n    force: !!force,\n    keyHasChanged: false,\n  };\n  processDrag(s);\n}\n\nfunction processDrag(s: State): void {\n  requestAnimationFrame(() => {\n    const cur = s.draggable.current;\n    if (!cur) return;\n    // cancel animations while dragging\n    if (s.animation.current?.plan.anims.has(cur.orig)) s.animation.current = undefined;\n    // if moving piece is gone, cancel\n    const origPiece = s.pieces.get(cur.orig);\n    if (!origPiece || !util.samePiece(origPiece, cur.piece)) cancel(s);\n    else {\n      if (!cur.started && util.distanceSq(cur.pos, cur.origPos) >= Math.pow(s.draggable.distance, 2))\n        cur.started = true;\n      if (cur.started) {\n        // support lazy elements\n        if (typeof cur.element === 'function') {\n          const found = cur.element();\n          if (!found) return;\n          found.cgDragging = true;\n          found.classList.add('dragging');\n          cur.element = found;\n        }\n\n        const bounds = s.dom.bounds();\n        util.translate(cur.element, [\n          cur.pos[0] - bounds.left - bounds.width / 16,\n          cur.pos[1] - bounds.top - bounds.height / 16,\n        ]);\n\n        cur.keyHasChanged ||= cur.orig !== board.getKeyAtDomPos(cur.pos, board.whitePov(s), bounds);\n      }\n    }\n    processDrag(s);\n  });\n}\n\nexport function move(s: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (s.draggable.current && (!e.touches || e.touches.length < 2)) {\n    s.draggable.current.pos = util.eventPosition(e)!;\n  }\n}\n\nexport function end(s: State, e: cg.MouchEvent): void {\n  const cur = s.draggable.current;\n  if (!cur) return;\n  // create no corresponding mouse event\n  if (e.type === 'touchend' && e.cancelable !== false) e.preventDefault();\n  // comparing with the origin target is an easy way to test that the end event\n  // has the same touch origin\n  if (e.type === 'touchend' && cur.originTarget !== e.target && !cur.newPiece) {\n    s.draggable.current = undefined;\n    return;\n  }\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n  // touchend has no position; so use the last touchmove position instead\n  const eventPos = util.eventPosition(e) || cur.pos;\n  const dest = board.getKeyAtDomPos(eventPos, board.whitePov(s), s.dom.bounds());\n  if (dest && cur.started && cur.orig !== dest) {\n    if (cur.newPiece) board.dropNewPiece(s, cur.orig, dest, cur.force);\n    else {\n      s.stats.ctrlKey = e.ctrlKey;\n      if (board.userMove(s, cur.orig, dest)) s.stats.dragged = true;\n    }\n  } else if (cur.newPiece) {\n    s.pieces.delete(cur.orig);\n  } else if (s.draggable.deleteOnDropOff && !dest) {\n    s.pieces.delete(cur.orig);\n    board.callUserFunction(s.events.change);\n  }\n  if ((cur.orig === cur.previouslySelected || cur.keyHasChanged) && (cur.orig === dest || !dest))\n    board.unselect(s);\n  else if (!s.selectable.enabled) board.unselect(s);\n\n  removeDragElements(s);\n\n  s.draggable.current = undefined;\n  s.dom.redraw();\n}\n\nexport function cancel(s: State): void {\n  const cur = s.draggable.current;\n  if (cur) {\n    if (cur.newPiece) s.pieces.delete(cur.orig);\n    s.draggable.current = undefined;\n    board.unselect(s);\n    removeDragElements(s);\n    s.dom.redraw();\n  }\n}\n\nfunction removeDragElements(s: State): void {\n  const e = s.dom.elements;\n  if (e.ghost) util.setVisible(e.ghost, false);\n}\n\nfunction pieceElementByKey(s: State, key: cg.Key): cg.PieceNode | undefined {\n  let el = s.dom.elements.board.firstChild;\n  while (el) {\n    if ((el as cg.KeyedNode).cgKey === key && (el as cg.KeyedNode).tagName === 'PIECE')\n      return el as cg.PieceNode;\n    el = el.nextSibling;\n  }\n  return;\n}\n", "import { State } from './state.js';\nimport { Key } from './types.js';\n\nexport function explosion(state: State, keys: Key[]): void {\n  state.exploding = { stage: 1, keys };\n  state.dom.redraw();\n  setTimeout(() => {\n    setStage(state, 2);\n    setTimeout(() => setStage(state, undefined), 120);\n  }, 120);\n}\n\nfunction setStage(state: State, stage: number | undefined): void {\n  if (state.exploding) {\n    if (stage) state.exploding.stage = stage;\n    else state.exploding = undefined;\n    state.dom.redraw();\n  }\n}\n", "import { State } from './state.js';\nimport * as board from './board.js';\nimport { write as fenWrite } from './fen.js';\nimport { Config, configure, applyAnimation } from './config.js';\nimport { anim, render } from './anim.js';\nimport { cancel as dragCancel, dragNewPiece } from './drag.js';\nimport { DrawShape } from './draw.js';\nimport { explosion } from './explosion.js';\nimport * as cg from './types.js';\n\nexport interface Api {\n  // reconfigure the instance. Accepts all config options, except for viewOnly & drawable.visible.\n  // board will be animated accordingly, if animations are enabled.\n  set(config: Config): void;\n\n  // read chessground state; write at your own risks.\n  state: State;\n\n  // get the position as a FEN string (only contains pieces, no flags)\n  // e.g. rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR\n  getFen(): cg.FEN;\n\n  // change the view angle\n  toggleOrientation(): void;\n\n  // perform a move programmatically\n  move(orig: cg.Key, dest: cg.Key): void;\n\n  // add and/or remove arbitrary pieces on the board\n  setPieces(pieces: cg.PiecesDiff): void;\n\n  // click a square programmatically\n  selectSquare(key: cg.Key | null, force?: boolean): void;\n\n  // put a new piece on the board\n  newPiece(piece: cg.Piece, key: cg.Key): void;\n\n  // play the current premove, if any; returns true if premove was played\n  playPremove(): boolean;\n\n  // cancel the current premove, if any\n  cancelPremove(): void;\n\n  // play the current predrop, if any; returns true if premove was played\n  playPredrop(validate: (drop: cg.Drop) => boolean): boolean;\n\n  // cancel the current predrop, if any\n  cancelPredrop(): void;\n\n  // cancel the current move being made\n  cancelMove(): void;\n\n  // cancel current move and prevent further ones\n  stop(): void;\n\n  // make squares explode (atomic chess)\n  explode(keys: cg.Key[]): void;\n\n  // programmatically draw user shapes\n  setShapes(shapes: DrawShape[]): void;\n\n  // programmatically draw auto shapes\n  setAutoShapes(shapes: DrawShape[]): void;\n\n  // square name at this DOM position (like \"e4\")\n  getKeyAtDomPos(pos: cg.NumberPair): cg.Key | undefined;\n\n  // only useful when CSS changes the board width/height ratio (for 3D)\n  redrawAll: cg.Redraw;\n\n  // for crazyhouse and board editors\n  dragNewPiece(piece: cg.Piece, event: cg.MouchEvent, force?: boolean): void;\n\n  // unbinds all events\n  // (important for document-wide events like scroll and mousemove)\n  destroy: cg.Unbind;\n}\n\n// see API types and documentations in dts/api.d.ts\nexport function start(state: State, redrawAll: cg.Redraw): Api {\n  function toggleOrientation(): void {\n    board.toggleOrientation(state);\n    redrawAll();\n  }\n\n  return {\n    set(config): void {\n      if (config.orientation && config.orientation !== state.orientation) toggleOrientation();\n      applyAnimation(state, config);\n      (config.fen ? anim : render)(state => configure(state, config), state);\n    },\n\n    state,\n\n    getFen: () => fenWrite(state.pieces),\n\n    toggleOrientation,\n\n    setPieces(pieces): void {\n      anim(state => board.setPieces(state, pieces), state);\n    },\n\n    selectSquare(key, force): void {\n      if (key) anim(state => board.selectSquare(state, key, force), state);\n      else if (state.selected) {\n        board.unselect(state);\n        state.dom.redraw();\n      }\n    },\n\n    move(orig, dest): void {\n      anim(state => board.baseMove(state, orig, dest), state);\n    },\n\n    newPiece(piece, key): void {\n      anim(state => board.baseNewPiece(state, piece, key), state);\n    },\n\n    playPremove(): boolean {\n      if (state.premovable.current) {\n        if (anim(board.playPremove, state)) return true;\n        // if the premove couldn't be played, redraw to clear it up\n        state.dom.redraw();\n      }\n      return false;\n    },\n\n    playPredrop(validate): boolean {\n      if (state.predroppable.current) {\n        const result = board.playPredrop(state, validate);\n        state.dom.redraw();\n        return result;\n      }\n      return false;\n    },\n\n    cancelPremove(): void {\n      render(board.unsetPremove, state);\n    },\n\n    cancelPredrop(): void {\n      render(board.unsetPredrop, state);\n    },\n\n    cancelMove(): void {\n      render(state => {\n        board.cancelMove(state);\n        dragCancel(state);\n      }, state);\n    },\n\n    stop(): void {\n      render(state => {\n        board.stop(state);\n        dragCancel(state);\n      }, state);\n    },\n\n    explode(keys: cg.Key[]): void {\n      explosion(state, keys);\n    },\n\n    setAutoShapes(shapes: DrawShape[]): void {\n      render(state => (state.drawable.autoShapes = shapes), state);\n    },\n\n    setShapes(shapes: DrawShape[]): void {\n      render(state => (state.drawable.shapes = shapes), state);\n    },\n\n    getKeyAtDomPos(pos): cg.Key | undefined {\n      return board.getKeyAtDomPos(pos, board.whitePov(state), state.dom.bounds());\n    },\n\n    redrawAll,\n\n    dragNewPiece(piece, event, force): void {\n      dragNewPiece(state, piece, event, force);\n    },\n\n    destroy(): void {\n      board.stop(state);\n      state.dom.unbind && state.dom.unbind();\n      state.dom.destroyed = true;\n    },\n  };\n}\n", "import * as fen from './fen.js';\nimport { AnimCurrent } from './anim.js';\nimport { DragCurrent } from './drag.js';\nimport { Drawable } from './draw.js';\nimport { timer } from './util.js';\nimport * as cg from './types.js';\n\nexport interface HeadlessState {\n  pieces: cg.Pieces;\n  orientation: cg.Color; // board orientation. white | black\n  turnColor: cg.Color; // turn to play. white | black\n  check?: cg.Key; // square currently in check \"a2\"\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\"; \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates: boolean; // include coords attributes\n  coordinatesOnSquares: boolean; // include coords attributes on every square\n  ranksPosition: cg.RanksPosition; // position ranks on either side. left | right\n  autoCastle: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu: boolean; // because who needs a context menu on a chessboard\n  addPieceZIndex: boolean; // adds z-index values to pieces (for 3D)\n  addDimensionsCssVarsTo?: HTMLElement; // add ---cg-width and ---cg-height CSS vars containing the board's dimensions to this element\n  blockTouchScroll: boolean; // block scrolling via touch dragging on the board, e.g. for coordinate training\n  pieceKey: boolean; // add a data-key attribute to piece elements\n  trustAllEvents?: boolean; // disable checking for human only input (e.isTrusted)\n  highlight: {\n    lastMove: boolean; // add last-move class to squares\n    check: boolean; // add check class to squares\n    custom?: cg.SquareClasses; // add custom classes to custom squares\n  };\n  animation: {\n    enabled: boolean;\n    duration: number;\n    current?: AnimCurrent;\n  };\n  movable: {\n    free: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests: boolean; // whether to add the move-dest class on squares\n    events: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle: boolean; // castle by moving the king to the rook\n  };\n  premovable: {\n    enabled: boolean; // allow premoves for color that can not move\n    showDests: boolean; // whether to add the premove-dest class on squares\n    castle: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    customDests?: cg.Dests; // use custom valid premoves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    current?: cg.KeyPair; // keys of the current saved premove [\"e2\" \"e4\"]\n    events: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void; // called after the premove has been unset\n    };\n  };\n  predroppable: {\n    enabled: boolean; // allow predrops for color that can not move\n    current?: {\n      // current saved predrop {role: 'knight'; key: 'e4'}\n      role: cg.Role;\n      key: cg.Key;\n    };\n    events: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable: {\n    enabled: boolean; // allow moves & premoves to use drag'n drop\n    distance: number; // minimum distance to initiate a drag; in pixels\n    autoDistance: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost: boolean; // show ghost of piece being dragged\n    deleteOnDropOff: boolean; // delete a piece when it is dropped off the board\n    current?: DragCurrent;\n  };\n  dropmode: {\n    active: boolean;\n    piece?: cg.Piece;\n  };\n  selectable: {\n    // disable to enforce dragging over click-click move\n    enabled: boolean;\n  };\n  stats: {\n    // was last piece dragged or clicked?\n    // needs default to false for touch\n    dragged: boolean;\n    ctrlKey?: boolean;\n  };\n  events: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable: Drawable;\n  exploding?: cg.Exploding;\n  hold: cg.Timer;\n}\n\nexport interface State extends HeadlessState {\n  dom: cg.Dom;\n}\n\nexport function defaults(): HeadlessState {\n  return {\n    pieces: fen.read(fen.initial),\n    orientation: 'white',\n    turnColor: 'white',\n    coordinates: true,\n    coordinatesOnSquares: false,\n    ranksPosition: 'right',\n    autoCastle: true,\n    viewOnly: false,\n    disableContextMenu: false,\n    addPieceZIndex: false,\n    blockTouchScroll: false,\n    pieceKey: false,\n    trustAllEvents: false,\n    highlight: {\n      lastMove: true,\n      check: true,\n    },\n    animation: {\n      enabled: true,\n      duration: 200,\n    },\n    movable: {\n      free: true,\n      color: 'both',\n      showDests: true,\n      events: {},\n      rookCastle: true,\n    },\n    premovable: {\n      enabled: true,\n      showDests: true,\n      castle: true,\n      events: {},\n    },\n    predroppable: {\n      enabled: false,\n      events: {},\n    },\n    draggable: {\n      enabled: true,\n      distance: 3,\n      autoDistance: true,\n      showGhost: true,\n      deleteOnDropOff: false,\n    },\n    dropmode: {\n      active: false,\n    },\n    selectable: {\n      enabled: true,\n    },\n    stats: {\n      // on touchscreen, default to \"tap-tap\" moves\n      // instead of drag\n      dragged: !('ontouchstart' in window),\n    },\n    events: {},\n    drawable: {\n      enabled: true, // can draw\n      visible: true, // can view\n      defaultSnapToValidMove: true,\n      eraseOnClick: true,\n      shapes: [],\n      autoShapes: [],\n      brushes: {\n        green: { key: 'g', color: '#15781B', opacity: 1, lineWidth: 10 },\n        red: { key: 'r', color: '#882020', opacity: 1, lineWidth: 10 },\n        blue: { key: 'b', color: '#003088', opacity: 1, lineWidth: 10 },\n        yellow: { key: 'y', color: '#e68f00', opacity: 1, lineWidth: 10 },\n        paleBlue: { key: 'pb', color: '#003088', opacity: 0.4, lineWidth: 15 },\n        paleGreen: { key: 'pg', color: '#15781B', opacity: 0.4, lineWidth: 15 },\n        paleRed: { key: 'pr', color: '#882020', opacity: 0.4, lineWidth: 15 },\n        paleGrey: {\n          key: 'pgr',\n          color: '#4a4a4a',\n          opacity: 0.35,\n          lineWidth: 15,\n        },\n        purple: { key: 'purple', color: '#68217a', opacity: 0.65, lineWidth: 10 },\n        pink: { key: 'pink', color: '#ee2080', opacity: 0.5, lineWidth: 10 },\n        white: { key: 'white', color: 'white', opacity: 1, lineWidth: 10 },\n      },\n      prevSvgHash: '',\n    },\n    hold: timer(),\n  };\n}\n", "import { State } from './state.js';\nimport { key2pos } from './util.js';\nimport { Drawable, DrawShape, DrawShapePiece, DrawBrush, DrawBrushes, DrawModifiers } from './draw.js';\nimport { SyncableShape, Hash } from './sync.js';\nimport * as cg from './types.js';\n\ntype CustomBrushes = Map<string, DrawBrush>; // by hash\ntype Svg = { el: SVGElement; isCustom?: boolean };\ntype AngleSlots = Set<number>; // arrow angle slots for label positioning\ntype ArrowDests = Map<cg.Key | undefined, AngleSlots>; // angle slots per dest\n\nconst hilites: { [name: string]: DrawBrush } = {\n  hilitePrimary: { key: 'hilitePrimary', color: '#3291ff', opacity: 1, lineWidth: 1 },\n  hiliteWhite: { key: 'hiliteWhite', color: '#ffffff', opacity: 1, lineWidth: 1 },\n};\n\nexport { createElement, setAttributes };\n\nexport function createDefs(): Element {\n  const defs = createElement('defs');\n  const filter = setAttributes(createElement('filter'), { id: 'cg-filter-blur' });\n  filter.appendChild(setAttributes(createElement('feGaussianBlur'), { stdDeviation: '0.019' }));\n  defs.appendChild(filter);\n  return defs;\n}\n\nexport function renderSvg(state: State, shapesEl: SVGElement, customsEl: SVGElement): void {\n  const d = state.drawable,\n    curD = d.current,\n    cur = curD && curD.mouseSq ? (curD as DrawShape) : undefined,\n    dests: ArrowDests = new Map(),\n    bounds = state.dom.bounds(),\n    nonPieceAutoShapes = d.autoShapes.filter(autoShape => !autoShape.piece);\n\n  for (const s of d.shapes.concat(nonPieceAutoShapes).concat(cur ? [cur] : [])) {\n    if (!s.dest) continue;\n    const sources = dests.get(s.dest) ?? new Set(),\n      from = pos2user(orient(key2pos(s.orig), state.orientation), bounds),\n      to = pos2user(orient(key2pos(s.dest), state.orientation), bounds);\n    sources.add(moveAngle(from, to));\n    dests.set(s.dest, sources);\n  }\n  const shapes: SyncableShape[] = d.shapes.concat(nonPieceAutoShapes).map((s: DrawShape) => {\n    return {\n      shape: s,\n      current: false,\n      hash: shapeHash(s, isShort(s.dest, dests), false, bounds),\n    };\n  });\n  if (cur)\n    shapes.push({\n      shape: cur,\n      current: true,\n      hash: shapeHash(cur, isShort(cur.dest, dests), true, bounds),\n    });\n\n  const fullHash = shapes.map(sc => sc.hash).join(';');\n  if (fullHash === state.drawable.prevSvgHash) return;\n  state.drawable.prevSvgHash = fullHash;\n\n  /*\n    -- DOM hierarchy --\n    <svg class=\"cg-shapes\">      (<= svg)\n      <defs>\n        ...(for brushes)...\n      </defs>\n      <g>\n        ...(for arrows and circles)...\n      </g>\n    </svg>\n    <svg class=\"cg-custom-svgs\"> (<= customSvg)\n      <g>\n        ...(for custom svgs)...\n      </g>\n    </svg>\n  */\n\n  const defsEl = shapesEl.querySelector('defs') as SVGElement;\n\n  syncDefs(d, shapes, defsEl);\n  syncShapes(shapes, shapesEl.querySelector('g')!, customsEl.querySelector('g')!, s =>\n    renderShape(state, s, d.brushes, dests, bounds),\n  );\n}\n\n// append only. Don't try to update/remove.\nfunction syncDefs(d: Drawable, shapes: SyncableShape[], defsEl: SVGElement) {\n  const brushes: CustomBrushes = new Map();\n  let brush: DrawBrush;\n  for (const s of shapes.filter(s => s.shape.dest && s.shape.brush)) {\n    brush = makeCustomBrush(d.brushes[s.shape.brush!], s.shape.modifiers);\n    if (s.shape.modifiers?.hilite) brushes.set(hilite(brush).key, hilite(brush));\n    brushes.set(brush.key, brush);\n  }\n  const keysInDom = new Set();\n  let el: SVGElement | undefined = defsEl.firstElementChild as SVGElement;\n  while (el) {\n    keysInDom.add(el.getAttribute('cgKey'));\n    el = el.nextElementSibling as SVGElement | undefined;\n  }\n  for (const [key, brush] of brushes.entries()) {\n    if (!keysInDom.has(key)) defsEl.appendChild(renderMarker(brush));\n  }\n}\n\nfunction syncShapes(\n  syncables: SyncableShape[],\n  shapes: Element,\n  customs: Element,\n  renderShape: (shape: SyncableShape) => Svg[],\n): void {\n  const hashesInDom = new Map();\n\n  for (const sc of syncables) hashesInDom.set(sc.hash, false);\n  for (const root of [shapes, customs]) {\n    const toRemove: SVGElement[] = [];\n    let el: SVGElement | undefined = root.firstElementChild as SVGElement,\n      elHash: Hash | null;\n    while (el) {\n      elHash = el.getAttribute('cgHash') as Hash;\n      if (hashesInDom.has(elHash)) hashesInDom.set(elHash, true);\n      else toRemove.push(el);\n      el = el.nextElementSibling as SVGElement | undefined;\n    }\n    for (const el of toRemove) root.removeChild(el);\n  }\n  // insert shapes that are not yet in dom\n  for (const sc of syncables.filter(s => !hashesInDom.get(s.hash))) {\n    for (const svg of renderShape(sc)) {\n      if (svg.isCustom) customs.appendChild(svg.el);\n      else shapes.appendChild(svg.el);\n    }\n  }\n}\n\nfunction shapeHash(\n  { orig, dest, brush, piece, modifiers, customSvg, label }: DrawShape,\n  shorten: boolean,\n  current: boolean,\n  bounds: DOMRectReadOnly,\n): Hash {\n  // a shape and an overlay svg share a lifetime and have the same cgHash attribute\n  return [\n    bounds.width,\n    bounds.height,\n    current,\n    orig,\n    dest,\n    brush,\n    shorten && '-',\n    piece && pieceHash(piece),\n    modifiers && modifiersHash(modifiers),\n    customSvg && `custom-${textHash(customSvg.html)},${customSvg.center?.[0] ?? 'o'}`,\n    label && `label-${textHash(label.text)}`,\n  ]\n    .filter(x => x)\n    .join(',');\n}\n\nfunction pieceHash(piece: DrawShapePiece): Hash {\n  return [piece.color, piece.role, piece.scale].filter(x => x).join(',');\n}\n\nfunction modifiersHash(m: DrawModifiers): Hash {\n  return [m.lineWidth, m.hilite && '*'].filter(x => x).join(',');\n}\n\nfunction textHash(s: string): Hash {\n  // Rolling hash with base 31 (cf. https://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript)\n  let h = 0;\n  for (let i = 0; i < s.length; i++) {\n    h = ((h << 5) - h + s.charCodeAt(i)) >>> 0;\n  }\n  return h.toString();\n}\n\nfunction renderShape(\n  state: State,\n  { shape, current, hash }: SyncableShape,\n  brushes: DrawBrushes,\n  dests: ArrowDests,\n  bounds: DOMRectReadOnly,\n): Svg[] {\n  const from = pos2user(orient(key2pos(shape.orig), state.orientation), bounds),\n    to = shape.dest ? pos2user(orient(key2pos(shape.dest), state.orientation), bounds) : from,\n    brush = shape.brush && makeCustomBrush(brushes[shape.brush], shape.modifiers),\n    slots = dests.get(shape.dest),\n    svgs: Svg[] = [];\n\n  if (brush) {\n    const el = setAttributes(createElement('g'), { cgHash: hash });\n    svgs.push({ el });\n\n    if (from[0] !== to[0] || from[1] !== to[1])\n      el.appendChild(renderArrow(shape, brush, from, to, current, isShort(shape.dest, dests)));\n    else el.appendChild(renderCircle(brushes[shape.brush!], from, current, bounds));\n  }\n  if (shape.label) {\n    const label = shape.label;\n    label.fill ??= shape.brush && brushes[shape.brush].color;\n    const corner = shape.brush ? undefined : 'tr';\n    svgs.push({ el: renderLabel(label, hash, from, to, slots, corner), isCustom: true });\n  }\n  if (shape.customSvg) {\n    const on = shape.customSvg.center ?? 'orig';\n    const [x, y] =\n      on === 'label' ? labelCoords(from, to, slots).map(c => c - 0.5) : on === 'dest' ? to : from;\n    const el = setAttributes(createElement('g'), { transform: `translate(${x},${y})`, cgHash: hash });\n    el.innerHTML = `<svg width=\"1\" height=\"1\" viewBox=\"0 0 100 100\">${shape.customSvg.html}</svg>`;\n    svgs.push({ el, isCustom: true });\n  }\n  return svgs;\n}\n\nfunction renderCircle(\n  brush: DrawBrush,\n  at: cg.NumberPair,\n  current: boolean,\n  bounds: DOMRectReadOnly,\n): SVGElement {\n  const widths = circleWidth(),\n    radius = (bounds.width + bounds.height) / (4 * Math.max(bounds.width, bounds.height));\n  return setAttributes(createElement('circle'), {\n    stroke: brush.color,\n    'stroke-width': widths[current ? 0 : 1],\n    fill: 'none',\n    opacity: opacity(brush, current),\n    cx: at[0],\n    cy: at[1],\n    r: radius - widths[1] / 2,\n  });\n}\n\nfunction hilite(brush: DrawBrush): DrawBrush {\n  return ['#ffffff', '#fff', 'white'].includes(brush.color)\n    ? hilites['hilitePrimary']\n    : hilites['hiliteWhite'];\n}\n\nfunction renderArrow(\n  s: DrawShape,\n  brush: DrawBrush,\n  from: cg.NumberPair,\n  to: cg.NumberPair,\n  current: boolean,\n  shorten: boolean,\n): SVGElement {\n  function renderLine(isHilite: boolean) {\n    const m = arrowMargin(shorten && !current),\n      dx = to[0] - from[0],\n      dy = to[1] - from[1],\n      angle = Math.atan2(dy, dx),\n      xo = Math.cos(angle) * m,\n      yo = Math.sin(angle) * m;\n    return setAttributes(createElement('line'), {\n      stroke: isHilite ? hilite(brush).color : brush.color,\n      'stroke-width': lineWidth(brush, current) + (isHilite ? 0.04 : 0),\n      'stroke-linecap': 'round',\n      'marker-end': `url(#arrowhead-${isHilite ? hilite(brush).key : brush.key})`,\n      opacity: s.modifiers?.hilite ? 1 : opacity(brush, current),\n      x1: from[0],\n      y1: from[1],\n      x2: to[0] - xo,\n      y2: to[1] - yo,\n    });\n  }\n  if (!s.modifiers?.hilite) return renderLine(false);\n\n  const g = createElement('g');\n  const blurred = setAttributes(createElement('g'), { filter: 'url(#cg-filter-blur)' });\n  blurred.appendChild(filterBox(from, to));\n  blurred.appendChild(renderLine(true));\n  g.appendChild(blurred);\n  g.appendChild(renderLine(false));\n  return g;\n}\n\nfunction renderMarker(brush: DrawBrush): SVGElement {\n  const marker = setAttributes(createElement('marker'), {\n    id: 'arrowhead-' + brush.key,\n    orient: 'auto',\n    overflow: 'visible',\n    markerWidth: 4,\n    markerHeight: 4,\n    refX: brush.key.startsWith('hilite') ? 1.86 : 2.05,\n    refY: 2,\n  });\n  marker.appendChild(\n    setAttributes(createElement('path'), {\n      d: 'M0,0 V4 L3,2 Z',\n      fill: brush.color,\n    }),\n  );\n  marker.setAttribute('cgKey', brush.key);\n  return marker;\n}\n\nfunction renderLabel(\n  label: { text: string; fill?: string },\n  hash: string,\n  from: cg.NumberPair,\n  to: cg.NumberPair,\n  slots?: AngleSlots,\n  corner?: 'tr',\n): SVGElement {\n  const labelSize = 0.4,\n    fontSize = labelSize * 0.75 ** label.text.length,\n    at = labelCoords(from, to, slots),\n    cornerOff = corner === 'tr' ? 0.4 : 0,\n    g = setAttributes(createElement('g'), {\n      transform: `translate(${at[0] + cornerOff},${at[1] - cornerOff})`,\n      cgHash: hash,\n    });\n  g.appendChild(\n    setAttributes(createElement('circle'), {\n      r: labelSize / 2,\n      'fill-opacity': corner ? 1.0 : 0.8,\n      'stroke-opacity': corner ? 1.0 : 0.7,\n      'stroke-width': 0.03,\n      fill: label.fill ?? '#666',\n      stroke: 'white',\n    }),\n  );\n  const labelEl = setAttributes(createElement('text'), {\n    'font-size': fontSize,\n    'font-family': 'Noto Sans',\n    'text-anchor': 'middle',\n    fill: 'white',\n    y: 0.13 * 0.75 ** label.text.length,\n  });\n  labelEl.innerHTML = label.text;\n  g.appendChild(labelEl);\n  return g;\n}\n\nfunction orient(pos: cg.Pos, color: cg.Color): cg.Pos {\n  return color === 'white' ? pos : [7 - pos[0], 7 - pos[1]];\n}\n\nfunction isShort(dest: cg.Key | undefined, dests: ArrowDests) {\n  return true === (dest && dests.has(dest) && dests.get(dest)!.size > 1);\n}\n\nfunction createElement(tagName: string): SVGElement {\n  return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n}\n\nfunction setAttributes(el: SVGElement, attrs: { [key: string]: any }): SVGElement {\n  for (const key in attrs) {\n    if (Object.prototype.hasOwnProperty.call(attrs, key)) el.setAttribute(key, attrs[key]);\n  }\n  return el;\n}\n\nfunction makeCustomBrush(base: DrawBrush, modifiers: DrawModifiers | undefined): DrawBrush {\n  return !modifiers\n    ? base\n    : {\n        color: base.color,\n        opacity: Math.round(base.opacity * 10) / 10,\n        lineWidth: Math.round(modifiers.lineWidth || base.lineWidth),\n        key: [base.key, modifiers.lineWidth].filter(x => x).join(''),\n      };\n}\n\nfunction circleWidth(): [number, number] {\n  return [3 / 64, 4 / 64];\n}\n\nfunction lineWidth(brush: DrawBrush, current: boolean): number {\n  return ((brush.lineWidth || 10) * (current ? 0.85 : 1)) / 64;\n}\n\nfunction opacity(brush: DrawBrush, current: boolean): number {\n  return (brush.opacity || 1) * (current ? 0.9 : 1);\n}\n\nfunction arrowMargin(shorten: boolean): number {\n  return (shorten ? 20 : 10) / 64;\n}\n\nfunction pos2user(pos: cg.Pos, bounds: DOMRectReadOnly): cg.NumberPair {\n  const xScale = Math.min(1, bounds.width / bounds.height);\n  const yScale = Math.min(1, bounds.height / bounds.width);\n  return [(pos[0] - 3.5) * xScale, (3.5 - pos[1]) * yScale];\n}\n\nfunction filterBox(from: cg.NumberPair, to: cg.NumberPair): SVGElement {\n  // lines/arrows are considered to be one dimensional for the purposes of SVG filters,\n  // so we add a transparent bounding box to ensure they apply to the 2nd dimension\n  const box = {\n    from: [Math.floor(Math.min(from[0], to[0])), Math.floor(Math.min(from[1], to[1]))],\n    to: [Math.ceil(Math.max(from[0], to[0])), Math.ceil(Math.max(from[1], to[1]))],\n  };\n  return setAttributes(createElement('rect'), {\n    x: box.from[0],\n    y: box.from[1],\n    width: box.to[0] - box.from[0],\n    height: box.to[1] - box.from[1],\n    fill: 'none',\n    stroke: 'none',\n  });\n}\n\nfunction moveAngle(from: cg.NumberPair, to: cg.NumberPair, asSlot = true) {\n  const angle = Math.atan2(to[1] - from[1], to[0] - from[0]) + Math.PI;\n  return asSlot ? (Math.round((angle * 8) / Math.PI) + 16) % 16 : angle;\n}\n\nfunction dist(from: cg.NumberPair, to: cg.NumberPair): number {\n  return Math.sqrt([from[0] - to[0], from[1] - to[1]].reduce((acc, x) => acc + x * x, 0));\n}\n\n/*\n try to place label at the junction of the destination shaft and arrowhead. if there's more than\n 1 arrow pointing to a square, the arrow shortens by 10 / 64 units so the label must move as well. \n \n if the angle between two incoming arrows is pi / 8, such as when an adjacent knight and bishop\n attack the same square, the knight's label is slid further down the shaft by an amount equal to\n our label size to avoid collision\n*/\n\nfunction labelCoords(from: cg.NumberPair, to: cg.NumberPair, slots?: AngleSlots): cg.NumberPair {\n  let mag = dist(from, to);\n  //if (mag === 0) return [from[0], from[1]];\n  const angle = moveAngle(from, to, false);\n  if (slots) {\n    mag -= 33 / 64; // reduce by arrowhead length\n    if (slots.size > 1) {\n      mag -= 10 / 64; // reduce by shortening factor\n      const slot = moveAngle(from, to);\n      if (slots.has((slot + 1) % 16) || slots.has((slot + 15) % 16)) {\n        if (slot & 1) mag -= 0.4;\n        // and by label size for the knight if another arrow is within pi / 8.\n      }\n    }\n  }\n  return [from[0] - Math.cos(angle) * mag, from[1] - Math.sin(angle) * mag].map(\n    c => c + 0.5,\n  ) as cg.NumberPair;\n}\n", "import { HeadlessState } from './state.js';\nimport { setVisible, createEl } from './util.js';\nimport { colors, files, ranks, Elements } from './types.js';\nimport { createElement as createSVG, setAttributes, createDefs } from './svg.js';\n\nexport function renderWrap(element: HTMLElement, s: HeadlessState): Elements {\n  // .cg-wrap (element passed to Chessground)\n  //   cg-container\n  //     cg-board\n  //     svg.cg-shapes\n  //       defs\n  //       g\n  //     svg.cg-custom-svgs\n  //       g\n  //     cg-auto-pieces\n  //     coords.ranks\n  //     coords.files\n  //     piece.ghost\n\n  element.innerHTML = '';\n\n  // ensure the cg-wrap class is set\n  // so bounds calculation can use the CSS width/height values\n  // add that class yourself to the element before calling chessground\n  // for a slight performance improvement! (avoids recomputing style)\n  element.classList.add('cg-wrap');\n\n  for (const c of colors) element.classList.toggle('orientation-' + c, s.orientation === c);\n  element.classList.toggle('manipulable', !s.viewOnly);\n\n  const container = createEl('cg-container');\n  element.appendChild(container);\n\n  const board = createEl('cg-board');\n  container.appendChild(board);\n\n  let svg: SVGElement | undefined;\n  let customSvg: SVGElement | undefined;\n  let autoPieces: HTMLElement | undefined;\n\n  if (s.drawable.visible) {\n    svg = setAttributes(createSVG('svg'), {\n      class: 'cg-shapes',\n      viewBox: '-4 -4 8 8',\n      preserveAspectRatio: 'xMidYMid slice',\n    });\n    svg.appendChild(createDefs());\n    svg.appendChild(createSVG('g'));\n\n    customSvg = setAttributes(createSVG('svg'), {\n      class: 'cg-custom-svgs',\n      viewBox: '-3.5 -3.5 8 8',\n      preserveAspectRatio: 'xMidYMid slice',\n    });\n    customSvg.appendChild(createSVG('g'));\n\n    autoPieces = createEl('cg-auto-pieces');\n\n    container.appendChild(svg);\n    container.appendChild(customSvg);\n    container.appendChild(autoPieces);\n  }\n\n  if (s.coordinates) {\n    const orientClass = s.orientation === 'black' ? ' black' : '';\n    const ranksPositionClass = s.ranksPosition === 'left' ? ' left' : '';\n\n    if (s.coordinatesOnSquares) {\n      const rankN: (i: number) => number = s.orientation === 'white' ? i => i + 1 : i => 8 - i;\n      files.forEach((f, i) =>\n        container.appendChild(\n          renderCoords(\n            ranks.map(r => f + r),\n            'squares rank' + rankN(i) + orientClass + ranksPositionClass,\n          ),\n        ),\n      );\n    } else {\n      container.appendChild(renderCoords(ranks, 'ranks' + orientClass + ranksPositionClass));\n      container.appendChild(renderCoords(files, 'files' + orientClass));\n    }\n  }\n\n  let ghost: HTMLElement | undefined;\n  if (s.draggable.enabled && s.draggable.showGhost) {\n    ghost = createEl('piece', 'ghost');\n    setVisible(ghost, false);\n    container.appendChild(ghost);\n  }\n\n  return {\n    board,\n    container,\n    wrap: element,\n    ghost,\n    svg,\n    customSvg,\n    autoPieces,\n  };\n}\n\nfunction renderCoords(elems: readonly string[], className: string): HTMLElement {\n  const el = createEl('coords', className);\n  let f: HTMLElement;\n  for (const elem of elems) {\n    f = createEl('coord');\n    f.textContent = elem;\n    el.appendChild(f);\n  }\n  return el;\n}\n", "import { State } from './state.js';\nimport * as cg from './types.js';\nimport * as board from './board.js';\nimport * as util from './util.js';\nimport { cancel as dragCancel } from './drag.js';\n\nexport function setDropMode(s: State, piece?: cg.Piece): void {\n  s.dropmode = {\n    active: true,\n    piece,\n  };\n  dragCancel(s);\n}\n\nexport function cancelDropMode(s: State): void {\n  s.dropmode = {\n    active: false,\n  };\n}\n\nexport function drop(s: State, e: cg.MouchEvent): void {\n  if (!s.dropmode.active) return;\n\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n\n  const piece = s.dropmode.piece;\n\n  if (piece) {\n    s.pieces.set('a0', piece);\n    const position = util.eventPosition(e);\n    const dest = position && board.getKeyAtDomPos(position, board.whitePov(s), s.dom.bounds());\n    if (dest) board.dropNewPiece(s, 'a0', dest);\n  }\n  s.dom.redraw();\n}\n", "import { State } from './state.js';\nimport * as drag from './drag.js';\nimport * as draw from './draw.js';\nimport { drop } from './drop.js';\nimport { isRightButton } from './util.js';\nimport * as cg from './types.js';\n\ntype MouchBind = (e: cg.MouchEvent) => void;\ntype StateMouchBind = (d: State, e: cg.MouchEvent) => void;\n\nexport function bindBoard(s: State, onResize: () => void): void {\n  const boardEl = s.dom.elements.board;\n\n  if ('ResizeObserver' in window) new ResizeObserver(onResize).observe(s.dom.elements.wrap);\n\n  if (s.disableContextMenu || s.drawable.enabled) {\n    boardEl.addEventListener('contextmenu', e => e.preventDefault());\n  }\n\n  if (s.viewOnly) return;\n\n  // Cannot be passive, because we prevent touch scrolling and dragging of\n  // selected elements.\n  const onStart = startDragOrDraw(s);\n  boardEl.addEventListener('touchstart', onStart as EventListener, {\n    passive: false,\n  });\n  boardEl.addEventListener('mousedown', onStart as EventListener, {\n    passive: false,\n  });\n}\n\n// returns the unbind function\nexport function bindDocument(s: State, onResize: () => void): cg.Unbind {\n  const unbinds: cg.Unbind[] = [];\n\n  // Old versions of Edge and Safari do not support ResizeObserver. Send\n  // chessground.resize if a user action has changed the bounds of the board.\n  if (!('ResizeObserver' in window)) unbinds.push(unbindable(document.body, 'chessground.resize', onResize));\n\n  if (!s.viewOnly) {\n    const onmove = dragOrDraw(s, drag.move, draw.move);\n    const onend = dragOrDraw(s, drag.end, draw.end);\n\n    for (const ev of ['touchmove', 'mousemove'])\n      unbinds.push(unbindable(document, ev, onmove as EventListener));\n    for (const ev of ['touchend', 'mouseup']) unbinds.push(unbindable(document, ev, onend as EventListener));\n\n    const onScroll = () => s.dom.bounds.clear();\n    unbinds.push(unbindable(document, 'scroll', onScroll, { capture: true, passive: true }));\n    unbinds.push(unbindable(window, 'resize', onScroll, { passive: true }));\n  }\n\n  return () => unbinds.forEach(f => f());\n}\n\nfunction unbindable(\n  el: EventTarget,\n  eventName: string,\n  callback: EventListener,\n  options?: AddEventListenerOptions,\n): cg.Unbind {\n  el.addEventListener(eventName, callback, options);\n  return () => el.removeEventListener(eventName, callback, options);\n}\n\nconst startDragOrDraw =\n  (s: State): MouchBind =>\n  e => {\n    if (s.draggable.current) drag.cancel(s);\n    else if (s.drawable.current) draw.cancel(s);\n    else if (e.shiftKey || isRightButton(e)) {\n      if (s.drawable.enabled) draw.start(s, e);\n    } else if (!s.viewOnly) {\n      if (s.dropmode.active) drop(s, e);\n      else drag.start(s, e);\n    }\n  };\n\nconst dragOrDraw =\n  (s: State, withDrag: StateMouchBind, withDraw: StateMouchBind): MouchBind =>\n  e => {\n    if (s.drawable.current) {\n      if (s.drawable.enabled) withDraw(s, e);\n    } else if (!s.viewOnly) withDrag(s, e);\n  };\n", "import { State } from './state.js';\nimport { key2pos, createEl, posToTranslate as posToTranslateFromBounds, translate } from './util.js';\nimport { whitePov } from './board.js';\nimport { AnimCurrent, AnimVectors, AnimVector, AnimFadings } from './anim.js';\nimport { DragCurrent } from './drag.js';\nimport * as cg from './types.js';\n\ntype PieceName = string; // `$color $role`\n\n// ported from https://github.com/lichess-org/lichobile/blob/master/src/chessground/render.ts\n// in case of bugs, blame @veloce\nexport function render(s: State): void {\n  const asWhite: boolean = whitePov(s),\n    posToTranslate = posToTranslateFromBounds(s.dom.bounds()),\n    boardEl: HTMLElement = s.dom.elements.board,\n    pieces: cg.Pieces = s.pieces,\n    curAnim: AnimCurrent | undefined = s.animation.current,\n    anims: AnimVectors = curAnim ? curAnim.plan.anims : new Map(),\n    fadings: AnimFadings = curAnim ? curAnim.plan.fadings : new Map(),\n    curDrag: DragCurrent | undefined = s.draggable.current,\n    squares: cg.SquareClasses = computeSquareClasses(s),\n    samePieces: Set<cg.Key> = new Set(),\n    sameSquares: Set<cg.Key> = new Set(),\n    movedPieces: Map<PieceName, cg.PieceNode[]> = new Map(),\n    movedSquares: Map<string, cg.SquareNode[]> = new Map(); // by class name\n  let k: cg.Key,\n    el: cg.PieceNode | cg.SquareNode | undefined,\n    pieceAtKey: cg.Piece | undefined,\n    elPieceName: PieceName,\n    anim: AnimVector | undefined,\n    fading: cg.Piece | undefined,\n    pMvdset: cg.PieceNode[] | undefined,\n    pMvd: cg.PieceNode | undefined,\n    sMvdset: cg.SquareNode[] | undefined,\n    sMvd: cg.SquareNode | undefined;\n\n  // walk over all board dom elements, apply animations and flag moved pieces\n  el = boardEl.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    k = el.cgKey;\n    if (isPieceNode(el)) {\n      pieceAtKey = pieces.get(k);\n      anim = anims.get(k);\n      fading = fadings.get(k);\n      elPieceName = el.cgPiece;\n      // if piece not being dragged anymore, remove dragging style\n      if (el.cgDragging && (!curDrag || curDrag.orig !== k)) {\n        el.classList.remove('dragging');\n        translate(el, posToTranslate(key2pos(k), asWhite));\n        el.cgDragging = false;\n      }\n      // remove fading class if it still remains\n      if (!fading && el.cgFading) {\n        el.cgFading = false;\n        el.classList.remove('fading');\n      }\n      // there is now a piece at this dom key\n      if (pieceAtKey) {\n        // continue animation if already animating and same piece\n        // (otherwise it could animate a captured piece)\n        if (anim && el.cgAnimating && elPieceName === pieceNameOf(pieceAtKey)) {\n          const pos = key2pos(k);\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n          el.classList.add('anim');\n          translate(el, posToTranslate(pos, asWhite));\n        } else if (el.cgAnimating) {\n          el.cgAnimating = false;\n          el.classList.remove('anim');\n          translate(el, posToTranslate(key2pos(k), asWhite));\n          if (s.addPieceZIndex) el.style.zIndex = posZIndex(key2pos(k), asWhite);\n        }\n        // same piece: flag as same\n        if (elPieceName === pieceNameOf(pieceAtKey) && (!fading || !el.cgFading)) {\n          samePieces.add(k);\n        }\n        // different piece: flag as moved unless it is a fading piece\n        else {\n          if (fading && elPieceName === pieceNameOf(fading)) {\n            el.classList.add('fading');\n            el.cgFading = true;\n          } else {\n            appendValue(movedPieces, elPieceName, el);\n          }\n        }\n      }\n      // no piece: flag as moved\n      else {\n        appendValue(movedPieces, elPieceName, el);\n      }\n    } else if (isSquareNode(el)) {\n      const cn = el.className;\n      if (squares.get(k) === cn) sameSquares.add(k);\n      else appendValue(movedSquares, cn, el);\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n\n  // walk over all squares in current set, apply dom changes to moved squares\n  // or append new squares\n  for (const [sk, className] of squares) {\n    if (!sameSquares.has(sk)) {\n      sMvdset = movedSquares.get(className);\n      sMvd = sMvdset && sMvdset.pop();\n      const translation = posToTranslate(key2pos(sk), asWhite);\n      if (sMvd) {\n        sMvd.cgKey = sk;\n        translate(sMvd, translation);\n      } else {\n        const squareNode = createEl('square', className) as cg.SquareNode;\n        squareNode.cgKey = sk;\n        translate(squareNode, translation);\n        boardEl.insertBefore(squareNode, boardEl.firstChild);\n      }\n    }\n  }\n\n  // walk over all pieces in current set, apply dom changes to moved pieces\n  // or append new pieces\n  for (const [k, p] of pieces) {\n    anim = anims.get(k);\n    if (!samePieces.has(k)) {\n      pMvdset = movedPieces.get(pieceNameOf(p));\n      pMvd = pMvdset && pMvdset.pop();\n      // a same piece was moved\n      if (pMvd) {\n        // apply dom changes\n        pMvd.cgKey = k;\n        if (pMvd.cgFading) {\n          pMvd.classList.remove('fading');\n          pMvd.cgFading = false;\n        }\n        const pos = key2pos(k);\n        if (s.addPieceZIndex) pMvd.style.zIndex = posZIndex(pos, asWhite);\n        if (anim) {\n          pMvd.cgAnimating = true;\n          pMvd.classList.add('anim');\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pMvd, posToTranslate(pos, asWhite));\n      }\n      // no piece in moved obj: insert the new piece\n      // assumes the new piece is not being dragged\n      else {\n        const pieceName = pieceNameOf(p),\n          pieceNode = createEl('piece', pieceName) as cg.PieceNode,\n          pos = key2pos(k);\n\n        pieceNode.cgPiece = pieceName;\n        pieceNode.cgKey = k;\n        if (anim) {\n          pieceNode.cgAnimating = true;\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pieceNode, posToTranslate(pos, asWhite));\n\n        if (s.addPieceZIndex) pieceNode.style.zIndex = posZIndex(pos, asWhite);\n\n        boardEl.appendChild(pieceNode);\n      }\n    }\n  }\n\n  // remove any element that remains in the moved sets\n  for (const nodes of movedPieces.values()) removeNodes(s, nodes);\n  for (const nodes of movedSquares.values()) removeNodes(s, nodes);\n}\n\nexport function renderResized(s: State): void {\n  const asWhite: boolean = whitePov(s),\n    posToTranslate = posToTranslateFromBounds(s.dom.bounds());\n  let el = s.dom.elements.board.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    if ((isPieceNode(el) && !el.cgAnimating) || isSquareNode(el)) {\n      translate(el, posToTranslate(key2pos(el.cgKey), asWhite));\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n}\n\nexport function updateBounds(s: State): void {\n  const bounds = s.dom.elements.wrap.getBoundingClientRect();\n  const container = s.dom.elements.container;\n  const ratio = bounds.height / bounds.width;\n  const width = (Math.floor((bounds.width * window.devicePixelRatio) / 8) * 8) / window.devicePixelRatio;\n  const height = width * ratio;\n  container.style.width = width + 'px';\n  container.style.height = height + 'px';\n  s.dom.bounds.clear();\n\n  s.addDimensionsCssVarsTo?.style.setProperty('---cg-width', width + 'px');\n  s.addDimensionsCssVarsTo?.style.setProperty('---cg-height', height + 'px');\n}\n\nconst isPieceNode = (el: cg.PieceNode | cg.SquareNode): el is cg.PieceNode => el.tagName === 'PIECE';\nconst isSquareNode = (el: cg.PieceNode | cg.SquareNode): el is cg.SquareNode => el.tagName === 'SQUARE';\n\nfunction removeNodes(s: State, nodes: HTMLElement[]): void {\n  for (const node of nodes) s.dom.elements.board.removeChild(node);\n}\n\nfunction posZIndex(pos: cg.Pos, asWhite: boolean): string {\n  const minZ = 3;\n  const rank = pos[1];\n  const z = asWhite ? minZ + 7 - rank : minZ + rank;\n\n  return `${z}`;\n}\n\nconst pieceNameOf = (piece: cg.Piece): string => `${piece.color} ${piece.role}`;\n\nfunction computeSquareClasses(s: State): cg.SquareClasses {\n  const squares: cg.SquareClasses = new Map();\n  if (s.lastMove && s.highlight.lastMove)\n    for (const k of s.lastMove) {\n      addSquare(squares, k, 'last-move');\n    }\n  if (s.check && s.highlight.check) addSquare(squares, s.check, 'check');\n  if (s.selected) {\n    addSquare(squares, s.selected, 'selected');\n    if (s.movable.showDests) {\n      const dests = s.movable.dests?.get(s.selected);\n      if (dests)\n        for (const k of dests) {\n          addSquare(squares, k, 'move-dest' + (s.pieces.has(k) ? ' oc' : ''));\n        }\n      const pDests = s.premovable.customDests?.get(s.selected) ?? s.premovable.dests;\n      if (pDests)\n        for (const k of pDests) {\n          addSquare(squares, k, 'premove-dest' + (s.pieces.has(k) ? ' oc' : ''));\n        }\n    }\n  }\n  const premove = s.premovable.current;\n  if (premove) for (const k of premove) addSquare(squares, k, 'current-premove');\n  else if (s.predroppable.current) addSquare(squares, s.predroppable.current.key, 'current-premove');\n\n  const o = s.exploding;\n  if (o) for (const k of o.keys) addSquare(squares, k, 'exploding' + o.stage);\n\n  if (s.highlight.custom) {\n    s.highlight.custom.forEach((v: string, k: cg.Key) => {\n      addSquare(squares, k, v);\n    });\n  }\n\n  return squares;\n}\n\nfunction addSquare(squares: cg.SquareClasses, key: cg.Key, klass: string): void {\n  const classes = squares.get(key);\n  if (classes) squares.set(key, `${classes} ${klass}`);\n  else squares.set(key, klass);\n}\n\nfunction appendValue<K, V>(map: Map<K, V[]>, key: K, value: V): void {\n  const arr = map.get(key);\n  if (arr) arr.push(value);\n  else map.set(key, [value]);\n}\n", "import { DrawShape } from './draw';\n\nexport interface SyncableShape {\n  shape: DrawShape;\n  current: boolean;\n  hash: Hash;\n}\n\nexport type Hash = string;\n\n// append and remove only. No updates.\nexport function syncShapes(\n  shapes: SyncableShape[],\n  root: HTMLElement | SVGElement,\n  renderShape: (shape: SyncableShape) => HTMLElement | SVGElement,\n): void {\n  const hashesInDom = new Map(), // by hash\n    toRemove: SVGElement[] = [];\n  for (const sc of shapes) hashesInDom.set(sc.hash, false);\n  let el: SVGElement | undefined = root.firstElementChild as SVGElement,\n    elHash: Hash | null;\n  while (el) {\n    elHash = el.getAttribute('cgHash') as Hash;\n    // found a shape element that's here to stay\n    if (hashesInDom.has(elHash)) hashesInDom.set(elHash, true);\n    // or remove it\n    else toRemove.push(el);\n    el = el.nextElementSibling as SVGElement | undefined;\n  }\n  // remove old shapes\n  for (const el of toRemove) root.removeChild(el);\n  // insert shapes that are not yet in dom\n  for (const sc of shapes) {\n    if (!hashesInDom.get(sc.hash)) root.appendChild(renderShape(sc));\n  }\n}\n", "import { State } from './state.js';\nimport { key2pos, createEl, posToTranslate as posToTranslateFromBounds, translateAndScale } from './util.js';\nimport { whitePov } from './board.js';\nimport * as cg from './types.js';\nimport { DrawShape } from './draw.js';\nimport { SyncableShape, Hash, syncShapes } from './sync.js';\n\nexport function render(state: State, autoPieceEl: HTMLElement): void {\n  const autoPieces = state.drawable.autoShapes.filter(autoShape => autoShape.piece);\n  const autoPieceShapes: SyncableShape[] = autoPieces.map((s: DrawShape) => {\n    return {\n      shape: s,\n      hash: hash(s),\n      current: false,\n    };\n  });\n\n  syncShapes(autoPieceShapes, autoPieceEl, shape => renderShape(state, shape, state.dom.bounds()));\n}\n\nexport function renderResized(state: State): void {\n  const asWhite: boolean = whitePov(state),\n    posToTranslate = posToTranslateFromBounds(state.dom.bounds());\n  let el = state.dom.elements.autoPieces?.firstChild as cg.PieceNode | undefined;\n  while (el) {\n    translateAndScale(el, posToTranslate(key2pos(el.cgKey), asWhite), el.cgScale);\n    el = el.nextSibling as cg.PieceNode | undefined;\n  }\n}\n\nfunction renderShape(state: State, { shape, hash }: SyncableShape, bounds: DOMRectReadOnly): cg.PieceNode {\n  const orig = shape.orig;\n  const role = shape.piece?.role;\n  const color = shape.piece?.color;\n  const scale = shape.piece?.scale;\n\n  const pieceEl = createEl('piece', `${role} ${color}`) as cg.PieceNode;\n  pieceEl.setAttribute('cgHash', hash);\n  pieceEl.cgKey = orig;\n  pieceEl.cgScale = scale;\n  translateAndScale(pieceEl, posToTranslateFromBounds(bounds)(key2pos(orig), whitePov(state)), scale);\n\n  return pieceEl;\n}\n\nconst hash = (autoPiece: DrawShape): Hash =>\n  [autoPiece.orig, autoPiece.piece?.role, autoPiece.piece?.color, autoPiece.piece?.scale].join(',');\n", "import { Api, start } from './api.js';\nimport { Config, configure } from './config.js';\nimport { HeadlessState, State, defaults } from './state.js';\n\nimport { renderWrap } from './wrap.js';\nimport * as events from './events.js';\nimport { render, renderResized, updateBounds } from './render.js';\nimport * as autoPieces from './autoPieces.js';\nimport * as svg from './svg.js';\nimport * as util from './util.js';\n\nexport function initModule({ el, config }: { el: HTMLElement; config?: Config }): Api {\n  return Chessground(el, config);\n}\n\nexport function Chessground(element: HTMLElement, config?: Config): Api {\n  const maybeState: State | HeadlessState = defaults();\n\n  configure(maybeState, config || {});\n\n  function redrawAll(): State {\n    const prevUnbind = 'dom' in maybeState ? maybeState.dom.unbind : undefined;\n    // compute bounds from existing board element if possible\n    // this allows non-square boards from CSS to be handled (for 3D)\n    const elements = renderWrap(element, maybeState),\n      bounds = util.memo(() => elements.board.getBoundingClientRect()),\n      redrawNow = (skipSvg?: boolean): void => {\n        render(state);\n        if (elements.autoPieces) autoPieces.render(state, elements.autoPieces);\n        if (!skipSvg && elements.svg) svg.renderSvg(state, elements.svg, elements.customSvg!);\n      },\n      onResize = (): void => {\n        updateBounds(state);\n        renderResized(state);\n        if (elements.autoPieces) autoPieces.renderResized(state);\n      };\n    const state = maybeState as State;\n    state.dom = {\n      elements,\n      bounds,\n      redraw: debounceRedraw(redrawNow),\n      redrawNow,\n      unbind: prevUnbind,\n    };\n    state.drawable.prevSvgHash = '';\n    updateBounds(state);\n    redrawNow(false);\n    events.bindBoard(state, onResize);\n    if (!prevUnbind) state.dom.unbind = events.bindDocument(state, onResize);\n    state.events.insert && state.events.insert(elements);\n    return state;\n  }\n\n  return start(redrawAll(), redrawAll);\n}\n\nfunction debounceRedraw(redrawNow: (skipSvg?: boolean) => void): () => void {\n  let redrawing = false;\n  return () => {\n    if (redrawing) return;\n    redrawing = true;\n    requestAnimationFrame(() => {\n      redrawNow();\n      redrawing = false;\n    });\n  };\n}\n", "// @generated by Peggy 4.2.0.\n//\n// https://peggyjs.org/\n\n\n\n  function rootNode(comment) {\n  \treturn comment !== null ? { comment, variations: [] } : { variations: []}\n  }\n\n  function node(move, suffix, nag, comment, variations) {\n  \tconst node = { move, variations }\n\n    if (suffix) {\n    \tnode.suffix = suffix\n    }\n\n    if (nag) {\n    \tnode.nag = nag\n    }\n\n    if (comment !== null) {\n    \tnode.comment = comment\n    }\n\n    return node\n  }\n\n  function lineToTree(...nodes) {\n  \tconst [root, ...rest] = nodes;\n\n    let parent = root\n\n    for (const child of rest) {\n    \tif (child !== null) {\n        \tparent.variations = [child, ...child.variations]\n            child.variations = []\n            parent = child\n        }\n    }\n\n  \treturn root\n  }\n\n  function pgn(headers, game) {\n  \tif (game.marker && game.marker.comment) {\n    \tlet node = game.root\n        while (true) {\n        \tconst next = node.variations[0]\n            if (!next) {\n            \tnode.comment = game.marker.comment\n            \tbreak\n            }\n            node = next\n        }\n    }\n\n  \treturn {\n    \theaders,\n        root: game.root,\n        result: (game.marker && game.marker.result) ?? undefined\n    }\n  }\n\nfunction peg$subclass(child, parent) {\n  function C() { this.constructor = child; }\n  C.prototype = parent.prototype;\n  child.prototype = new C();\n}\n\nfunction peg$SyntaxError(message, expected, found, location) {\n  var self = Error.call(this, message);\n  // istanbul ignore next Check is a necessary evil to support older environments\n  if (Object.setPrototypeOf) {\n    Object.setPrototypeOf(self, peg$SyntaxError.prototype);\n  }\n  self.expected = expected;\n  self.found = found;\n  self.location = location;\n  self.name = \"SyntaxError\";\n  return self;\n}\n\npeg$subclass(peg$SyntaxError, Error);\n\nfunction peg$padEnd(str, targetLength, padString) {\n  padString = padString || \" \";\n  if (str.length > targetLength) { return str; }\n  targetLength -= str.length;\n  padString += padString.repeat(targetLength);\n  return str + padString.slice(0, targetLength);\n}\n\npeg$SyntaxError.prototype.format = function(sources) {\n  var str = \"Error: \" + this.message;\n  if (this.location) {\n    var src = null;\n    var k;\n    for (k = 0; k < sources.length; k++) {\n      if (sources[k].source === this.location.source) {\n        src = sources[k].text.split(/\\r\\n|\\n|\\r/g);\n        break;\n      }\n    }\n    var s = this.location.start;\n    var offset_s = (this.location.source && (typeof this.location.source.offset === \"function\"))\n      ? this.location.source.offset(s)\n      : s;\n    var loc = this.location.source + \":\" + offset_s.line + \":\" + offset_s.column;\n    if (src) {\n      var e = this.location.end;\n      var filler = peg$padEnd(\"\", offset_s.line.toString().length, ' ');\n      var line = src[s.line - 1];\n      var last = s.line === e.line ? e.column : line.length + 1;\n      var hatLen = (last - s.column) || 1;\n      str += \"\\n --> \" + loc + \"\\n\"\n          + filler + \" |\\n\"\n          + offset_s.line + \" | \" + line + \"\\n\"\n          + filler + \" | \" + peg$padEnd(\"\", s.column - 1, ' ')\n          + peg$padEnd(\"\", hatLen, \"^\");\n    } else {\n      str += \"\\n at \" + loc;\n    }\n  }\n  return str;\n};\n\npeg$SyntaxError.buildMessage = function(expected, found) {\n  var DESCRIBE_EXPECTATION_FNS = {\n    literal: function(expectation) {\n      return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n    },\n\n    class: function(expectation) {\n      var escapedParts = expectation.parts.map(function(part) {\n        return Array.isArray(part)\n          ? classEscape(part[0]) + \"-\" + classEscape(part[1])\n          : classEscape(part);\n      });\n\n      return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts.join(\"\") + \"]\";\n    },\n\n    any: function() {\n      return \"any character\";\n    },\n\n    end: function() {\n      return \"end of input\";\n    },\n\n    other: function(expectation) {\n      return expectation.description;\n    }\n  };\n\n  function hex(ch) {\n    return ch.charCodeAt(0).toString(16).toUpperCase();\n  }\n\n  function literalEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\"/g,  \"\\\\\\\"\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function classEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\\]/g, \"\\\\]\")\n      .replace(/\\^/g, \"\\\\^\")\n      .replace(/-/g,  \"\\\\-\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function describeExpectation(expectation) {\n    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n  }\n\n  function describeExpected(expected) {\n    var descriptions = expected.map(describeExpectation);\n    var i, j;\n\n    descriptions.sort();\n\n    if (descriptions.length > 0) {\n      for (i = 1, j = 1; i < descriptions.length; i++) {\n        if (descriptions[i - 1] !== descriptions[i]) {\n          descriptions[j] = descriptions[i];\n          j++;\n        }\n      }\n      descriptions.length = j;\n    }\n\n    switch (descriptions.length) {\n      case 1:\n        return descriptions[0];\n\n      case 2:\n        return descriptions[0] + \" or \" + descriptions[1];\n\n      default:\n        return descriptions.slice(0, -1).join(\", \")\n          + \", or \"\n          + descriptions[descriptions.length - 1];\n    }\n  }\n\n  function describeFound(found) {\n    return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n  }\n\n  return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\n\nfunction peg$parse(input, options) {\n  options = options !== undefined ? options : {};\n\n  var peg$FAILED = {};\n  var peg$source = options.grammarSource;\n\n  var peg$startRuleFunctions = { pgn: peg$parsepgn };\n  var peg$startRuleFunction = peg$parsepgn;\n\n  var peg$c0 = \"[\";\n  var peg$c1 = \"\\\"\";\n  var peg$c2 = \"]\";\n  var peg$c3 = \".\";\n  var peg$c4 = \"O-O-O\";\n  var peg$c5 = \"O-O\";\n  var peg$c6 = \"0-0-0\";\n  var peg$c7 = \"0-0\";\n  var peg$c8 = \"$\";\n  var peg$c9 = \"{\";\n  var peg$c10 = \"}\";\n  var peg$c11 = \";\";\n  var peg$c12 = \"(\";\n  var peg$c13 = \")\";\n  var peg$c14 = \"1-0\";\n  var peg$c15 = \"0-1\";\n  var peg$c16 = \"1/2-1/2\";\n  var peg$c17 = \"*\";\n\n  var peg$r0 = /^[a-zA-Z]/;\n  var peg$r1 = /^[^\"]/;\n  var peg$r2 = /^[0-9]/;\n  var peg$r3 = /^[.]/;\n  var peg$r4 = /^[a-zA-Z1-8\\-=]/;\n  var peg$r5 = /^[+#]/;\n  var peg$r6 = /^[!?]/;\n  var peg$r7 = /^[^}]/;\n  var peg$r8 = /^[^\\r\\n]/;\n  var peg$r9 = /^[ \\t\\r\\n]/;\n\n  var peg$e0 = peg$otherExpectation(\"tag pair\");\n  var peg$e1 = peg$literalExpectation(\"[\", false);\n  var peg$e2 = peg$literalExpectation(\"\\\"\", false);\n  var peg$e3 = peg$literalExpectation(\"]\", false);\n  var peg$e4 = peg$otherExpectation(\"tag name\");\n  var peg$e5 = peg$classExpectation([[\"a\", \"z\"], [\"A\", \"Z\"]], false, false);\n  var peg$e6 = peg$otherExpectation(\"tag value\");\n  var peg$e7 = peg$classExpectation([\"\\\"\"], true, false);\n  var peg$e8 = peg$otherExpectation(\"move number\");\n  var peg$e9 = peg$classExpectation([[\"0\", \"9\"]], false, false);\n  var peg$e10 = peg$literalExpectation(\".\", false);\n  var peg$e11 = peg$classExpectation([\".\"], false, false);\n  var peg$e12 = peg$otherExpectation(\"standard algebraic notation\");\n  var peg$e13 = peg$literalExpectation(\"O-O-O\", false);\n  var peg$e14 = peg$literalExpectation(\"O-O\", false);\n  var peg$e15 = peg$literalExpectation(\"0-0-0\", false);\n  var peg$e16 = peg$literalExpectation(\"0-0\", false);\n  var peg$e17 = peg$classExpectation([[\"a\", \"z\"], [\"A\", \"Z\"], [\"1\", \"8\"], \"-\", \"=\"], false, false);\n  var peg$e18 = peg$classExpectation([\"+\", \"#\"], false, false);\n  var peg$e19 = peg$otherExpectation(\"suffix annotation\");\n  var peg$e20 = peg$classExpectation([\"!\", \"?\"], false, false);\n  var peg$e21 = peg$otherExpectation(\"NAG\");\n  var peg$e22 = peg$literalExpectation(\"$\", false);\n  var peg$e23 = peg$otherExpectation(\"brace comment\");\n  var peg$e24 = peg$literalExpectation(\"{\", false);\n  var peg$e25 = peg$classExpectation([\"}\"], true, false);\n  var peg$e26 = peg$literalExpectation(\"}\", false);\n  var peg$e27 = peg$otherExpectation(\"rest of line comment\");\n  var peg$e28 = peg$literalExpectation(\";\", false);\n  var peg$e29 = peg$classExpectation([\"\\r\", \"\\n\"], true, false);\n  var peg$e30 = peg$otherExpectation(\"variation\");\n  var peg$e31 = peg$literalExpectation(\"(\", false);\n  var peg$e32 = peg$literalExpectation(\")\", false);\n  var peg$e33 = peg$otherExpectation(\"game termination marker\");\n  var peg$e34 = peg$literalExpectation(\"1-0\", false);\n  var peg$e35 = peg$literalExpectation(\"0-1\", false);\n  var peg$e36 = peg$literalExpectation(\"1/2-1/2\", false);\n  var peg$e37 = peg$literalExpectation(\"*\", false);\n  var peg$e38 = peg$otherExpectation(\"whitespace\");\n  var peg$e39 = peg$classExpectation([\" \", \"\\t\", \"\\r\", \"\\n\"], false, false);\n\n  var peg$f0 = function(headers, game) { return pgn(headers, game) };\n  var peg$f1 = function(tagPairs) { return Object.fromEntries(tagPairs) };\n  var peg$f2 = function(tagName, tagValue) { return [tagName, tagValue] };\n  var peg$f3 = function(root, marker) { return { root, marker} };\n  var peg$f4 = function(comment, moves) { return lineToTree(rootNode(comment), ...moves.flat()) };\n  var peg$f5 = function(san, suffix, nag, comment, variations) { return node(san, suffix, nag, comment, variations) };\n  var peg$f6 = function(nag) { return nag };\n  var peg$f7 = function(comment) { return comment.replace(/[\\r\\n]+/g, \" \") };\n  var peg$f8 = function(comment) { return comment.trim() };\n  var peg$f9 = function(line) { return line };\n  var peg$f10 = function(result, comment) { return { result, comment } };\n  var peg$currPos = options.peg$currPos | 0;\n  var peg$savedPos = peg$currPos;\n  var peg$posDetailsCache = [{ line: 1, column: 1 }];\n  var peg$maxFailPos = peg$currPos;\n  var peg$maxFailExpected = options.peg$maxFailExpected || [];\n  var peg$silentFails = options.peg$silentFails | 0;\n\n  var peg$result;\n\n  if (options.startRule) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function text() {\n    return input.substring(peg$savedPos, peg$currPos);\n  }\n\n  function offset() {\n    return peg$savedPos;\n  }\n\n  function range() {\n    return {\n      source: peg$source,\n      start: peg$savedPos,\n      end: peg$currPos\n    };\n  }\n\n  function location() {\n    return peg$computeLocation(peg$savedPos, peg$currPos);\n  }\n\n  function expected(description, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildStructuredError(\n      [peg$otherExpectation(description)],\n      input.substring(peg$savedPos, peg$currPos),\n      location\n    );\n  }\n\n  function error(message, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildSimpleError(message, location);\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text: text, ignoreCase: ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase) {\n    return { type: \"class\", parts: parts, inverted: inverted, ignoreCase: ignoreCase };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description: description };\n  }\n\n  function peg$computePosDetails(pos) {\n    var details = peg$posDetailsCache[pos];\n    var p;\n\n    if (details) {\n      return details;\n    } else {\n      if (pos >= peg$posDetailsCache.length) {\n        p = peg$posDetailsCache.length - 1;\n      } else {\n        p = pos;\n        while (!peg$posDetailsCache[--p]) {}\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line: details.line,\n        column: details.column\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n\n      return details;\n    }\n  }\n\n  function peg$computeLocation(startPos, endPos, offset) {\n    var startPosDetails = peg$computePosDetails(startPos);\n    var endPosDetails = peg$computePosDetails(endPos);\n\n    var res = {\n      source: peg$source,\n      start: {\n        offset: startPos,\n        line: startPosDetails.line,\n        column: startPosDetails.column\n      },\n      end: {\n        offset: endPos,\n        line: endPosDetails.line,\n        column: endPosDetails.column\n      }\n    };\n    if (offset && peg$source && (typeof peg$source.offset === \"function\")) {\n      res.start = peg$source.offset(res.start);\n      res.end = peg$source.offset(res.end);\n    }\n    return res;\n  }\n\n  function peg$fail(expected) {\n    if (peg$currPos < peg$maxFailPos) { return; }\n\n    if (peg$currPos > peg$maxFailPos) {\n      peg$maxFailPos = peg$currPos;\n      peg$maxFailExpected = [];\n    }\n\n    peg$maxFailExpected.push(expected);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$parsepgn() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsetagPairSection();\n    s2 = peg$parsemoveTextSection();\n    peg$savedPos = s0;\n    s0 = peg$f0(s1, s2);\n\n    return s0;\n  }\n\n  function peg$parsetagPairSection() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsetagPair();\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = peg$parsetagPair();\n    }\n    s2 = peg$parse_();\n    peg$savedPos = s0;\n    s0 = peg$f1(s1);\n\n    return s0;\n  }\n\n  function peg$parsetagPair() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    if (input.charCodeAt(peg$currPos) === 91) {\n      s2 = peg$c0;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e1); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parse_();\n      s4 = peg$parsetagName();\n      if (s4 !== peg$FAILED) {\n        s5 = peg$parse_();\n        if (input.charCodeAt(peg$currPos) === 34) {\n          s6 = peg$c1;\n          peg$currPos++;\n        } else {\n          s6 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e2); }\n        }\n        if (s6 !== peg$FAILED) {\n          s7 = peg$parsetagValue();\n          if (input.charCodeAt(peg$currPos) === 34) {\n            s8 = peg$c1;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            s9 = peg$parse_();\n            if (input.charCodeAt(peg$currPos) === 93) {\n              s10 = peg$c2;\n              peg$currPos++;\n            } else {\n              s10 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$e3); }\n            }\n            if (s10 !== peg$FAILED) {\n              peg$savedPos = s0;\n              s0 = peg$f2(s4, s7);\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e0); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsetagName() {\n    var s0, s1, s2;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r0.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e5); }\n    }\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        s2 = input.charAt(peg$currPos);\n        if (peg$r0.test(s2)) {\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e5); }\n        }\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s0 = input.substring(s0, peg$currPos);\n    } else {\n      s0 = s1;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e4); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsetagValue() {\n    var s0, s1, s2;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r1.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e7); }\n    }\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = input.charAt(peg$currPos);\n      if (peg$r1.test(s2)) {\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e7); }\n      }\n    }\n    s0 = input.substring(s0, peg$currPos);\n    peg$silentFails--;\n    s1 = peg$FAILED;\n    if (peg$silentFails === 0) { peg$fail(peg$e6); }\n\n    return s0;\n  }\n\n  function peg$parsemoveTextSection() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = peg$parseline();\n    s2 = peg$parse_();\n    s3 = peg$parsegameTerminationMarker();\n    if (s3 === peg$FAILED) {\n      s3 = null;\n    }\n    s4 = peg$parse_();\n    peg$savedPos = s0;\n    s0 = peg$f3(s1, s3);\n\n    return s0;\n  }\n\n  function peg$parseline() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecomment();\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    s2 = [];\n    s3 = peg$parsemove();\n    while (s3 !== peg$FAILED) {\n      s2.push(s3);\n      s3 = peg$parsemove();\n    }\n    peg$savedPos = s0;\n    s0 = peg$f4(s1, s2);\n\n    return s0;\n  }\n\n  function peg$parsemove() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10;\n\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    s2 = peg$parsemoveNumber();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = peg$parse_();\n    s4 = peg$parsesan();\n    if (s4 !== peg$FAILED) {\n      s5 = peg$parsesuffixAnnotation();\n      if (s5 === peg$FAILED) {\n        s5 = null;\n      }\n      s6 = [];\n      s7 = peg$parsenag();\n      while (s7 !== peg$FAILED) {\n        s6.push(s7);\n        s7 = peg$parsenag();\n      }\n      s7 = peg$parse_();\n      s8 = peg$parsecomment();\n      if (s8 === peg$FAILED) {\n        s8 = null;\n      }\n      s9 = [];\n      s10 = peg$parsevariation();\n      while (s10 !== peg$FAILED) {\n        s9.push(s10);\n        s10 = peg$parsevariation();\n      }\n      peg$savedPos = s0;\n      s0 = peg$f5(s4, s5, s6, s8, s9);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsemoveNumber() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r2.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e9); }\n    }\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = input.charAt(peg$currPos);\n      if (peg$r2.test(s2)) {\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e9); }\n      }\n    }\n    if (input.charCodeAt(peg$currPos) === 46) {\n      s2 = peg$c3;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e10); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parse_();\n      s4 = [];\n      s5 = input.charAt(peg$currPos);\n      if (peg$r3.test(s5)) {\n        peg$currPos++;\n      } else {\n        s5 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e11); }\n      }\n      while (s5 !== peg$FAILED) {\n        s4.push(s5);\n        s5 = input.charAt(peg$currPos);\n        if (peg$r3.test(s5)) {\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e11); }\n        }\n      }\n      s1 = [s1, s2, s3, s4];\n      s0 = s1;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e8); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsesan() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c4) {\n      s2 = peg$c4;\n      peg$currPos += 5;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e13); }\n    }\n    if (s2 === peg$FAILED) {\n      if (input.substr(peg$currPos, 3) === peg$c5) {\n        s2 = peg$c5;\n        peg$currPos += 3;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e14); }\n      }\n      if (s2 === peg$FAILED) {\n        if (input.substr(peg$currPos, 5) === peg$c6) {\n          s2 = peg$c6;\n          peg$currPos += 5;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e15); }\n        }\n        if (s2 === peg$FAILED) {\n          if (input.substr(peg$currPos, 3) === peg$c7) {\n            s2 = peg$c7;\n            peg$currPos += 3;\n          } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e16); }\n          }\n          if (s2 === peg$FAILED) {\n            s2 = peg$currPos;\n            s3 = input.charAt(peg$currPos);\n            if (peg$r0.test(s3)) {\n              peg$currPos++;\n            } else {\n              s3 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$e5); }\n            }\n            if (s3 !== peg$FAILED) {\n              s4 = [];\n              s5 = input.charAt(peg$currPos);\n              if (peg$r4.test(s5)) {\n                peg$currPos++;\n              } else {\n                s5 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$e17); }\n              }\n              if (s5 !== peg$FAILED) {\n                while (s5 !== peg$FAILED) {\n                  s4.push(s5);\n                  s5 = input.charAt(peg$currPos);\n                  if (peg$r4.test(s5)) {\n                    peg$currPos++;\n                  } else {\n                    s5 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$e17); }\n                  }\n                }\n              } else {\n                s4 = peg$FAILED;\n              }\n              if (s4 !== peg$FAILED) {\n                s3 = [s3, s4];\n                s2 = s3;\n              } else {\n                peg$currPos = s2;\n                s2 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s2;\n              s2 = peg$FAILED;\n            }\n          }\n        }\n      }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = input.charAt(peg$currPos);\n      if (peg$r5.test(s3)) {\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e18); }\n      }\n      if (s3 === peg$FAILED) {\n        s3 = null;\n      }\n      s2 = [s2, s3];\n      s1 = s2;\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s0 = input.substring(s0, peg$currPos);\n    } else {\n      s0 = s1;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e12); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsesuffixAnnotation() {\n    var s0, s1, s2;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r6.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e20); }\n    }\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      if (s1.length >= 2) {\n        s2 = peg$FAILED;\n      } else {\n        s2 = input.charAt(peg$currPos);\n        if (peg$r6.test(s2)) {\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e20); }\n        }\n      }\n    }\n    if (s1.length < 1) {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    } else {\n      s0 = s1;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e19); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsenag() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    if (input.charCodeAt(peg$currPos) === 36) {\n      s2 = peg$c8;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e22); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$currPos;\n      s4 = [];\n      s5 = input.charAt(peg$currPos);\n      if (peg$r2.test(s5)) {\n        peg$currPos++;\n      } else {\n        s5 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e9); }\n      }\n      if (s5 !== peg$FAILED) {\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = input.charAt(peg$currPos);\n          if (peg$r2.test(s5)) {\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e9); }\n          }\n        }\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s3 = input.substring(s3, peg$currPos);\n      } else {\n        s3 = s4;\n      }\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f6(s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e21); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecomment() {\n    var s0;\n\n    s0 = peg$parsebraceComment();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parserestOfLineComment();\n    }\n\n    return s0;\n  }\n\n  function peg$parsebraceComment() {\n    var s0, s1, s2, s3, s4;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 123) {\n      s1 = peg$c9;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e24); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      s3 = [];\n      s4 = input.charAt(peg$currPos);\n      if (peg$r7.test(s4)) {\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e25); }\n      }\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        s4 = input.charAt(peg$currPos);\n        if (peg$r7.test(s4)) {\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e25); }\n        }\n      }\n      s2 = input.substring(s2, peg$currPos);\n      if (input.charCodeAt(peg$currPos) === 125) {\n        s3 = peg$c10;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e26); }\n      }\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f7(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e23); }\n    }\n\n    return s0;\n  }\n\n  function peg$parserestOfLineComment() {\n    var s0, s1, s2, s3, s4;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 59) {\n      s1 = peg$c11;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e28); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      s3 = [];\n      s4 = input.charAt(peg$currPos);\n      if (peg$r8.test(s4)) {\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e29); }\n      }\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        s4 = input.charAt(peg$currPos);\n        if (peg$r8.test(s4)) {\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e29); }\n        }\n      }\n      s2 = input.substring(s2, peg$currPos);\n      peg$savedPos = s0;\n      s0 = peg$f8(s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e27); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsevariation() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s2 = peg$c12;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e31); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parseline();\n      if (s3 !== peg$FAILED) {\n        s4 = peg$parse_();\n        if (input.charCodeAt(peg$currPos) === 41) {\n          s5 = peg$c13;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e32); }\n        }\n        if (s5 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f9(s3);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e30); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsegameTerminationMarker() {\n    var s0, s1, s2, s3;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 3) === peg$c14) {\n      s1 = peg$c14;\n      peg$currPos += 3;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e34); }\n    }\n    if (s1 === peg$FAILED) {\n      if (input.substr(peg$currPos, 3) === peg$c15) {\n        s1 = peg$c15;\n        peg$currPos += 3;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e35); }\n      }\n      if (s1 === peg$FAILED) {\n        if (input.substr(peg$currPos, 7) === peg$c16) {\n          s1 = peg$c16;\n          peg$currPos += 7;\n        } else {\n          s1 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e36); }\n        }\n        if (s1 === peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 42) {\n            s1 = peg$c17;\n            peg$currPos++;\n          } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e37); }\n          }\n        }\n      }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parse_();\n      s3 = peg$parsecomment();\n      if (s3 === peg$FAILED) {\n        s3 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f10(s1, s3);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e33); }\n    }\n\n    return s0;\n  }\n\n  function peg$parse_() {\n    var s0, s1;\n\n    peg$silentFails++;\n    s0 = [];\n    s1 = input.charAt(peg$currPos);\n    if (peg$r9.test(s1)) {\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e39); }\n    }\n    while (s1 !== peg$FAILED) {\n      s0.push(s1);\n      s1 = input.charAt(peg$currPos);\n      if (peg$r9.test(s1)) {\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e39); }\n      }\n    }\n    peg$silentFails--;\n    s1 = peg$FAILED;\n    if (peg$silentFails === 0) { peg$fail(peg$e38); }\n\n    return s0;\n  }\n\n  peg$result = peg$startRuleFunction();\n\n  if (options.peg$library) {\n    return /** @type {any} */ ({\n      peg$result,\n      peg$currPos,\n      peg$FAILED,\n      peg$maxFailExpected,\n      peg$maxFailPos\n    });\n  }\n  if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n    return peg$result;\n  } else {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$fail(peg$endExpectation());\n    }\n\n    throw peg$buildStructuredError(\n      peg$maxFailExpected,\n      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n      peg$maxFailPos < input.length\n        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n    );\n  }\n}\n\nconst peg$allowedStartRules = [\n  \"pgn\"\n];\n\nexport {\n  peg$allowedStartRules as StartRules,\n  peg$SyntaxError as SyntaxError,\n  peg$parse as parse\n};\n", null, "import { Chessground } from 'chessground';\nimport { Chess } from 'chess.js';\n\n/** Render a chess position into `container` using Chessground. */\nexport function mountBoard(container: HTMLElement, fen: string): void {\n  Chessground(container, {\n    fen,\n    coordinates: true,\n    animation: { enabled: false },\n    movable:    { free: false, color: undefined },   // \u0444\u0438\u0433\u0443\u0440\u044B \u043D\u0435 \u0434\u0432\u0438\u0433\u0430\u044E\u0442\u0441\u044F\n    draggable:  { enabled: false },\n    selectable: { enabled: false },\n    drawable: {\n      enabled: true,      // \u043F\u0440\u0430\u0432\u0430\u044F \u043A\u043D\u043E\u043F\u043A\u0430: \u0441\u0442\u0440\u0435\u043B\u043A\u0438 \u0438 \u043A\u0440\u0443\u0436\u043A\u0438\n      visible: true,\n      eraseOnClick: false,\n    },\n  });\n}\n\n/** Return true if the FEN string is syntactically valid. */\nexport function isValidFen(fen: string): boolean {\n  try {\n    new Chess(fen);\n    return true;\n  } catch {\n    return false;\n  }\n}\n", "import { navigate } from '../router';\nimport { game } from '../state';\nimport { saveGame } from '../storage';\nimport { mountBoard } from '../chessboard';\nimport { escHtml, sanitizeImageUrl } from '../utils';\n\n// \u2500\u2500 Module-level state \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nlet timerInterval: ReturnType<typeof setInterval> | null = null;\nlet timeLeft = 0;\nlet selectedPlayers = new Set<number>(); // indices into game.players\nlet answerShown = false;\nlet locked = false;\n\n// \u2500\u2500 Entry point \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nexport function render(container: HTMLElement): void {\n  if (!game?.cur) { navigate('game-board'); return; }\n\n  selectedPlayers = new Set();\n  answerShown = false;\n  locked = false;\n\n  const { catIdx, qIdx } = game.cur;\n  const cat = game.pack.categories[catIdx];\n  const q = cat.questions[qIdx];\n  const safeImage = q.image ? sanitizeImageUrl(q.image) : '';\n\n  container.innerHTML = `\n    <div class=\"flex flex-col items-center min-h-screen px-4 pt-6 pb-12\">\n\n      <!-- Category \u00B7 Value -->\n      <div class=\"text-center mb-3\">\n        <span class=\"text-gray-400 text-sm\">${escHtml(cat.name)}</span>\n        <span class=\"text-gray-400 text-sm\"> \u00B7 </span>\n        <span class=\"text-yellow-400 font-black\" style=\"font-size:2.5rem;vertical-align:middle\">\n          ${escHtml(q.value)}\n        </span>\n      </div>\n\n      <!-- Chess board -->\n      ${q.fen ? `<div class=\"cg-container mb-4\" id=\"cg-wrap\"></div>` : ''}\n\n      <!-- URL image -->\n      ${safeImage ? `\n        <div class=\"mb-4\">\n          <img src=\"${safeImage}\" alt=\"\"\n               class=\"rounded-xl\" style=\"max-width:min(100%,480px);max-height:320px\">\n        </div>` : ''}\n\n      <!-- Question text -->\n      <div class=\"font-bold text-center mb-5\"\n           style=\"font-size:1.5rem;max-width:580px;line-height:1.3\">\n        ${escHtml(q.question)}\n      </div>\n\n      <!-- Answer (hidden until revealed) -->\n      <div id=\"answer-block\"\n           class=\"hidden text-center mb-5 px-6 py-4 rounded-xl w-full\"\n           style=\"max-width:580px;background:#1f2937\">\n        <div class=\"text-gray-400 text-sm mb-1\">\u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442:</div>\n        <div class=\"font-semibold text-green-400\" style=\"font-size:1.15rem\">\n          ${escHtml(q.answer)}\n        </div>\n      </div>\n\n      <!-- Selection hint -->\n      <div id=\"hint\" class=\"text-gray-500 text-xs mb-2\">\n        \u041D\u0430\u0436\u043C\u0438 \u043D\u0430 \u0438\u0433\u0440\u043E\u043A\u0430 \u2014 \u0435\u043C\u0443 \u043D\u0430\u0447\u0438\u0441\u043B\u044F\u0442\u0441\u044F \u043E\u0447\u043A\u0438\n      </div>\n\n      <!-- Lock indicator -->\n      <div id=\"lock-badge\" class=\"hidden mb-2 px-3 py-1 rounded-full text-xs font-bold\"\n           style=\"background:#374151;color:#9ca3af\">\n        \uD83D\uDD12 \u0417\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u043E\n      </div>\n\n      <!-- Single row: players + timer + action buttons -->\n      <div class=\"flex gap-3 justify-center items-center flex-nowrap overflow-x-auto pb-1 w-full\">\n\n        <!-- Player buttons (injected by buildPlayerButtons) -->\n        <div id=\"player-btns\" class=\"flex gap-3 shrink-0\"></div>\n\n        <!-- Timer (inline, hidden by default) -->\n        <div id=\"q-timer\"\n             class=\"hidden text-yellow-400 font-black text-2xl bg-gray-800 px-5 py-3 rounded-xl min-w-[84px] text-center shrink-0\">\n        </div>\n\n        <button id=\"btn-show-answer\"\n          class=\"text-xl px-4 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 border-0 cursor-pointer text-white shrink-0\"\n          title=\"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442\">\uD83D\uDC41</button>\n\n        <button id=\"btn-confirm\"\n          class=\"hidden text-xl px-4 py-3 rounded-xl bg-green-700 hover:bg-green-600 border-0 cursor-pointer font-bold text-white shrink-0\"\n          title=\"\u0417\u0430\u0441\u0447\u0438\u0442\u0430\u0442\u044C\">\u2705</button>\n\n        <button id=\"btn-skip\"\n          class=\"hidden text-xl px-4 py-3 rounded-xl bg-yellow-600 hover:bg-yellow-500 border-0 cursor-pointer text-white shrink-0\"\n          title=\"\u041F\u0440\u043E\u043F\u0443\u0441\u0442\u0438\u0442\u044C\">\u23E9</button>\n\n        <button id=\"btn-back\"\n          class=\"text-xl px-4 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 border-0 cursor-pointer text-white shrink-0\"\n          title=\"\u041D\u0430\u0437\u0430\u0434 \u043A \u043F\u043E\u043B\u044E\">\u2B05</button>\n      </div>\n    </div>\n  `;\n\n  // Mount Chessground after element is in DOM\n  if (q.fen) {\n    mountBoard(container.querySelector<HTMLElement>('#cg-wrap')!, q.fen);\n  }\n\n  buildPlayerButtons(container);\n  attachActions(container, q.value);\n  startTimer(game.timerSecs, container);\n\n  // L / \u0414 key lock\n  const onKey = (e: KeyboardEvent) => {\n    if (e.key === 'l' || e.key === 'L' || e.key === '\u0434' || e.key === '\u0414') toggleLock(container);\n  };\n  document.addEventListener('keydown', onKey);\n  // Clean up listener when navigating away\n  (container as any).__cleanupKey = () => document.removeEventListener('keydown', onKey);\n}\n\n// \u2500\u2500 Player toggle buttons \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction buildPlayerButtons(container: HTMLElement): void {\n  const wrap = container.querySelector<HTMLElement>('#player-btns')!;\n  game!.players.forEach((p, i) => {\n    const btn = document.createElement('button');\n    btn.className = 'player-btn';\n    btn.dataset.idx = String(i);\n    btn.textContent = p.name;\n    btn.addEventListener('click', () => togglePlayer(i, container));\n    wrap.appendChild(btn);\n  });\n}\n\nfunction togglePlayer(idx: number, container: HTMLElement): void {\n  if (locked) return;\n  if (selectedPlayers.has(idx)) {\n    selectedPlayers.delete(idx);\n  } else {\n    selectedPlayers.add(idx);\n  }\n  updatePlayerButtons(container);\n  updateHint(container);\n  updateConfirmBtn(container);\n}\n\nfunction updatePlayerButtons(container: HTMLElement): void {\n  container.querySelectorAll<HTMLButtonElement>('#player-btns button').forEach(btn => {\n    const idx = Number(btn.dataset.idx);\n    if (selectedPlayers.has(idx)) {\n      btn.style.background = '#059669';\n      btn.style.borderColor = '#34d399';\n      btn.style.boxShadow = '0 0 0 3px rgba(52,211,153,0.35)';\n    } else {\n      btn.style.background = '';\n      btn.style.borderColor = '';\n      btn.style.boxShadow = '';\n    }\n  });\n}\n\nfunction updateHint(container: HTMLElement): void {\n  const hint = container.querySelector<HTMLElement>('#hint')!;\n  if (selectedPlayers.size === 0) {\n    hint.textContent = '\u041D\u0430\u0436\u043C\u0438 \u043D\u0430 \u0438\u0433\u0440\u043E\u043A\u0430 \u2014 \u0435\u043C\u0443 \u043D\u0430\u0447\u0438\u0441\u043B\u044F\u0442\u0441\u044F \u043E\u0447\u043A\u0438';\n  } else {\n    const names = [...selectedPlayers].map(i => game!.players[i].name).join(', ');\n    hint.textContent = `\u041E\u0447\u043A\u0438 \u043F\u043E\u043B\u0443\u0447\u0430\u0442: ${names}`;\n    hint.style.color = '#34d399';\n  }\n}\n\nfunction updateConfirmBtn(container: HTMLElement): void {\n  const btn = container.querySelector<HTMLButtonElement>('#btn-confirm')!;\n  btn.classList.toggle('hidden', selectedPlayers.size === 0);\n}\n\n// \u2500\u2500 Action buttons \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction attachActions(container: HTMLElement, value: number): void {\n  container.querySelector('#btn-show-answer')!.addEventListener('click', () => {\n    if (locked) return;\n    revealAnswer(container);\n  });\n\n  container.querySelector('#btn-confirm')!.addEventListener('click', () => {\n    if (locked || selectedPlayers.size === 0) return;\n    stopTimer();\n    selectedPlayers.forEach(i => { game!.players[i].score += value; });\n    markAnswered();\n    cleanup(container);\n    navigate('game-board');\n  });\n\n  container.querySelector('#btn-skip')!.addEventListener('click', () => {\n    if (locked) return;\n    stopTimer();\n    markAnswered();\n    cleanup(container);\n    navigate('game-board');\n  });\n\n  // Back = PEEK: go back WITHOUT marking as answered\n  container.querySelector('#btn-back')!.addEventListener('click', () => {\n    if (locked) return;\n    stopTimer();\n    cleanup(container);\n    navigate('game-board');\n  });\n}\n\nfunction revealAnswer(container: HTMLElement): void {\n  answerShown = true;\n  container.querySelector('#answer-block')!.classList.remove('hidden');\n  container.querySelector('#btn-show-answer')!.classList.add('hidden');\n  container.querySelector('#btn-skip')!.classList.remove('hidden');\n  stopTimer();\n}\n\n// \u2500\u2500 Timer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction startTimer(secs: number, container: HTMLElement): void {\n  stopTimer();\n  if (secs <= 0) return;\n  timeLeft = secs;\n  const el = container.querySelector<HTMLElement>('#q-timer')!;\n  el.classList.remove('hidden');\n  el.style.color = '#ffd600';\n  el.textContent = formatTime(timeLeft);\n\n  timerInterval = setInterval(() => {\n    timeLeft--;\n    el.textContent = timeLeft > 0 ? formatTime(timeLeft) : '\u23F0';\n    if (timeLeft <= 5 && timeLeft > 0) el.style.color = '#f87171';\n    if (timeLeft <= 0) {\n      stopTimer();\n      // Auto-reveal answer and show skip\n      if (!answerShown) revealAnswer(container);\n    }\n  }, 1000);\n}\n\nfunction stopTimer(): void {\n  if (timerInterval !== null) { clearInterval(timerInterval); timerInterval = null; }\n}\n\nfunction formatTime(s: number): string {\n  const m = Math.floor(s / 60);\n  const sec = s % 60;\n  return m > 0 ? `${m}:${String(sec).padStart(2, '0')}` : String(s);\n}\n\n// \u2500\u2500 Lock \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction toggleLock(container: HTMLElement): void {\n  locked = !locked;\n  const badge = container.querySelector<HTMLElement>('#lock-badge')!;\n  badge.classList.toggle('hidden', !locked);\n  // Dim interactive buttons when locked\n  ['#btn-show-answer', '#btn-confirm', '#btn-skip', '#btn-back', '#player-btns'].forEach(sel => {\n    const el = container.querySelector<HTMLElement>(sel);\n    if (el) el.style.opacity = locked ? '0.4' : '1';\n  });\n}\n\n// \u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction markAnswered(): void {\n  if (!game?.cur) return;\n  const key = `${game.cur.catIdx}-${game.cur.qIdx}`;\n  game.answered.add(key);\n  game.cur = null;\n  saveGame(game);\n\n  // Check if all questions are answered \u2192 results\n  const total = game.pack.categories.reduce((s, c) => s + c.questions.length, 0);\n  if (game.answered.size >= total) navigate('results');\n}\n\nfunction cleanup(container: HTMLElement): void {\n  stopTimer();\n  // Remove keydown listener\n  const fn = (container as any).__cleanupKey;\n  if (fn) { fn(); delete (container as any).__cleanupKey; }\n}\n", "import { navigate } from '../router';\nimport { game } from '../state';\nimport { deleteSave } from '../storage';\nimport { escHtml } from '../utils';\n\nexport function render(container: HTMLElement): void {\n  // Delete the completed game save\n  if (game?.id) deleteSave(game.id);\n\n  const players = (game?.players ?? []).slice().sort((a, b) => b.score - a.score);\n  const maxScore = players[0]?.score ?? 0;\n\n  container.innerHTML = `\n    <div class=\"flex flex-col items-center justify-center min-h-screen p-8\">\n      <h2 class=\"font-black text-yellow-400 mb-8\" style=\"font-size:2.5rem\">\u0418\u0442\u043E\u0433\u0438 \u0438\u0433\u0440\u044B</h2>\n\n      <div class=\"flex flex-col gap-3 mb-8 w-full\" style=\"max-width:420px\">\n        ${players.map((p, i) => {\n          const isWinner = p.score === maxScore && p.score > 0;\n          const medal = isWinner ? '\uD83D\uDC51' : (i === 0 ? '' : i === 1 ? '\uD83E\uDD48' : i === 2 ? '\uD83E\uDD49' : '');\n          return `\n            <div class=\"flex items-center gap-4 rounded-xl px-5 py-4\"\n                 style=\"background:${isWinner ? '#1e3a22' : '#1f2937'};\n                        ${isWinner ? 'border:1px solid #16a34a' : ''}\">\n              <span style=\"font-size:1.8rem;min-width:2rem\">${medal}</span>\n              <span class=\"flex-1 font-semibold\" style=\"font-size:1.1rem\">${escHtml(p.name)}</span>\n              <span class=\"font-black\" style=\"font-size:1.4rem;color:${p.score >= 0 ? '#ffd600' : '#f87171'}\">\n                ${p.score}\n              </span>\n            </div>\n          `;\n        }).join('')}\n      </div>\n\n      <div class=\"flex gap-3 flex-wrap justify-center\">\n        <button id=\"btn-restart\"\n          class=\"px-7 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl border-0\n                 text-white font-bold text-base cursor-pointer transition-colors\">\n          \u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430\n        </button>\n        <button id=\"btn-home\"\n          class=\"px-7 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl border-0\n                 text-white font-bold text-base cursor-pointer transition-colors\">\n          \u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E\n        </button>\n      </div>\n    </div>\n  `;\n\n  container.querySelector('#btn-restart')!.addEventListener('click', () => navigate('setup'));\n  container.querySelector('#btn-home')!.addEventListener('click', () => navigate('home'));\n}\n", "import { navigate } from '../router';\nimport { setSelectedPackIdx, BUILTIN_PACK_COUNT } from '../state';\nimport {\n  loadStoredPacks, upsertStoredPack, deleteStoredPack,\n} from '../storage';\nimport { Pack, Category, Question } from '../types';\nimport { isValidFen } from '../chessboard';\nimport { escHtml } from '../utils';\nimport { showAlert, showConfirm } from '../modal';\n\n// \u2500\u2500 State \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nlet editPack: Pack     = emptyPack();\nlet editIdx:  number   = -1;   // -1 = new pack\n\nfunction emptyPack(): Pack {\n  return {\n    title: '',\n    categories: [{ name: '', questions: [{ value: 100, question: '', answer: '' }] }],\n  };\n}\n\n// \u2500\u2500 Entry point \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nexport function render(container: HTMLElement): void {\n  renderPackList(container);\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n//  VIEW 1: Pack list\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction renderPackList(container: HTMLElement): void {\n  const stored = loadStoredPacks();\n\n  container.innerHTML = `\n    <div class=\"min-h-screen p-6\" style=\"max-width:820px;margin:0 auto\">\n\n      <div class=\"flex justify-between items-center mb-6\">\n        <h2 class=\"text-2xl font-bold\">\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</h2>\n        <button id=\"btn-back\"\n          class=\"text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer\">\n          \u2190 \u041D\u0430\u0437\u0430\u0434\n        </button>\n      </div>\n\n      <div class=\"flex gap-3 mb-6 flex-wrap\">\n        <button id=\"btn-new-pack\"\n          class=\"px-4 py-2.5 bg-blue-600 hover:bg-blue-500 rounded-xl border-0 text-white\n                 font-bold text-sm cursor-pointer transition-colors\">\n          + \u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440\n        </button>\n        <button id=\"btn-import-list\"\n          class=\"px-4 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-xl border-0 text-white\n                 text-sm cursor-pointer transition-colors\">\n          \u0418\u043C\u043F\u043E\u0440\u0442 JSON\n        </button>\n        <input type=\"file\" id=\"file-input-list\" accept=\".json\" class=\"hidden\" />\n      </div>\n\n      <div id=\"pack-list\" class=\"space-y-2\">\n        ${stored.length === 0\n          ? `<p class=\"text-gray-500 text-center py-8\">\n               \u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D\u043D\u044B\u0445 \u043D\u0430\u0431\u043E\u0440\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043D\u043E\u0432\u044B\u0439 \u0438\u043B\u0438 \u0438\u043C\u043F\u043E\u0440\u0442\u0438\u0440\u0443\u0439\u0442\u0435 JSON.\n             </p>`\n          : stored.map((p, i) => `\n              <div class=\"bg-gray-800 rounded-xl p-4 flex items-center justify-between gap-4\">\n                <div class=\"min-w-0\">\n                  <div class=\"font-bold text-base truncate\">${escHtml(p.title || '\u0411\u0435\u0437 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F')}</div>\n                  <div class=\"text-gray-400 text-sm\">\n                    ${p.categories.length} \u043A\u0430\u0442. /\n                    ${p.categories.reduce((s, c) => s + c.questions.length, 0)} \u0432\u043E\u043F\u0440.\n                  </div>\n                </div>\n                <div class=\"flex gap-2 shrink-0\">\n                  <button data-edit=\"${i}\"\n                    class=\"bg-blue-600 hover:bg-blue-500 px-3 py-2 rounded-lg text-sm\n                           border-0 cursor-pointer text-white transition-colors\">\u0420\u0435\u0434.</button>\n                  <button data-export=\"${i}\"\n                    class=\"bg-gray-600 hover:bg-gray-500 px-3 py-2 rounded-lg text-sm\n                           border-0 cursor-pointer text-white transition-colors\">JSON</button>\n                  <button data-del=\"${i}\"\n                    class=\"bg-red-700/80 hover:bg-red-600 px-3 py-2 rounded-lg text-sm\n                           border-0 cursor-pointer text-white transition-colors\">\u0423\u0434.</button>\n                </div>\n              </div>\n            `).join('')\n        }\n      </div>\n    </div>\n  `;\n\n  container.querySelector('#btn-back')!.addEventListener('click', () => navigate('home'));\n\n  container.querySelector('#btn-new-pack')!.addEventListener('click', () => {\n    editPack = emptyPack();\n    editIdx  = -1;\n    renderPackEditor(container);\n  });\n\n  container.querySelector('#btn-import-list')!.addEventListener('click', () => {\n    container.querySelector<HTMLInputElement>('#file-input-list')!.click();\n  });\n\n  container.querySelector<HTMLInputElement>('#file-input-list')!.addEventListener('change', e => {\n    const file = (e.target as HTMLInputElement).files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      try {\n        const pack = JSON.parse(reader.result as string) as Pack;\n        if (!pack.title || !Array.isArray(pack.categories))\n          throw new Error('\u041D\u0435\u0442 \u043F\u043E\u043B\u0435\u0439 title/categories');\n        editPack = pack;\n        editIdx  = -1;\n        renderPackEditor(container);\n      } catch (err) {\n        showAlert(`\u041E\u0448\u0438\u0431\u043A\u0430 JSON: ${(err as Error).message}`);\n      }\n    };\n    reader.readAsText(file);\n    (e.target as HTMLInputElement).value = '';\n  });\n\n  container.querySelectorAll<HTMLButtonElement>('[data-edit]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = +btn.dataset.edit!;\n      editPack = JSON.parse(JSON.stringify(loadStoredPacks()[i]));\n      editIdx  = i;\n      renderPackEditor(container);\n    });\n  });\n\n  container.querySelectorAll<HTMLButtonElement>('[data-export]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const pack = loadStoredPacks()[+btn.dataset.export!];\n      downloadJson(pack);\n    });\n  });\n\n  container.querySelectorAll<HTMLButtonElement>('[data-del]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      showConfirm('\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440?', () => {\n        deleteStoredPack(+btn.dataset.del!);\n        renderPackList(container);\n      }, { confirmLabel: '\u0423\u0434\u0430\u043B\u0438\u0442\u044C' });\n    });\n  });\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n//  VIEW 2: Pack editor\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction renderPackEditor(container: HTMLElement): void {\n  container.innerHTML = `\n    <div class=\"min-h-screen p-6\" style=\"max-width:820px;margin:0 auto\">\n\n      <div class=\"flex justify-between items-center mb-6\">\n        <h2 class=\"text-2xl font-bold\">\n          ${editIdx >= 0 ? '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430' : '\u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440'}\n        </h2>\n        <button id=\"btn-to-list\"\n          class=\"text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer\">\n          \u2190 \u041A \u0441\u043F\u0438\u0441\u043A\u0443\n        </button>\n      </div>\n\n      <!-- Pack title -->\n      <div class=\"mb-4\">\n        <label class=\"block text-sm text-gray-400 mb-1\">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430</label>\n        <input id=\"pack-title\" type=\"text\" value=\"${escHtml(editPack.title)}\"\n          class=\"w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white\n                 focus:border-blue-500 focus:outline-none\"\n          placeholder=\"\u041D\u0430\u043F\u0440\u0438\u043C\u0435\u0440: \u0428\u0430\u0445\u043C\u0430\u0442\u043D\u044B\u0435 \u0437\u0430\u0434\u0430\u0447\u0438\" />\n      </div>\n\n      <!-- Categories -->\n      <div id=\"categories-container\" class=\"space-y-4 mb-4\"></div>\n\n      <!-- Add category -->\n      <button id=\"btn-add-cat\"\n        class=\"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg border-0 text-white\n               text-sm cursor-pointer mb-6 transition-colors\">\n        + \u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\n      </button>\n\n      <!-- Bottom actions -->\n      <div class=\"flex gap-3 pt-4 border-t border-gray-800 flex-wrap\">\n        <button id=\"btn-save\"\n          class=\"px-6 py-3 bg-emerald-600 hover:bg-emerald-500 rounded-xl border-0 text-white\n                 font-bold cursor-pointer transition-colors\">\n          \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C\n        </button>\n        <button id=\"btn-play\"\n          class=\"px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-xl border-0 text-white\n                 font-bold cursor-pointer transition-colors\">\n          \u25B6 \u0418\u0433\u0440\u0430\u0442\u044C\n        </button>\n        <button id=\"btn-export-pack\"\n          class=\"px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl border-0 text-white\n                 font-bold cursor-pointer transition-colors\">\n          \u0421\u043A\u0430\u0447\u0430\u0442\u044C JSON\n        </button>\n        <button id=\"btn-cancel\"\n          class=\"px-6 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl border-0 text-white\n                 cursor-pointer transition-colors\">\n          \u041E\u0442\u043C\u0435\u043D\u0430\n        </button>\n      </div>\n\n      <div id=\"status\" class=\"mt-3 text-sm\"></div>\n    </div>\n  `;\n\n  renderCategories(container);\n\n  container.querySelector<HTMLInputElement>('#pack-title')!.addEventListener('input', e => {\n    editPack.title = (e.target as HTMLInputElement).value;\n  });\n\n  container.querySelector('#btn-to-list')!.addEventListener('click', () =>\n    renderPackList(container));\n\n  container.querySelector('#btn-add-cat')!.addEventListener('click', () => {\n    editPack.categories.push({ name: '', questions: [{ value: 100, question: '', answer: '' }] });\n    renderCategories(container);\n  });\n\n  container.querySelector('#btn-save')!.addEventListener('click', () => {\n    const err = validatePack(editPack);\n    if (err) { showStatus(container, `\u2717 ${err}`, false); return; }\n    upsertStoredPack(editPack, editIdx >= 0 ? editIdx : undefined);\n    if (editIdx < 0) {\n      editIdx = loadStoredPacks().length - 1;\n    }\n    showStatus(container, '\u2713 \u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043E', true);\n  });\n\n  container.querySelector('#btn-play')!.addEventListener('click', () => {\n    const err = validatePack(editPack);\n    if (err) { showStatus(container, `\u2717 ${err}`, false); return; }\n    // Save first, then navigate \u2014 setup will call refreshPacks() on render\n    upsertStoredPack(editPack, editIdx >= 0 ? editIdx : undefined);\n    const stored = loadStoredPacks();\n    const storedIdx = editIdx >= 0 ? editIdx : stored.length - 1;\n    setSelectedPackIdx(BUILTIN_PACK_COUNT + storedIdx);\n    navigate('setup');\n  });\n\n  container.querySelector('#btn-export-pack')!.addEventListener('click', () => {\n    const err = validatePack(editPack);\n    if (err) { showStatus(container, `\u2717 ${err}`, false); return; }\n    downloadJson(editPack);\n  });\n\n  container.querySelector('#btn-cancel')!.addEventListener('click', () =>\n    renderPackList(container));\n}\n\n// \u2500\u2500 Categories render \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction renderCategories(container: HTMLElement): void {\n  const cont = container.querySelector<HTMLElement>('#categories-container')!;\n  cont.innerHTML = editPack.categories.map((cat, ci) => buildCategoryHtml(cat, ci)).join('');\n  attachCategoryEvents(container);\n}\n\nfunction buildCategoryHtml(cat: Category, ci: number): string {\n  return `\n    <div class=\"rounded-xl p-4 space-y-3\"\n         style=\"background:rgba(31,41,55,0.5);border:1px solid rgba(55,65,81,0.5)\">\n\n      <div class=\"flex items-center gap-3\">\n        <input data-cat-name=\"${ci}\" type=\"text\" value=\"${escHtml(cat.name)}\"\n          class=\"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white font-bold\n                 focus:border-blue-500 focus:outline-none\"\n          placeholder=\"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438\" />\n        <button data-remove-cat=\"${ci}\"\n          class=\"text-red-400 hover:text-red-300 bg-transparent border-0 cursor-pointer\n                 text-sm transition-colors whitespace-nowrap\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</button>\n      </div>\n\n      <div data-questions=\"${ci}\" class=\"space-y-2\">\n        ${cat.questions.map((q, qi) => buildQuestionHtml(cat, q, ci, qi)).join('')}\n      </div>\n\n      <button data-add-q=\"${ci}\"\n        class=\"text-sm text-blue-400 hover:text-blue-300 bg-transparent border-0\n               cursor-pointer transition-colors\">+ \u0412\u043E\u043F\u0440\u043E\u0441</button>\n    </div>\n  `;\n}\n\nfunction buildQuestionHtml(cat: Category, q: Question, ci: number, qi: number): string {\n  return `\n    <div class=\"rounded-lg p-3 space-y-2\" style=\"background:rgba(17,24,39,0.6)\">\n      <div class=\"flex gap-2 items-center\">\n        <div class=\"flex flex-col gap-0.5 shrink-0\">\n          <button data-move-up=\"${ci}-${qi}\" ${qi === 0 ? 'disabled' : ''}\n            class=\"text-gray-400 hover:text-white text-xs leading-none px-1\n                   disabled:opacity-20 cursor-pointer bg-transparent border-0 transition-colors\">\u25B2</button>\n          <button data-move-down=\"${ci}-${qi}\" ${qi === cat.questions.length - 1 ? 'disabled' : ''}\n            class=\"text-gray-400 hover:text-white text-xs leading-none px-1\n                   disabled:opacity-20 cursor-pointer bg-transparent border-0 transition-colors\">\u25BC</button>\n        </div>\n        <input data-q-value=\"${ci}-${qi}\" type=\"number\" value=\"${q.value}\" step=\"100\" min=\"0\"\n          class=\"w-24 bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-yellow-400\n                 text-center font-bold focus:border-blue-500 focus:outline-none\" />\n        <input data-q-question=\"${ci}-${qi}\" type=\"text\" value=\"${escHtml(q.question)}\"\n          class=\"flex-1 bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-white\n                 focus:border-blue-500 focus:outline-none\"\n          placeholder=\"\u0412\u043E\u043F\u0440\u043E\u0441\" />\n        <button data-duplicate-q=\"${ci}-${qi}\"\n          class=\"text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer\n                 text-xs shrink-0 transition-colors\" title=\"\u0414\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u0442\u044C\">\u29C9</button>\n        <button data-remove-q=\"${ci}-${qi}\"\n          class=\"text-red-400 hover:text-red-300 bg-transparent border-0 cursor-pointer\n                 text-xs shrink-0 transition-colors\">\u2715</button>\n      </div>\n      <input data-q-answer=\"${ci}-${qi}\" type=\"text\" value=\"${escHtml(q.answer)}\"\n        class=\"w-full bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-emerald-400\n               focus:border-blue-500 focus:outline-none\"\n        placeholder=\"\u041E\u0442\u0432\u0435\u0442\" />\n      <input data-q-image=\"${ci}-${qi}\" type=\"text\" value=\"${escHtml(q.image ?? '')}\"\n        class=\"w-full bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-blue-400 text-sm\n               focus:border-blue-500 focus:outline-none\"\n        placeholder=\"URL \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438 (https://...)\" />\n      <input data-q-fen=\"${ci}-${qi}\" type=\"text\" value=\"${escHtml(q.fen ?? '')}\"\n        class=\"w-full bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-purple-400\n               text-sm font-mono focus:border-blue-500 focus:outline-none\"\n        placeholder=\"FEN \u043F\u043E\u0437\u0438\u0446\u0438\u0438 (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)\" />\n    </div>\n  `;\n}\n\n// \u2500\u2500 Event binding \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction attachCategoryEvents(container: HTMLElement): void {\n  const cont = container.querySelector<HTMLElement>('#categories-container')!;\n\n  cont.querySelectorAll<HTMLInputElement>('[data-cat-name]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      editPack.categories[+inp.dataset.catName!].name = inp.value;\n    });\n  });\n\n  cont.querySelectorAll<HTMLButtonElement>('[data-remove-cat]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      showConfirm('\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E?', () => {\n        editPack.categories.splice(+btn.dataset.removeCat!, 1);\n        renderCategories(container);\n      }, { confirmLabel: '\u0423\u0434\u0430\u043B\u0438\u0442\u044C' });\n    });\n  });\n\n  cont.querySelectorAll<HTMLInputElement>('[data-q-value]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      const [ci, qi] = inp.dataset.qValue!.split('-').map(Number);\n      editPack.categories[ci].questions[qi].value = Number(inp.value) || 0;\n    });\n  });\n\n  cont.querySelectorAll<HTMLInputElement>('[data-q-question]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      const [ci, qi] = inp.dataset.qQuestion!.split('-').map(Number);\n      editPack.categories[ci].questions[qi].question = inp.value;\n    });\n  });\n\n  cont.querySelectorAll<HTMLInputElement>('[data-q-answer]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      const [ci, qi] = inp.dataset.qAnswer!.split('-').map(Number);\n      editPack.categories[ci].questions[qi].answer = inp.value;\n    });\n  });\n\n  cont.querySelectorAll<HTMLInputElement>('[data-q-image]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      const [ci, qi] = inp.dataset.qImage!.split('-').map(Number);\n      editPack.categories[ci].questions[qi].image = inp.value.trim() || undefined;\n    });\n  });\n\n  cont.querySelectorAll<HTMLInputElement>('[data-q-fen]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      const [ci, qi] = inp.dataset.qFen!.split('-').map(Number);\n      editPack.categories[ci].questions[qi].fen = inp.value.trim() || undefined;\n    });\n  });\n\n  cont.querySelectorAll<HTMLButtonElement>('[data-move-up]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const [ci, qi] = btn.dataset.moveUp!.split('-').map(Number);\n      if (qi === 0) return;\n      const qs = editPack.categories[ci].questions;\n      [qs[qi - 1], qs[qi]] = [qs[qi], qs[qi - 1]];\n      renderCategories(container);\n    });\n  });\n\n  cont.querySelectorAll<HTMLButtonElement>('[data-move-down]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const [ci, qi] = btn.dataset.moveDown!.split('-').map(Number);\n      const qs = editPack.categories[ci].questions;\n      if (qi >= qs.length - 1) return;\n      [qs[qi], qs[qi + 1]] = [qs[qi + 1], qs[qi]];\n      renderCategories(container);\n    });\n  });\n\n  cont.querySelectorAll<HTMLButtonElement>('[data-duplicate-q]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const [ci, qi] = btn.dataset.duplicateQ!.split('-').map(Number);\n      const qs = editPack.categories[ci].questions;\n      qs.splice(qi + 1, 0, JSON.parse(JSON.stringify(qs[qi])));\n      renderCategories(container);\n    });\n  });\n\n  cont.querySelectorAll<HTMLButtonElement>('[data-remove-q]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const [ci, qi] = btn.dataset.removeQ!.split('-').map(Number);\n      const qs = editPack.categories[ci].questions;\n      const doDelete = () => { qs.splice(qi, 1); renderCategories(container); };\n      if (qs.length <= 1) {\n        showConfirm('\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439 \u0432\u043E\u043F\u0440\u043E\u0441. \u0423\u0434\u0430\u043B\u0438\u0442\u044C?', doDelete, { confirmLabel: '\u0423\u0434\u0430\u043B\u0438\u0442\u044C' });\n      } else {\n        doDelete();\n      }\n    });\n  });\n\n  cont.querySelectorAll<HTMLButtonElement>('[data-add-q]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const ci = +btn.dataset.addQ!;\n      const qs = editPack.categories[ci].questions;\n      const lastVal = qs.at(-1)?.value ?? 0;\n      qs.push({ value: lastVal + 100, question: '', answer: '' });\n      renderCategories(container);\n    });\n  });\n}\n\n// \u2500\u2500 Validation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfunction validatePack(pack: Pack): string | null {\n  if (!pack.title.trim())      return '\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430';\n  if (!pack.categories.length) return '\u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B \u043E\u0434\u043D\u0443 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E';\n  for (const [ci, cat] of pack.categories.entries()) {\n    if (!cat.name.trim())      return `\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F ${ci + 1}: \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435`;\n    if (!cat.questions.length) return `\"${cat.name}\": \u0434\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B \u043E\u0434\u0438\u043D \u0432\u043E\u043F\u0440\u043E\u0441`;\n    for (const [qi, q] of cat.questions.entries()) {\n      if (!q.question.trim())  return `\"${cat.name}\"[${qi + 1}]: \u043D\u0435\u0442 \u0442\u0435\u043A\u0441\u0442\u0430 \u0432\u043E\u043F\u0440\u043E\u0441\u0430`;\n      if (!q.answer.trim())    return `\"${cat.name}\"[${qi + 1}]: \u043D\u0435\u0442 \u043E\u0442\u0432\u0435\u0442\u0430`;\n      if (q.fen && !isValidFen(q.fen))\n                               return `\"${cat.name}\"[${qi + 1}]: \u043D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u044B\u0439 FEN`;\n    }\n  }\n  return null;\n}\n\nfunction showStatus(container: HTMLElement, msg: string, ok: boolean): void {\n  const el = container.querySelector<HTMLElement>('#status')!;\n  el.textContent = msg;\n  el.style.color = ok ? '#4ade80' : '#f87171';\n}\n\nfunction downloadJson(pack: Pack): void {\n  const blob = new Blob([JSON.stringify(pack, null, 2)], { type: 'application/json' });\n  const a = document.createElement('a');\n  a.href = URL.createObjectURL(blob);\n  a.download = `${pack.title || 'pack'}.json`;\n  a.click();\n}\n", "// CSS imports \u2014 esbuild will bundle these into dist/bundle.css\nimport 'chessground/assets/chessground.base.css';\nimport 'chessground/assets/chessground.brown.css';\nimport './pieces.css';\nimport './styles.css';\n\nimport { initRouter, navigate } from './router';\nimport { ScreenName } from './types';\n\nimport { render as renderHome }      from './screens/home';\nimport { render as renderSetup }     from './screens/setup';\nimport { render as renderGameBoard } from './screens/game-board';\nimport { render as renderQuestion }  from './screens/question';\nimport { render as renderResults }   from './screens/results';\nimport { render as renderEditor }    from './screens/editor';\n\nconst app = document.getElementById('app');\nif (!app) throw new Error('#app element not found');\n\nconst renderers: Record<ScreenName, (el: HTMLElement) => void> = {\n  'home':       renderHome,\n  'setup':      renderSetup,\n  'game-board': renderGameBoard,\n  'question':   renderQuestion,\n  'results':    renderResults,\n  'editor':     renderEditor,\n};\n\ninitRouter(app, renderers);\nnavigate('home');\n"],
  "mappings": "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",
  "names": ["_root", "_renderers", "initRouter", "root", "renderers", "navigate", "screen", "render", "BUILTIN_PACKS", "SAVES_KEY", "PACKS_KEY", "loadStoredPacks", "raw", "saveStoredPacks", "packs", "upsertStoredPack", "pack", "idx", "all", "deleteStoredPack", "toRaw", "g", "fromRaw", "r", "loadSaves", "s", "upsertSave", "slot", "saves", "raws", "deleteSave", "id", "saveGame", "game", "playerNames", "p", "packs", "BUILTIN_PACKS", "loadStoredPacks", "BUILTIN_PACK_COUNT", "selectedPackIdx", "setupPlayers", "setupTimerSecs", "game", "setSelectedPackIdx", "i", "setSetupPlayers", "p", "setSetupTimerSecs", "s", "setGame", "g", "addPack", "refreshPacks", "escHtml", "s", "sanitizeImageUrl", "url", "trimmed", "parsed", "BASE_OVERLAY", "BASE_PANEL", "createOverlay", "el", "showAlert", "msg", "onClose", "overlay", "close", "e", "showConfirm", "onConfirm", "options", "confirmLabel", "confirmCls", "render", "container", "saves", "loadSaves", "a", "b", "navigate", "showSavePicker", "modal", "s", "escHtml", "formatDate", "btn", "id", "slot", "closePicker", "setGame", "showConfirm", "deleteSave", "e", "ms", "localPlayers", "render", "container", "refreshPacks", "setupPlayers", "buildShell", "rebuildPlayersList", "attachEvents", "packs", "p", "i", "selectedPackIdx", "escHtml", "setupTimerSecs", "list", "name", "inp", "btn", "syncPlayersFromInputs", "navigate", "e", "file", "reader", "pack", "addPack", "setSelectedPackIdx", "showAlert", "err", "packIdx", "timerSecs", "setSetupPlayers", "setSetupTimerSecs", "players", "newGame", "setGame", "saveGame", "render", "container", "game", "navigate", "buildGrid", "renderScores", "showConfirm", "g", "cats", "allVals", "c", "q", "a", "b", "grid", "cat", "catIdx", "catCell", "val", "qIdx", "cell", "key", "done", "bar", "p", "escHtml", "colors", "files", "ranks", "invRanks", "ranks", "allKeys", "files", "c", "r", "pos2key", "pos", "key2pos", "k", "allPos", "allKeys", "key2pos", "memo", "f", "v", "ret", "timer", "startAt", "time", "opposite", "c", "distanceSq", "pos1", "pos2", "dx", "dy", "samePiece", "p1", "p2", "posToTranslate", "bounds", "pos", "asWhite", "translate", "el", "translateAndScale", "scale", "setVisible", "eventPosition", "_a", "isRightButton", "createEl", "tagName", "className", "computeSquareCenter", "key", "diff", "a", "b", "pawn", "color", "x1", "y1", "x2", "y2", "knight", "xd", "yd", "bishop", "rook", "queen", "king", "rookFiles", "canCastle", "rookFilesOf", "pieces", "backrank", "files", "key", "piece", "key2pos", "premove", "pos", "r", "mobility", "allPos", "pos2", "pos2key", "callUserFunction", "f", "args", "toggleOrientation", "state", "opposite", "setPieces", "state", "pieces", "key", "piece", "setCheck", "color", "k", "p", "setPremove", "orig", "dest", "meta", "unsetPredrop", "callUserFunction", "unsetPremove", "setPredrop", "role", "pd", "tryAutoCastle", "king", "origPos", "key2pos", "destPos", "pos2key", "rook", "baseMove", "origPiece", "destPiece", "captured", "unselect", "baseNewPiece", "force", "opposite", "baseUserMove", "result", "userMove", "canMove", "holdTime", "metadata", "canPremove", "dropNewPiece", "canDrop", "canPredrop", "selectSquare", "isMovable", "isPremovable", "setSelected", "premove", "_b", "_a", "validPremoves", "isDraggable", "playPremove", "move", "success", "playPredrop", "validate", "drop", "cancelMove", "stop", "getKeyAtDomPos", "pos", "asWhite", "bounds", "file", "rank", "getSnappedKeyAtDomPos", "validSnapPos", "allPos", "pos2", "queen", "knight", "validSnapDistances", "computeSquareCenter", "distanceSq", "closestSnapIndex", "a", "b", "index", "whitePov", "s", "initial", "roles", "letters", "read", "fen", "pieces", "row", "col", "c", "piece", "pos2key", "nb", "role", "write", "invRanks", "y", "files", "x", "p", "s", "applyAnimation", "state", "config", "deepMerge", "configure", "_a", "_b", "read", "_c", "setCheck", "setSelected", "rank", "kingStartPos", "dests", "king", "d", "base", "extend", "key", "isPlainObject", "o", "proto", "anim", "mutation", "state", "animate", "render", "result", "makePiece", "key", "piece", "key2pos", "closer", "pieces", "p1", "p2", "distanceSq", "computePlan", "prevPieces", "current", "anims", "animedOrigs", "fadings", "missings", "news", "prePieces", "curP", "preP", "vector", "k", "p", "allKeys", "samePiece", "newP", "step", "now", "cur", "rest", "ease", "easing", "cfg", "plan", "alreadyRunning", "t", "brushes", "start", "state", "e", "unselect", "cancelMove", "pos", "eventPosition", "orig", "getKeyAtDomPos", "whitePov", "eventBrush", "processDraw", "cur", "keyAtDomPos", "mouseSq", "getSnappedKeyAtDomPos", "move", "end", "addShape", "cancel", "clear", "onChange", "modA", "isRightButton", "modB", "_a", "drawable", "sameShape", "s", "similar", "start", "s", "e", "bounds", "position", "eventPosition", "orig", "getKeyAtDomPos", "whitePov", "piece", "previouslySelected", "clear", "pieceCloseTo", "hadPremove", "hadPredrop", "canMove", "anim", "state", "selectSquare", "stillSelected", "element", "pieceElementByKey", "isDraggable", "ghost", "translate", "posToTranslate", "key2pos", "setVisible", "processDrag", "unsetPremove", "unsetPredrop", "pos", "asWhite", "radiusSq", "key", "center", "computeSquareCenter", "distanceSq", "dragNewPiece", "force", "cur", "_a", "origPiece", "samePiece", "cancel", "found", "move", "end", "eventPos", "dest", "dropNewPiece", "userMove", "callUserFunction", "unselect", "removeDragElements", "el", "explosion", "state", "keys", "setStage", "stage", "start", "state", "redrawAll", "toggleOrientation", "config", "applyAnimation", "anim", "render", "configure", "write", "pieces", "setPieces", "key", "force", "selectSquare", "unselect", "orig", "dest", "baseMove", "piece", "baseNewPiece", "playPremove", "validate", "result", "playPredrop", "unsetPremove", "unsetPredrop", "cancelMove", "cancel", "stop", "keys", "explosion", "shapes", "pos", "getKeyAtDomPos", "whitePov", "event", "dragNewPiece", "defaults", "read", "initial", "timer", "hilites", "createDefs", "defs", "createElement", "filter", "setAttributes", "renderSvg", "state", "shapesEl", "customsEl", "d", "curD", "cur", "dests", "bounds", "nonPieceAutoShapes", "autoShape", "s", "sources", "_a", "from", "pos2user", "orient", "key2pos", "to", "moveAngle", "shapes", "shapeHash", "isShort", "fullHash", "sc", "defsEl", "syncDefs", "syncShapes", "renderShape", "brushes", "brush", "makeCustomBrush", "hilite", "keysInDom", "el", "key", "renderMarker", "syncables", "customs", "hashesInDom", "root", "toRemove", "elHash", "svg", "orig", "dest", "piece", "modifiers", "customSvg", "label", "shorten", "current", "pieceHash", "modifiersHash", "textHash", "_b", "x", "m", "h", "i", "shape", "hash", "slots", "svgs", "renderArrow", "renderCircle", "corner", "renderLabel", "on", "y", "labelCoords", "c", "at", "widths", "circleWidth", "radius", "opacity", "hilites", "renderLine", "isHilite", "arrowMargin", "dx", "dy", "angle", "xo", "yo", "lineWidth", "g", "blurred", "filterBox", "marker", "fontSize", "cornerOff", "labelEl", "pos", "color", "tagName", "attrs", "base", "xScale", "yScale", "box", "asSlot", "dist", "acc", "mag", "slot", "renderWrap", "element", "s", "c", "colors", "container", "createEl", "board", "svg", "customSvg", "autoPieces", "setAttributes", "createElement", "createDefs", "orientClass", "ranksPositionClass", "rankN", "i", "files", "f", "renderCoords", "ranks", "r", "ghost", "setVisible", "elems", "className", "el", "elem", "drop", "s", "e", "unsetPremove", "unsetPredrop", "piece", "position", "eventPosition", "dest", "getKeyAtDomPos", "whitePov", "dropNewPiece", "bindBoard", "s", "onResize", "boardEl", "e", "onStart", "startDragOrDraw", "bindDocument", "unbinds", "unbindable", "onmove", "dragOrDraw", "move", "onend", "end", "ev", "onScroll", "f", "el", "eventName", "callback", "options", "cancel", "isRightButton", "start", "drop", "withDrag", "withDraw", "render", "s", "asWhite", "whitePov", "posToTranslate", "boardEl", "pieces", "curAnim", "anims", "fadings", "curDrag", "squares", "computeSquareClasses", "samePieces", "sameSquares", "movedPieces", "movedSquares", "k", "el", "pieceAtKey", "elPieceName", "anim", "fading", "pMvdset", "pMvd", "sMvdset", "sMvd", "isPieceNode", "translate", "key2pos", "pieceNameOf", "pos", "posZIndex", "appendValue", "isSquareNode", "cn", "sk", "className", "translation", "squareNode", "createEl", "p", "pieceName", "pieceNode", "nodes", "removeNodes", "renderResized", "updateBounds", "bounds", "container", "ratio", "width", "height", "_a", "_b", "node", "rank", "piece", "addSquare", "dests", "pDests", "_c", "premove", "o", "v", "key", "klass", "classes", "map", "value", "arr", "syncShapes", "shapes", "root", "renderShape", "hashesInDom", "toRemove", "sc", "el", "elHash", "render", "state", "autoPieceEl", "autoPieceShapes", "autoShape", "s", "hash", "syncShapes", "shape", "renderShape", "renderResized", "asWhite", "whitePov", "posToTranslate", "el", "_a", "translateAndScale", "key2pos", "bounds", "orig", "role", "color", "_b", "scale", "_c", "pieceEl", "createEl", "autoPiece", "Chessground", "element", "config", "maybeState", "defaults", "configure", "redrawAll", "prevUnbind", "elements", "renderWrap", "bounds", "memo", "redrawNow", "skipSvg", "render", "state", "renderSvg", "onResize", "updateBounds", "renderResized", "debounceRedraw", "bindBoard", "bindDocument", "start", "redrawing", "rootNode", "comment", "node", "move", "suffix", "nag", "variations", "lineToTree", "nodes", "root", "rest", "parent", "child", "pgn", "headers", "game", "next", "peg$subclass", "C", "peg$SyntaxError", "message", "expected", "found", "location", "self", "peg$padEnd", "str", "targetLength", "padString", "sources", "src", "k", "s", "offset_s", "loc", "e", "filler", "line", "last", "hatLen", "DESCRIBE_EXPECTATION_FNS", "expectation", "literalEscape", "escapedParts", "part", "classEscape", "hex", "ch", "describeExpectation", "describeExpected", "descriptions", "i", "j", "describeFound", "peg$parse", "input", "options", "peg$FAILED", "peg$source", "peg$startRuleFunctions", "peg$parsepgn", "peg$startRuleFunction", "peg$c0", "peg$c1", "peg$c2", "peg$c3", "peg$c4", "peg$c5", "peg$c6", "peg$c7", "peg$c8", "peg$c9", "peg$c10", "peg$c11", "peg$c12", "peg$c13", "peg$c14", "peg$c15", "peg$c16", "peg$c17", "peg$r0", "peg$r1", "peg$r2", "peg$r3", "peg$r4", "peg$r5", "peg$r6", "peg$r7", "peg$r8", "peg$r9", "peg$e0", "peg$otherExpectation", "peg$e1", "peg$literalExpectation", "peg$e2", "peg$e3", "peg$e4", "peg$e5", "peg$classExpectation", "peg$e6", "peg$e7", "peg$e8", "peg$e9", "peg$e10", "peg$e11", "peg$e12", "peg$e13", "peg$e14", "peg$e15", "peg$e16", "peg$e17", "peg$e18", "peg$e19", "peg$e20", "peg$e21", "peg$e22", "peg$e23", "peg$e24", "peg$e25", "peg$e26", "peg$e27", "peg$e28", "peg$e29", "peg$e30", "peg$e31", "peg$e32", "peg$e33", "peg$e34", "peg$e35", "peg$e36", "peg$e37", "peg$e38", "peg$e39", "peg$f0", "peg$f1", "tagPairs", "peg$f2", "tagName", "tagValue", "peg$f3", "marker", "peg$f4", "moves", "peg$f5", "san", "peg$f6", "peg$f7", "peg$f8", "peg$f9", "peg$f10", "result", "peg$currPos", "peg$posDetailsCache", "peg$maxFailPos", "peg$maxFailExpected", "peg$silentFails", "peg$result", "text", "ignoreCase", "parts", "inverted", "peg$endExpectation", "description", "peg$computePosDetails", "pos", "details", "p", "peg$computeLocation", "startPos", "endPos", "offset", "startPosDetails", "endPosDetails", "res", "peg$fail", "peg$buildStructuredError", "s0", "s1", "s2", "peg$parsetagPairSection", "peg$parsemoveTextSection", "peg$parsetagPair", "peg$parse_", "s4", "s6", "s7", "s8", "s10", "peg$parsetagName", "peg$parsetagValue", "s3", "peg$parseline", "peg$parsegameTerminationMarker", "peg$parsecomment", "peg$parsemove", "s5", "s9", "peg$parsemoveNumber", "peg$parsesan", "peg$parsesuffixAnnotation", "peg$parsenag", "peg$parsevariation", "peg$parsebraceComment", "peg$parserestOfLineComment", "MASK64", "rotl", "x", "wrappingMul", "y", "xoroshiro128", "state", "rand", "PIECE_KEYS", "EP_KEYS", "CASTLING_KEYS", "SIDE_KEY", "WHITE", "BLACK", "PAWN", "KNIGHT", "BISHOP", "ROOK", "QUEEN", "KING", "DEFAULT_POSITION", "Move", "chess", "internal", "color", "piece", "from", "to", "flags", "captured", "promotion", "fromAlgebraic", "algebraic", "toAlgebraic", "flag", "BITS", "FLAGS", "EMPTY", "BITS", "SEVEN_TAG_ROSTER", "SUPLEMENTAL_TAGS", "HEADER_TEMPLATE", "Ox88", "PAWN_OFFSETS", "PIECE_OFFSETS", "ATTACKS", "RAYS", "PIECE_MASKS", "SYMBOLS", "PROMOTIONS", "KNIGHT", "BISHOP", "ROOK", "QUEEN", "RANK_1", "RANK_2", "RANK_7", "RANK_8", "SIDES", "KING", "ROOKS", "SECOND_RANK", "SAN_NULLMOVE", "rank", "square", "file", "isDigit", "c", "algebraic", "f", "swapColor", "color", "WHITE", "BLACK", "validateFen", "fen", "tokens", "moveNumber", "halfMoves", "rows", "i", "sumFields", "previousWasNumber", "k", "kings", "regex", "char", "getDisambiguator", "move", "moves", "from", "to", "piece", "ambiguities", "sameRank", "sameFile", "len", "ambigFrom", "ambigTo", "ambigPiece", "addMove", "captured", "flags", "r", "PAWN", "promotion", "inferPieceType", "san", "pieceType", "strippedSan", "Chess", "EMPTY", "DEFAULT_POSITION", "skipValidation", "preserveHeaders", "adjustments", "ok", "error", "position", "forceEnpassantSquare", "empty", "castling", "epSquare", "bigPawnSquare", "squares", "isLegal", "type", "colorIndex", "typeIndex", "PIECE_KEYS", "EP_KEYS", "index", "CASTLING_KEYS", "hash", "SIDE_KEY", "sq", "currentPieceOnSquare", "whiteKingInPlace", "blackKingInPlace", "startSquare", "currentSquare", "attackers", "canCapture", "verbose", "difference", "offset", "j", "blocked", "attackedBy", "pieces", "bishops", "numPieces", "squareColor", "sum", "Move", "legal", "forSquare", "forPiece", "us", "them", "firstSquare", "lastSquare", "singleSquare", "castlingFrom", "castlingTo", "legalMoves", "strict", "moveObj", "prettyMove", "old", "newline", "maxWidth", "result", "headerExists", "appendComment", "moveString", "comment", "delimiter", "reversedHistory", "prefix", "strip", "wrapComment", "width", "token", "currentWidth", "args", "key", "value", "nonNullHeaders", "pgn", "newlineChar", "parsedPgn", "parse", "headers", "node", "output", "disambiguator", "cleanMove", "matches", "overlyDisambiguated", "s", "symbol", "depth", "nodes", "row", "moveHistory", "currentCount", "currentComments", "copyComment", "rights", "side", "mountBoard", "container", "fen", "Chessground", "isValidFen", "Chess", "timerInterval", "timeLeft", "selectedPlayers", "answerShown", "locked", "render", "container", "game", "navigate", "catIdx", "qIdx", "cat", "q", "safeImage", "sanitizeImageUrl", "escHtml", "mountBoard", "buildPlayerButtons", "attachActions", "startTimer", "onKey", "e", "toggleLock", "wrap", "p", "i", "btn", "togglePlayer", "idx", "updatePlayerButtons", "updateHint", "updateConfirmBtn", "hint", "names", "value", "revealAnswer", "stopTimer", "markAnswered", "cleanup", "secs", "el", "formatTime", "s", "m", "sec", "sel", "key", "saveGame", "total", "c", "fn", "render", "container", "game", "deleteSave", "players", "a", "b", "maxScore", "p", "i", "isWinner", "escHtml", "navigate", "editPack", "emptyPack", "editIdx", "render", "container", "renderPackList", "stored", "loadStoredPacks", "p", "i", "escHtml", "s", "c", "navigate", "renderPackEditor", "e", "file", "reader", "pack", "err", "showAlert", "btn", "downloadJson", "showConfirm", "deleteStoredPack", "renderCategories", "validatePack", "showStatus", "upsertStoredPack", "storedIdx", "setSelectedPackIdx", "BUILTIN_PACK_COUNT", "cont", "cat", "ci", "buildCategoryHtml", "attachCategoryEvents", "q", "qi", "buildQuestionHtml", "inp", "qs", "doDelete", "lastVal", "isValidFen", "msg", "ok", "el", "blob", "a", "app", "renderers", "render", "initRouter", "navigate"]
}
