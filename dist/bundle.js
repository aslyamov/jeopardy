"use strict";(()=>{var Nt,Qr={};function Wr(e,t){Nt=e,Object.assign(Qr,t)}function L(e){Nt.innerHTML="";let t=Qr[e];t&&t(Nt)}var Fe=[{title:"\u041C\u0438\u0442\u0442\u0435\u043B\u044C\u0448\u043F\u0438\u043B\u044C",categories:[{name:"\u0411\u043E\u0440\u044C\u0431\u0430 \u0437\u0430 \u0446\u0435\u043D\u0442\u0440",questions:[{value:100,question:"\u041A\u0430\u043A\u043E\u0439 \u043A\u043E\u043D\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u0435\u0435 \u0438 \u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0443 \u043D\u0435\u0433\u043E \u0445\u043E\u0434\u043E\u0432?",answer:"\u0427\u0435\u0440\u043D\u044B\u0439 \u043A\u043E\u043D\u044C. \u0423 \u043D\u0435\u0433\u043E 8 \u0445\u043E\u0434\u043E\u0432.",fen:"8/8/8/3n4/8/8/8/6N1 w - - 0 1"},{value:200,question:"\u041A\u0430\u043A\u043E\u0439 \u043A\u043E\u043D\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u0435\u0435 \u0438 \u043F\u043E\u0447\u0435\u043C\u0443?",answer:"\u0411\u0435\u043B\u044B\u0439 \u043A\u043E\u043D\u044C, \u043E\u043D \u0441\u0442\u043E\u0438\u0442 \u0431\u043B\u0438\u0436\u0435 \u043A \u0446\u0435\u043D\u0442\u0440\u0443.",fen:"1k6/ppp5/n7/8/8/5N2/5PPP/6K1 w - - 0 1"},{value:300,question:"\u041A\u0442\u043E \u0432\u043B\u0430\u0434\u0435\u0435\u0442 \u0446\u0435\u043D\u0442\u0440\u043E\u043C?",answer:"\u0411\u0435\u043B\u044B\u0435, \u0438\u0445 \u043F\u0435\u0448\u043A\u0438 \u0437\u0430\u043D\u044F\u043B\u0438 \u0446\u0435\u043D\u0442\u0440.",fen:"rnbqkbnr/ppp2ppp/3pp3/8/3PP3/8/PPP2PPP/RNBQKBNR w KQkq - 0 3"},{value:400,question:"\u0423\u0441\u0438\u043B\u044C \u0441\u0432\u043E\u0435\u0433\u043E \u0431\u0435\u043B\u043E\u0433\u043E \u043A\u043E\u043D\u044F, \u043F\u0435\u0440\u0435\u0432\u0435\u0434\u044F \u0435\u0433\u043E \u0432 \u0446\u0435\u043D\u0442\u0440",answer:"\u041Af1-e3-d5",fen:"6k1/p5pp/np3p2/2p1p3/2P1P3/1P3P2/P5PP/1K3N2 w - - 0 1"},{value:500,question:"\u0423\u0441\u0438\u043B\u044C \u0441\u0432\u043E\u0435\u0433\u043E \u0431\u0435\u043B\u043E\u0433\u043E \u0441\u043B\u043E\u043D\u0430, \u043F\u0435\u0440\u0435\u0432\u0435\u0434\u044F \u0435\u0433\u043E \u0432 \u0446\u0435\u043D\u0442\u0440",answer:"\u0421a3-c1-f4-e5",fen:"2k5/ppp4p/4p1p1/3p1n2/3P3P/BPP3P1/P5K1/8 w - - 0 1"}]},{name:"\u041E\u0442\u043A\u0440\u044B\u0442\u044B\u0435 \u043B\u0438\u043D\u0438\u0438",questions:[{value:100,question:"\u041D\u0430\u0439\u0434\u0438 \u043E\u0442\u043A\u0440\u044B\u0442\u0443\u044E \u043B\u0438\u043D\u0438\u044E",answer:"\u041B\u0438\u043D\u0438\u044F b",fen:"2kr4/2p3p1/3p1p1p/p2p4/8/3P1P1P/P1PKP1P1/7R w - - 0 1"},{value:200,question:"\u041A\u0442\u043E \u0432\u043B\u0430\u0434\u0435\u0435\u0442 \u043E\u0442\u043A\u0440\u044B\u0442\u043E\u0439 \u043B\u0438\u043D\u0438\u0435\u0439?",answer:"\u0427\u0435\u0440\u043D\u044B\u0435, \u043B\u0438\u043D\u0438\u044F F.",fen:"5rk1/5rpp/p3p3/3pP3/2pP4/2P5/P5PP/R2R2K1 w - - 0 1"},{value:300,question:"\u0415\u0441\u0442\u044C \u043B\u0438 \u0437\u0434\u0435\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u0430\u044F \u043B\u0438\u043D\u0438\u044F?",answer:"\u0414\u0430, \u043B\u0438\u043D\u0438\u044F d.",fen:"4r1k1/pp3p1p/2p1p1p1/4P3/3B1P2/P1P3P1/1P4KP/8 w - - 0 1"},{value:400,question:"\u0413\u0434\u0435 \u0441\u043A\u043E\u0440\u043E \u043F\u043E\u044F\u0432\u0438\u0442\u0441\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0430\u044F \u043B\u0438\u043D\u0438\u044F? \u041A\u0430\u043A \u0431\u0435\u043B\u044B\u043C \u043F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u0438\u0442\u044C\u0441\u044F \u043A \u044D\u0442\u043E\u043C\u0443?",answer:"\u0424h1!",fen:"1kq4r/p6r/Pp3p1p/1Pp1pPp1/2PpP1PP/3P3R/1K5R/3Q4 w - - 0 1"},{value:500,question:"\u0413\u0434\u0435 \u0441\u043A\u043E\u0440\u043E \u043F\u043E\u044F\u0432\u0438\u0442\u0441\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0430\u044F \u043B\u0438\u043D\u0438\u044F? \u041A\u0430\u043A \u043F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u0438\u0442\u044C\u0441\u044F \u043A \u044D\u0442\u043E\u043C\u0443?",answer:"\u041B\u0438\u043D\u0438\u044F a. \u041D\u0430\u0434\u043E \u0442\u044F\u0436\u0435\u043B\u044B\u0435 \u0431\u0435\u043B\u044B\u0435 \u0444\u0438\u0433\u0443\u0440\u044B \u043F\u0435\u0440\u0435\u043C\u0435\u0441\u0442\u0438\u0442\u044C \u043D\u0430 \u043B\u0438\u043D\u0438\u044E \u0430. \u041B\u0430\u0434\u044C\u0438 \u0432\u043F\u0435\u0440\u0435\u0434\u0438, \u0444\u0435\u0440\u0437\u044C \u043F\u043E\u0437\u0430\u0434\u0438.",fen:"2qrr1k1/p3p3/1p1p1p2/PPpP2p1/2P1P1Pp/5P1P/6K1/3RRQ2 w - - 0 1"}]},{name:"\u041F\u0435\u0448\u0435\u0447\u043D\u044B\u0435 \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u0438",questions:[{value:100,question:"\u0415\u0441\u0442\u044C \u043B\u0438 \u0437\u0434\u0435\u0441\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0430\u044F \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?",answer:"\u0414\u0430, \u043F\u0435\u0448\u043A\u0438 c7 \u0438 c6, \u0441\u0434\u0432\u043E\u0435\u043D\u043D\u044B\u0435.",fen:"r1bqkb1r/ppp2ppp/2p2n2/4p3/4P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 5"},{value:200,question:"\u0415\u0441\u0442\u044C \u043B\u0438 \u0437\u0434\u0435\u0441\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0430\u044F \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?",answer:"\u0414\u0430, \u043F\u0435\u0448\u043A\u0430 \u043D\u0430 e4 - \u0438\u0437\u043E\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F.",fen:"6k1/p5p1/1p3p2/2p1p3/4P3/8/PPP3PP/6K1 w - - 0 1"},{value:300,question:"\u041D\u0430\u0437\u043E\u0432\u0438 \u0432\u0441\u0435 \u043F\u0435\u0448\u0435\u0447\u043D\u044B\u0435 \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u0438",answer:"\u041F\u0435\u0448\u043A\u0438 a3 \u0438 e2 - \u043E\u0442\u0441\u0442\u0430\u043B\u044B\u0435, \u043F\u0435\u0448\u043A\u0438 f4 \u0438 d6 - \u0438\u0437\u043E\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0435, \u043F\u0435\u0448\u043A\u0438 b5 \u0438 b6 - \u0441\u0434\u0432\u043E\u0435\u043D\u043D\u044B\u0435.",fen:"6k1/8/1p1p4/1p6/1P3p2/P4P2/4P3/6K1 w - - 0 1"},{value:400,question:"\u041A\u0430\u043A \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0443\u044E \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?",answer:"\u0421f6:g5",fen:"rnb2rk1/ppq2ppp/2pbpn2/3p2B1/2PP4/2NBPN2/PP3PPP/R2QK2R w KQ - 3 8"},{value:500,question:"\u041A\u0430\u043A \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0435\u0448\u0435\u0447\u043D\u0443\u044E \u0441\u043B\u0430\u0431\u043E\u0441\u0442\u044C?",answer:"b4!",fen:"8/p4k2/8/1p6/8/1P6/P7/7K w - - 0 1"}]},{name:"\u0421\u043B\u0430\u0431\u044B\u0435 \u043F\u043E\u043B\u044F",questions:[{value:100,question:"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435? \u041A\u0430\u043A \u0435\u0433\u043E \u0437\u0430\u043D\u044F\u0442\u044C?",answer:"\u041Ab3-c5",fen:"4b1k1/8/p1p3p1/Pp1p1pPp/1P1PpP1P/1N2P3/6K1/8 w - - 0 1"},{value:200,question:"\u041A\u0430\u043A \u0437\u0430\u043D\u044F\u0442\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435?",answer:"\u041Bc8-f8-f4",fen:"1kr4r/ppp5/3p3p/3Pp1pP/4P3/5P2/PPP5/1KR4R w - - 0 1"},{value:300,question:"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435? \u041A\u0430\u043A \u0435\u0433\u043E \u0437\u0430\u043D\u044F\u0442\u044C?",answer:"e6. \u041A\u0440e2-f3, \u041Bf1-\u04351, \u041Be1-e6",fen:"6kr/p5pp/Pp1p1p2/1PpP1P2/2P2P2/6P1/4K2P/5R2 w - - 0 1"},{value:400,question:"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u044B\u0435 \u043F\u043E\u043B\u044F? \u041A\u0430\u043A \u0438\u0445 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C?",answer:"b2 \u0438 a3. \u0421b4-a3, \u0433\u0440\u043E\u0437\u0438\u0442 \u043C\u0430\u0442!",fen:"r1b2rk1/1p3p1p/p3pqp1/2p5/1bP1QNPP/1P2P3/P1B2P2/1K4RR b - - 0 14"},{value:500,question:"\u0413\u0434\u0435 \u0437\u0434\u0435\u0441\u044C \u0441\u043B\u0430\u0431\u043E\u0435 \u043F\u043E\u043B\u0435? \u041A\u0430\u043A \u0435\u0433\u043E \u0437\u0430\u043D\u044F\u0442\u044C?",answer:"e5. \u041Ab1-d2-f3-e5.",fen:"r3rnk1/pp1b2pp/2p4q/3p1p2/3P1P2/P1NBP3/1P3QPP/4RRK1 w - - 0 1"}]}]},{title:"\u0420\u0435\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044C\u043D\u043E\u0433\u043E \u043F\u0435\u0440\u0435\u0432\u0435\u0441\u0430",categories:[{name:"\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0435\u0432\u0435\u0441",questions:[{value:100,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0435\u0432\u0435\u0441 \u0443 \u0431\u0435\u043B\u044B\u0445.",fen:"5nk1/p4pp1/1p2p2p/8/7P/1R4P1/PP2PP2/6K1 w - - 0 1"},{value:200,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0435\u0432\u0435\u0441 \u0443 \u0431\u0435\u043B\u044B\u0445.",fen:"7k/ppp3q1/3p3p/4p2Q/2P1P3/1P4bP/P5P1/5R1K w - - 0 28"},{value:300,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0435\u0432\u0435\u0441 \u0443 \u0447\u0435\u0440\u043D\u044B\u0445.",fen:"r2qkr2/pppp3p/6p1/4p3/2B1P3/2NP1N2/PPP2K2/R6R b q - 1 13"},{value:400,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0435\u0432\u0435\u0441 \u0443 \u0431\u0435\u043B\u044B\u0445.",fen:"r4k2/ppp5/3p4/2b1pPp1/4P2r/2NP3P/PPP5/R3K2R b KQ - 0 17"},{value:500,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0435\u0432\u0435\u0441 \u0443 \u0447\u0435\u0440\u043D\u044B\u0445.",fen:"r1bqk2r/p1pp1pbp/1pn1pnp1/8/3P4/1BP2NQP/PP4P1/R1B1K2R b KQkq - 0 8"}]},{name:"\u041F\u0440\u043E\u0444\u0438\u043B\u0430\u043A\u0442\u0438\u043A\u0430",questions:[{value:100,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"24. h3!",fen:"4r1k1/pp4pp/2pp4/3p2B1/P7/1Q6/1PP2PPP/6K1 w - - 1 24"},{value:200,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"12... \u0424f6!",fen:"r1bqk1nr/pppp1ppp/6n1/1Bb3N1/4P2P/2N2Q2/PPPP4/R1B2K2 b kq - 3 12"},{value:300,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"52... h6!",fen:"r5k1/5ppp/3rpn2/8/8/2PP3P/PR2KPP1/1R6 b - - 19 52"},{value:400,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"1... g6!",fen:"r2q1rk1/2p2ppp/1pbbpn2/p2p2B1/3P4/2PQPN1P/PPB2PP1/5RK1 b - - 0 1"},{value:500,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"1... h6!",fen:"r1bq1rk1/ppp2ppp/2n1pn2/2bp2N1/7Q/1P1BP3/PBPP1PPP/R3K2R b KQ - 0 1"}]},{name:"\u0413\u0430\u0440\u043C\u043E\u043D\u0438\u044F",questions:[{value:100,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"\u041A\u043E\u043D\u044C \u043D\u0430 c3, \u0441\u043B\u043E\u043D \u043D\u0430 f4, \u043B\u0430\u0434\u044C\u044F \u043D\u0430 e1.",fen:"8/p5pp/2p2k2/8/3P4/7P/PPP2PP1/RNB3K1 w - - 1 21"},{value:200,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"\u0421\u043B\u043E\u043D \u043D\u0430 d2, \u043B\u0430\u0434\u044C\u044F \u043D\u0430 c1.",fen:"8/5p2/3p1p2/2p1pk2/p7/P2P2P1/1P2PP1P/R1B3K1 w - - 1 22"},{value:300,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"\u041B\u0430\u0434\u044C\u044F \u043D\u0430 f8-f3, \u0444\u0435\u0440\u0437\u044C \u043D\u0430 h5",fen:"1kr1q2r/p5pp/1p6/2p1p3/3pP3/8/P1K5/8 b - - 0 1"},{value:400,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"\u0424\u0435\u0440\u0437\u044C e2, \u0441\u043B\u043E\u043D \u043D\u0430 e3, \u043B\u0430\u0434\u044C\u044F \u043D\u0430 d1",fen:"4qrk1/2p2ppp/2p5/pp2p3/4P3/8/PPPQ2PP/R1B3K1 w - - 1 16"},{value:500,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"\u041A\u043E\u043D\u044C d7-f8-g6-h4, \u0441\u043B\u043E\u043D d7-b5",fen:"rnbr2k1/ppp1bppp/4p3/3pP3/3P4/1NP1B2q/PP3P2/R2Q1RK1 b - - 0 1"}]},{name:"\u0420\u0430\u0437\u043C\u0435\u043D \u0444\u0438\u0433\u0443\u0440",questions:[{value:100,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"\u0420\u0430\u0437\u043C\u0435\u043D \u0441\u043B\u043E\u043D\u043E\u0432 - Cg5",fen:"3k4/pp2b1pp/4p3/3pPp2/2pP3P/2P3P1/PP3P2/R1B1K3 w Q - 0 1"},{value:200,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"\u0420\u0430\u0437\u043C\u0435\u043D \u0444\u0435\u0440\u0437\u0435\u0439 - \u0424b1",fen:"1r4k1/p1pp1p1p/b1p5/8/8/7P/PqP2PP1/4Q1K1 b - - 1 20"},{value:300,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"28. \u0421f4+ \u041A:f4 29. \u0424:f4+ \u0424:f4 30. e:f4",fen:"8/p1k5/4np1B/8/Q7/P3PPqP/2P3P1/3K1B1R w - - 1 28"},{value:400,question:"\u0425\u043E\u0434 \u0447\u0451\u0440\u043D\u044B\u0445",answer:"20... \u041B:a3 21. \u041B:a3 \u041B:a3 22. b:a3 \u0421:c3 23. d:c3 \u0421:g4 24. h:g4",fen:"r2qk3/r6p/2p1bp2/4p1p1/2Pb2N1/R1B4P/1P1P1PP1/R5K1 b - - 0 20"},{value:500,question:"\u0425\u043E\u0434 \u0431\u0435\u043B\u044B\u0445",answer:"1. \u041A:f5 \u041A:f5 2. \u0421:f5 \u0424:f5 3. \u0424:f5 g:f5 4. \u041B:e7 \u041B:e7 5. \u041Be1",fen:"4r1k1/pp1qrpnp/2p3p1/3p1bQ1/3P3N/2PB2BP/PP3PP1/3RRK2 w - - 0 1"}]}]}];var Rt="jeopardy_saves",Gr="jeopardy_packs";function oe(){try{let e=localStorage.getItem(Gr);return e?JSON.parse(e):[]}catch{return[]}}function Zr(e){localStorage.setItem(Gr,JSON.stringify(e))}function Kt(e,t){let r=oe();t!==void 0&&t>=0?r[t]=e:r.push(e),Zr(r)}function Vr(e){let t=oe();t.splice(e,1),Zr(t)}function Ci(e){return{id:e.id,pack:e.pack,players:e.players,timerSecs:e.timerSecs,answered:[...e.answered]}}function qi(e){return{id:e.id,pack:e.pack,players:e.players,timerSecs:e.timerSecs,answered:new Set(e.answered),cur:null}}function at(e){return{id:e.id,name:e.name,savedAt:e.savedAt,state:Ci(e.state)}}function ze(){try{let e=localStorage.getItem(Rt);return e?JSON.parse(e).map(t=>({...t,state:qi(t.state)})):[]}catch{return[]}}function Ai(e){let t=ze(),r=t.findIndex(o=>o.id===e.id),n=t.map(at);r>=0?n[r]=at(e):n.push(at(e)),localStorage.setItem(Rt,JSON.stringify(n))}function lt(e){let t=ze().filter(r=>r.id!==e).map(at);localStorage.setItem(Rt,JSON.stringify(t))}function ct(e){let t=e.players.map(r=>r.name).join(", ");Ai({id:e.id,name:`${e.pack.title} \xB7 ${t}`,savedAt:Date.now(),state:e})}var qe=[...Fe,...oe()],Jr=Fe.length,Ht=0,Ot=["\u0418\u0433\u0440\u043E\u043A 1","\u0418\u0433\u0440\u043E\u043A 2"],Bt=0,M=null;function Ue(e){Ht=e}function Yr(e){Ot=e}function Xr(e){Bt=e}function dt(e){M=e}function en(e){qe.push(e)}function tn(){qe.splice(0,qe.length,...Fe,...oe())}function q(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function rn(e){let t=e.trim();if(!t)return"";try{let r=new URL(t);if(r.protocol==="http:"||r.protocol==="https:")return t}catch{}return""}var Li="fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 px-4",nn="bg-gray-900 border border-gray-700 rounded-2xl p-6 w-full shadow-2xl space-y-5";function on(){let e=document.createElement("div");return e.className=Li,e}function Qe(e,t){let r=on();r.innerHTML=`
    <div class="${nn}" style="max-width:380px">
      <p class="text-center text-white text-base leading-relaxed">${q(e)}</p>
      <button id="modal-ok"
        class="w-full py-2.5 bg-blue-600 hover:bg-blue-500 rounded-xl border-0 text-white
               font-bold cursor-pointer transition-colors">
        \u041E\u041A
      </button>
    </div>
  `,document.body.appendChild(r);let n=()=>{r.remove(),t?.()};r.querySelector("#modal-ok").addEventListener("click",n),r.addEventListener("click",o=>{o.target===r&&n()})}function be(e,t,r){let n=on(),o=r?.confirmLabel??"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C",i=r?.confirmClass??"bg-red-600 hover:bg-red-500";n.innerHTML=`
    <div class="${nn}" style="max-width:380px">
      <p class="text-center text-white text-base leading-relaxed">${e}</p>
      <div class="flex gap-3">
        <button id="modal-cancel"
          class="flex-1 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-xl border-0 text-white
                 cursor-pointer transition-colors">
          \u041E\u0442\u043C\u0435\u043D\u0430
        </button>
        <button id="modal-confirm"
          class="flex-1 py-2.5 ${i} rounded-xl border-0 text-white font-bold
                 cursor-pointer transition-colors">
          ${q(o)}
        </button>
      </div>
    </div>
  `,document.body.appendChild(n);let s=()=>n.remove();n.querySelector("#modal-cancel").addEventListener("click",s),n.querySelector("#modal-confirm").addEventListener("click",()=>{s(),t()}),n.addEventListener("click",a=>{a.target===n&&s()})}function Dt(e){let t=ze().sort((r,n)=>n.savedAt-r.savedAt);e.innerHTML=`
    <div class="flex flex-col items-center justify-center min-h-screen gap-4 p-8">
      <h1 class="font-black text-yellow-400 text-center tracking-wider"
          style="font-size:clamp(3rem,12vw,6rem);line-height:1">
        \u0421\u0412\u041E\u042F \u0418\u0413\u0420\u0410
      </h1>
      <p class="text-gray-500 text-lg" style="margin-bottom:16px">
        \u0421\u043E\u0437\u0434\u0430\u0432\u0430\u0439 \u0432\u043E\u043F\u0440\u043E\u0441\u044B. \u0418\u0433\u0440\u0430\u0439 \u0441 \u0434\u0440\u0443\u0437\u044C\u044F\u043C\u0438.
      </p>

      <div class="flex flex-col gap-3 w-full max-w-xs">
        <button id="btn-new"
          class="py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-lg
                 transition-colors cursor-pointer border-0 text-white">
          \u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430
        </button>

        ${t.length>0?`
          <button id="btn-continue"
            class="py-4 bg-emerald-600 hover:bg-emerald-500 rounded-xl font-bold text-lg
                   transition-colors cursor-pointer border-0 text-white">
            \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C
          </button>
        `:""}

        <button id="btn-editor"
          class="py-4 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold text-lg
                 transition-colors cursor-pointer border-0 text-white">
          \u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432
        </button>
      </div>
    </div>
  `,e.querySelector("#btn-new").onclick=()=>L("setup"),e.querySelector("#btn-editor").onclick=()=>L("editor"),e.querySelector("#btn-continue")?.addEventListener("click",()=>{Mi(e,t)})}function Mi(e,t){document.getElementById("save-picker-modal")?.remove();let r=document.createElement("div");r.id="save-picker-modal",r.className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4",r.innerHTML=`
    <div class="bg-gray-900 border border-gray-700 rounded-2xl p-6 w-full shadow-2xl space-y-4"
         style="max-width:420px">
      <h3 class="text-xl font-bold text-center">\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0433\u0440\u0443</h3>
      <div class="space-y-2" style="max-height:18rem;overflow-y:auto">
        ${t.map(n=>`
          <div class="bg-gray-800 rounded-xl p-4 flex items-center gap-3">
            <div class="min-w-0 flex-1">
              <div class="font-bold text-sm truncate">${q(n.name)}</div>
              <div class="text-xs text-gray-400">${Ti(n.savedAt)}</div>
            </div>
            <div class="flex gap-2 shrink-0">
              <button data-resume="${q(n.id)}"
                class="bg-emerald-600 hover:bg-emerald-500 px-3 py-1.5 rounded-lg text-sm
                       font-bold transition-colors border-0 cursor-pointer text-white">\u25B6</button>
              <button data-del="${q(n.id)}"
                class="bg-red-700/80 hover:bg-red-600 px-3 py-1.5 rounded-lg text-sm
                       transition-colors border-0 cursor-pointer text-white">\u2715</button>
            </div>
          </div>
        `).join("")}
      </div>
      <button id="picker-close"
        class="w-full py-2.5 bg-gray-700 hover:bg-gray-600 rounded-xl text-sm
               transition-colors border-0 cursor-pointer text-white">
        \u0417\u0430\u043A\u0440\u044B\u0442\u044C
      </button>
    </div>
  `,document.body.appendChild(r),r.querySelectorAll("[data-resume]").forEach(n=>{n.addEventListener("click",()=>{let o=n.dataset.resume,i=ze().find(s=>s.id===o);i&&(ut(),dt(i.state),L("game-board"))})}),r.querySelectorAll("[data-del]").forEach(n=>{n.addEventListener("click",()=>{let o=n.dataset.del;be("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435?",()=>{lt(o),ut(),Dt(e)},{confirmLabel:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})})}),document.getElementById("picker-close")?.addEventListener("click",ut),r.addEventListener("click",n=>{n.target===r&&ut()})}function ut(){document.getElementById("save-picker-modal")?.remove()}function Ti(e){return new Date(e).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}var ce=[];function Ft(e){tn(),ce=[...Ot],$i(e),zt(e),Ii(e)}function $i(e){e.innerHTML=`
    <div class="min-h-screen flex flex-col justify-center py-6 px-8" style="max-width:480px;margin:0 auto">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0438\u0433\u0440\u044B</h2>
        <button id="btn-back"
          class="text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer text-base">
          \u2190 \u041D\u0430\u0437\u0430\u0434
        </button>
      </div>

      <div class="mb-6">
        <label class="block text-gray-400 text-sm mb-2">\u041D\u0430\u0431\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</label>
        <div class="flex gap-2">
          <select id="pack-select"
            class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white cursor-pointer">
            ${qe.map((t,r)=>`
              <option value="${r}" ${r===Ht?"selected":""}>
                ${q(t.title)} (${t.categories.length} \u043A\u0430\u0442.)
              </option>
            `).join("")}
          </select>
          <button id="btn-import"
            class="px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg border-0 text-white
                   cursor-pointer text-sm whitespace-nowrap">
            \u0418\u043C\u043F\u043E\u0440\u0442
          </button>
          <input type="file" id="file-input" accept=".json" class="hidden">
        </div>
      </div>

      <div class="mb-6">
        <label class="block text-gray-400 text-sm mb-2">\u0418\u0433\u0440\u043E\u043A\u0438</label>
        <div id="players-list" class="flex flex-col gap-2 mb-2"></div>
        <button id="btn-add-player"
          class="text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer text-sm">
          + \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0438\u0433\u0440\u043E\u043A\u0430
        </button>
      </div>

      <div class="mb-8">
        <label class="block text-gray-400 text-sm mb-2">
          \u0422\u0430\u0439\u043C\u0435\u0440 \u043D\u0430 \u0432\u043E\u043F\u0440\u043E\u0441 (\u0441\u0435\u043A), 0 = \u0431\u0435\u0437 \u0442\u0430\u0439\u043C\u0435\u0440\u0430
        </label>
        <input type="number" id="timer-input" value="${Bt}" min="0" max="600" step="5"
          class="w-24 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white">
      </div>

      <button id="btn-start"
        class="w-full py-4 bg-green-600 hover:bg-green-700 rounded-xl font-bold text-lg
               border-0 text-white cursor-pointer transition-colors">
        \u041D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443
      </button>
    </div>
  `}function zt(e){let t=e.querySelector("#players-list");t.innerHTML=ce.map((r,n)=>`
    <div class="flex gap-2 items-center">
      <input type="text" value="${q(r)}" data-idx="${n}"
        class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white">
      <button class="btn-remove text-red-400 bg-transparent border-0 cursor-pointer
                     text-xl px-2 hover:text-red-300" data-idx="${n}">\u2715</button>
    </div>
  `).join(""),t.querySelectorAll("input").forEach(r=>{r.oninput=()=>{ce[Number(r.dataset.idx)]=r.value}}),t.querySelectorAll(".btn-remove").forEach(r=>{r.onclick=()=>{ce.length<=1||(jt(e),ce.splice(Number(r.dataset.idx),1),zt(e))}})}function jt(e){e.querySelectorAll("#players-list input").forEach((t,r)=>{ce[r]=t.value.trim()||`\u0418\u0433\u0440\u043E\u043A ${r+1}`})}function Ii(e){e.querySelector("#btn-back").addEventListener("click",()=>L("home")),e.querySelector("#btn-import").addEventListener("click",()=>{e.querySelector("#file-input").click()}),e.querySelector("#file-input").addEventListener("change",t=>{let r=t.target.files?.[0];if(!r)return;let n=new FileReader;n.onload=()=>{try{let o=JSON.parse(n.result);if(!o.title||!Array.isArray(o.categories))throw new Error('\u041D\u0435\u0442 \u043F\u043E\u043B\u0435\u0439 "title" \u0438\u043B\u0438 "categories"');en(o),Ue(qe.length-1),Qe(`\u041D\u0430\u0431\u043E\u0440 \xAB${o.title}\xBB \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D!`,()=>Ft(e))}catch(o){Qe("\u041E\u0448\u0438\u0431\u043A\u0430 JSON: "+o.message)}},n.readAsText(r),t.target.value=""}),e.querySelector("#btn-add-player").addEventListener("click",()=>{jt(e),ce.push(`\u0418\u0433\u0440\u043E\u043A ${ce.length+1}`),zt(e)}),e.querySelector("#btn-start").addEventListener("click",()=>{jt(e);let t=Number(e.querySelector("#pack-select").value),r=Number(e.querySelector("#timer-input").value)||0;Ue(t),Yr([...ce]),Xr(r);let n=qe[t],o=ce.map(s=>({name:s.trim()||"\u0418\u0433\u0440\u043E\u043A",score:0})),i={id:Date.now().toString(),pack:n,players:o,timerSecs:r,answered:new Set,cur:null};dt(i),ct(i),L("game-board")})}function sn(e){if(!M){L("home");return}e.innerHTML=`
    <div class="min-h-screen flex flex-col justify-center py-4 px-4 w-full"
         style="max-width:1280px;margin:0 auto">

      <div class="flex items-center justify-between mb-3">
        <h1 class="text-xl font-bold">\u0421\u0432\u043E\u044F \u0418\u0433\u0440\u0430</h1>
        <div class="flex gap-2 items-center">
          <button id="btn-finish"
            class="px-3 py-1.5 bg-red-600/80 hover:bg-red-500 rounded-lg border-0
                   text-white text-xs cursor-pointer transition-colors">
            \u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C
          </button>
          <button id="btn-home"
            class="text-gray-400 hover:text-white bg-transparent border-0 cursor-pointer text-xs">
            \u2190 \u0413\u043B\u0430\u0432\u043D\u0430\u044F
          </button>
        </div>
      </div>

      <div id="board-grid" class="gboard w-full"></div>

      <div id="scores-bar" class="mt-3 flex justify-center flex-wrap gap-3"></div>
    </div>
  `,Ni(e),Ri(e),e.querySelector("#btn-finish").addEventListener("click",()=>L("results")),e.querySelector("#btn-home").addEventListener("click",()=>{be('\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u043D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E?<br><span class="text-gray-400 text-sm">\u041F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D.</span>',()=>L("home"),{confirmLabel:"\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E",confirmClass:"bg-blue-600 hover:bg-blue-500"})})}function Ni(e){let t=M,r=t.pack.categories,n=[...new Set(r.flatMap(i=>i.questions.map(s=>s.value)))].sort((i,s)=>i-s),o=e.querySelector("#board-grid");o.style.gridTemplateColumns=`minmax(160px,260px) ${n.map(()=>"minmax(0,1fr)").join(" ")}`,r.forEach((i,s)=>{let a=document.createElement("div");a.className="cat-cell",a.textContent=i.name,o.appendChild(a),n.forEach(d=>{let c=i.questions.findIndex(g=>g.value===d),h=document.createElement("div");if(c===-1)h.className="val-cell done";else{let g=`${s}-${c}`,m=t.answered.has(g);h.className="val-cell"+(m?" done":""),m||(h.textContent=String(d),h.addEventListener("click",()=>{t.cur={catIdx:s,qIdx:c},L("question")}))}o.appendChild(h)})})}function Ri(e){let t=e.querySelector("#scores-bar");t.innerHTML=M.players.map(r=>`
    <div class="score-card">
      <div class="sc-name">${q(r.name)}</div>
      <div class="sc-val">${r.score}</div>
    </div>
  `).join("")}var an=["white","black"];var Ae=["a","b","c","d","e","f","g","h"],Oe=["1","2","3","4","5","6","7","8"];var cn=[...Oe].reverse(),pt=Array.prototype.concat(...Ae.map(e=>Oe.map(t=>e+t))),W=e=>pt[8*e[0]+e[1]],E=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49];var ft=pt.map(E);function dn(e){let t,r=()=>(t===void 0&&(t=e()),t);return r.clear=()=>{t=void 0},r}var un=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;let t=performance.now()-e;return e=void 0,t}}},ht=e=>e==="white"?"black":"white",ve=(e,t)=>{let r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},We=(e,t)=>e.role===t.role&&e.color===t.color,xe=e=>(t,r)=>[(r?t[0]:7-t[0])*e.width/8,(r?7-t[1]:t[1])*e.height/8],ee=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},Ut=(e,t,r=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${r})`},Ge=(e,t)=>{e.style.visibility=t?"visible":"hidden"},de=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},gt=e=>e.button===2,te=(e,t)=>{let r=document.createElement(e);return t&&(r.className=t),r};function mt(e,t,r){let n=E(e);return t||(n[0]=7-n[0],n[1]=7-n[1]),[r.left+r.width*n[0]/8+r.width/16,r.top+r.height*(7-n[1])/8+r.height/16]}var Le=(e,t)=>Math.abs(e-t),Ki=e=>(t,r,n,o)=>Le(t,n)<2&&(e==="white"?o===r+1||r<=1&&o===r+2&&t===n:o===r-1||r>=6&&o===r-2&&t===n),Qt=(e,t,r,n)=>{let o=Le(e,r),i=Le(t,n);return o===1&&i===2||o===2&&i===1},pn=(e,t,r,n)=>Le(e,r)===Le(t,n),fn=(e,t,r,n)=>e===r||t===n,Wt=(e,t,r,n)=>pn(e,t,r,n)||fn(e,t,r,n),Hi=(e,t,r)=>(n,o,i,s)=>Le(n,i)<2&&Le(o,s)<2||r&&o===s&&o===(e==="white"?0:7)&&(n===4&&(i===2&&t.includes(0)||i===6&&t.includes(7))||t.includes(i));function Oi(e,t){let r=t==="white"?"1":"8",n=[];for(let[o,i]of e)o[1]===r&&i.color===t&&i.role==="rook"&&n.push(E(o)[0]);return n}function Gt(e,t,r){let n=e.get(t);if(!n)return[];let o=E(t),i=n.role,s=i==="pawn"?Ki(n.color):i==="knight"?Qt:i==="bishop"?pn:i==="rook"?fn:i==="queen"?Wt:Hi(n.color,Oi(e,n.color),r);return ft.filter(a=>(o[0]!==a[0]||o[1]!==a[1])&&s(o[0],o[1],a[0],a[1])).map(W)}function Z(e,...t){e&&setTimeout(()=>e(...t),1)}function hn(e){e.orientation=ht(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function gn(e,t){for(let[r,n]of t)n?e.pieces.set(r,n):e.pieces.delete(r)}function mn(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(let[r,n]of e.pieces)n.role==="king"&&n.color===t&&(e.check=r)}function Bi(e,t,r,n){se(e),e.premovable.current=[t,r],Z(e.premovable.events.set,t,r,n)}function ie(e){e.premovable.current&&(e.premovable.current=void 0,Z(e.premovable.events.unset))}function Di(e,t,r){ie(e),e.predroppable.current={role:t,key:r},Z(e.predroppable.events.set,t,r)}function se(e){let t=e.predroppable;t.current&&(t.current=void 0,Z(t.events.unset))}function ji(e,t,r){if(!e.autoCastle)return!1;let n=e.pieces.get(t);if(!n||n.role!=="king")return!1;let o=E(t),i=E(r);if(o[1]!==0&&o[1]!==7||o[1]!==i[1])return!1;o[0]===4&&!e.pieces.has(r)&&(i[0]===6?r=W([7,i[1]]):i[0]===2&&(r=W([0,i[1]])));let s=e.pieces.get(r);return!s||s.color!==n.color||s.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(r),o[0]<i[0]?(e.pieces.set(W([6,i[1]]),n),e.pieces.set(W([5,i[1]]),s)):(e.pieces.set(W([2,i[1]]),n),e.pieces.set(W([3,i[1]]),s)),!0)}function Zt(e,t,r){let n=e.pieces.get(t),o=e.pieces.get(r);if(t===r||!n)return!1;let i=o&&o.color!==n.color?o:void 0;return r===e.selected&&G(e),Z(e.events.move,t,r,i),ji(e,t,r)||(e.pieces.set(r,n),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,Z(e.events.change),i||!0}function bt(e,t,r,n){if(e.pieces.has(r))if(n)e.pieces.delete(r);else return!1;return Z(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,Z(e.events.change),e.movable.dests=void 0,e.turnColor=ht(e.turnColor),!0}function bn(e,t,r){let n=Zt(e,t,r);return n&&(e.movable.dests=void 0,e.turnColor=ht(e.turnColor),e.animation.current=void 0),n}function Vt(e,t,r){if(xt(e,t,r)){let n=bn(e,t,r);if(n){let o=e.hold.stop();G(e);let i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return n!==!0&&(i.captured=n),Z(e.movable.events.after,t,r,i),!0}}else if(zi(e,t,r))return Bi(e,t,r,{ctrlKey:e.stats.ctrlKey}),G(e),!0;return G(e),!1}function vt(e,t,r,n){let o=e.pieces.get(t);o&&(Fi(e,t,r)||n)?(e.pieces.delete(t),bt(e,o,r,n),Z(e.movable.events.afterNewPiece,o.role,r,{premove:!1,predrop:!1})):o&&Ui(e,t,r)?Di(e,o.role,r):(ie(e),se(e)),e.pieces.delete(t),G(e)}function Ve(e,t,r){if(Z(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){G(e),e.hold.cancel();return}else if((e.selectable.enabled||r)&&e.selected!==t&&Vt(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(vn(e,t)||Yt(e,t))&&(Jt(e,t),e.hold.start())}function Jt(e,t){e.selected=t,Yt(e,t)?e.premovable.customDests||(e.premovable.dests=Gt(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function G(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function vn(e,t){let r=e.pieces.get(t);return!!r&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}var xt=(e,t,r)=>{var n,o;return t!==r&&vn(e,t)&&(e.movable.free||!!(!((o=(n=e.movable.dests)===null||n===void 0?void 0:n.get(t))===null||o===void 0)&&o.includes(r)))};function Fi(e,t,r){let n=e.pieces.get(t);return!!n&&(t===r||!e.pieces.has(r))&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function Yt(e,t){let r=e.pieces.get(t);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function zi(e,t,r){var n,o;let i=(o=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(t))!==null&&o!==void 0?o:Gt(e.pieces,t,e.premovable.castle);return t!==r&&Yt(e,t)&&i.includes(r)}function Ui(e,t,r){let n=e.pieces.get(t),o=e.pieces.get(r);return!!n&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(n.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&e.movable.color===n.color&&e.turnColor!==n.color}function xn(e,t){let r=e.pieces.get(t);return!!r&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}function yn(e){let t=e.premovable.current;if(!t)return!1;let r=t[0],n=t[1],o=!1;if(xt(e,r,n)){let i=bn(e,r,n);if(i){let s={premove:!0};i!==!0&&(s.captured=i),Z(e.movable.events.after,r,n,s),o=!0}}return ie(e),o}function wn(e,t){let r=e.predroppable.current,n=!1;if(!r)return!1;if(t(r)){let o={role:r.role,color:e.movable.color};bt(e,o,r.key)&&(Z(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),n=!0)}return se(e),n}function Je(e){ie(e),se(e),G(e)}function Xt(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Je(e)}function ae(e,t,r){let n=Math.floor(8*(e[0]-r.left)/r.width);t||(n=7-n);let o=7-Math.floor(8*(e[1]-r.top)/r.height);return t||(o=7-o),n>=0&&n<8&&o>=0&&o<8?W([n,o]):void 0}function kn(e,t,r,n){let o=E(e),i=ft.filter(c=>Wt(o[0],o[1],c[0],c[1])||Qt(o[0],o[1],c[0],c[1])),a=i.map(c=>mt(W(c),r,n)).map(c=>ve(t,c)),[,d]=a.reduce((c,h,g)=>c[0]<h?c:[h,g],[a[0],0]);return W(i[d])}var I=e=>e.orientation==="white";var tr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Qi={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Wi={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function yt(e){e==="start"&&(e=tr);let t=new Map,r=7,n=0;for(let o of e)switch(o){case" ":case"[":return t;case"/":if(--r,r<0)return t;n=0;break;case"~":{let i=t.get(W([n-1,r]));i&&(i.promoted=!0);break}default:{let i=o.charCodeAt(0);if(i<57)n+=i-48;else{let s=o.toLowerCase();t.set(W([n,r]),{role:Qi[s],color:o===s?"black":"white"}),++n}}}return t}function Pn(e){return cn.map(t=>Ae.map(r=>{let n=e.get(r+t);if(n){let o=Wi[n.role];return n.color==="white"&&(o=o.toUpperCase()),n.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function rr(e,t){t.animation&&(nr(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function wt(e,t){var r,n,o;if(!((r=t.movable)===null||r===void 0)&&r.dests&&(e.movable.dests=void 0),!((n=t.drawable)===null||n===void 0)&&n.autoShapes&&(e.drawable.autoShapes=[]),nr(e,t),t.fen&&(e.pieces=yt(t.fen),e.drawable.shapes=((o=t.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in t&&mn(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Jt(e,e.selected),rr(e,t),!e.movable.rookCastle&&e.movable.dests){let i=e.movable.color==="white"?"1":"8",s="e"+i,a=e.movable.dests.get(s),d=e.pieces.get(s);if(!a||!d||d.role!=="king")return;e.movable.dests.set(s,a.filter(c=>!(c==="a"+i&&a.includes("c"+i))&&!(c==="h"+i&&a.includes("g"+i))))}}function nr(e,t){for(let r in t)r==="__proto__"||r==="constructor"||!Object.prototype.hasOwnProperty.call(t,r)||(Object.prototype.hasOwnProperty.call(e,r)&&_n(e[r])&&_n(t[r])?nr(e[r],t[r]):e[r]=t[r])}function _n(e){if(typeof e!="object"||e===null)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}var fe=(e,t)=>t.animation.enabled?Ji(e,t):he(e,t);function he(e,t){let r=e(t);return t.dom.redraw(),r}var or=(e,t)=>({key:e,pos:E(e),piece:t}),Zi=(e,t)=>t.sort((r,n)=>ve(e.pos,r.pos)-ve(e.pos,n.pos))[0];function Vi(e,t){let r=new Map,n=[],o=new Map,i=[],s=[],a=new Map,d,c,h;for(let[g,m]of e)a.set(g,or(g,m));for(let g of pt)d=t.pieces.get(g),c=a.get(g),d?c?We(d,c.piece)||(i.push(c),s.push(or(g,d))):s.push(or(g,d)):c&&i.push(c);for(let g of s)c=Zi(g,i.filter(m=>We(g.piece,m.piece))),c&&(h=[c.pos[0]-g.pos[0],c.pos[1]-g.pos[1]],r.set(g.key,h.concat(h)),n.push(c.key));for(let g of i)n.includes(g.key)||o.set(g.key,g.piece);return{anims:r,fadings:o}}function Sn(e,t){let r=e.animation.current;if(r===void 0){e.dom.destroyed||e.dom.redrawNow();return}let n=1-(t-r.start)*r.frequency;if(n<=0)e.animation.current=void 0,e.dom.redrawNow();else{let o=Yi(n);for(let i of r.plan.anims.values())i[2]=i[0]*o,i[3]=i[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>Sn(e,i))}}function Ji(e,t){let r=new Map(t.pieces),n=e(t),o=Vi(r,t);if(o.anims.size||o.fadings.size){let i=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},i||Sn(t,performance.now())}else t.dom.redraw();return n}var Yi=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1;var Xi=["green","red","blue","yellow"];function En(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?G(e):Je(e);let r=de(t),n=ae(r,I(e),e.dom.bounds());n&&(e.drawable.current={orig:n,pos:r,brush:es(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Cn(e))}function Cn(e){requestAnimationFrame(()=>{let t=e.drawable.current;if(t){let r=ae(t.pos,I(e),e.dom.bounds());r||(t.snapToValidMove=!1);let n=t.snapToValidMove?kn(t.orig,t.pos,I(e),e.dom.bounds()):r;n!==t.mouseSq&&(t.mouseSq=n,t.dest=n!==t.orig?n:void 0,e.dom.redrawNow()),Cn(e)}})}function qn(e,t){e.drawable.current&&(e.drawable.current.pos=de(t))}function An(e){let t=e.drawable.current;t&&(t.mouseSq&&ts(e.drawable,t),ir(e))}function ir(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Ln(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Mn(e.drawable))}function es(e){var t;let r=(e.shiftKey||e.ctrlKey)&&gt(e),n=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Xi[(r?1:0)+(n?2:0)]}function ts(e,t){let r=o=>o.orig===t.orig&&o.dest===t.dest,n=e.shapes.find(r);n&&(e.shapes=e.shapes.filter(o=>!r(o))),(!n||n.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Mn(e)}function Mn(e){e.onChange&&e.onChange(e.shapes)}function Tn(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;let r=e.dom.bounds(),n=de(t),o=ae(n,I(e),r);if(!o)return;let i=e.pieces.get(o),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!i||i.color!==e.turnColor)&&Ln(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||i||s||ns(e,n)))t.preventDefault();else if(t.touches)return;let a=!!e.premovable.current,d=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&xt(e,e.selected,o)?fe(g=>Ve(g,o),e):Ve(e,o);let c=e.selected===o,h=Kn(e,o);if(i&&h&&c&&xn(e,o)){e.draggable.current={orig:o,piece:i,origPos:n,pos:n,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},h.cgDragging=!0,h.classList.add("dragging");let g=e.dom.elements.ghost;g&&(g.className=`ghost ${i.color} ${i.role}`,ee(g,xe(r)(E(o),I(e))),Ge(g,!0)),sr(e)}else a&&ie(e),d&&se(e);e.dom.redraw()}function ns(e,t){let r=I(e),n=e.dom.bounds(),o=Math.pow(n.width/8,2);for(let i of e.pieces.keys()){let s=mt(i,r,n);if(ve(s,t)<=o)return!0}return!1}function $n(e,t,r,n){e.pieces.set("a0",t),e.dom.redraw();let i=de(r);e.draggable.current={orig:"a0",piece:t,origPos:i,pos:i,started:!0,element:()=>Kn(e,"a0"),originTarget:r.target,newPiece:!0,force:!!n,keyHasChanged:!1},sr(e)}function sr(e){requestAnimationFrame(()=>{var t;let r=e.draggable.current;if(!r)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(r.orig)&&(e.animation.current=void 0);let n=e.pieces.get(r.orig);if(!n||!We(n,r.piece))Me(e);else if(!r.started&&ve(r.pos,r.origPos)>=Math.pow(e.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){let i=r.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),r.element=i}let o=e.dom.bounds();ee(r.element,[r.pos[0]-o.left-o.width/16,r.pos[1]-o.top-o.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==ae(r.pos,I(e),o))}sr(e)})}function In(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=de(t))}function Nn(e,t){let r=e.draggable.current;if(!r)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&r.originTarget!==t.target&&!r.newPiece){e.draggable.current=void 0;return}ie(e),se(e);let n=de(t)||r.pos,o=ae(n,I(e),e.dom.bounds());o&&r.started&&r.orig!==o?r.newPiece?vt(e,r.orig,o,r.force):(e.stats.ctrlKey=t.ctrlKey,Vt(e,r.orig,o)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(r.orig),Z(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===o||!o)?G(e):e.selectable.enabled||G(e),Rn(e),e.draggable.current=void 0,e.dom.redraw()}function Me(e){let t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,G(e),Rn(e),e.dom.redraw())}function Rn(e){let t=e.dom.elements;t.ghost&&Ge(t.ghost,!1)}function Kn(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&r.tagName==="PIECE")return r;r=r.nextSibling}}function On(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Hn(e,2),setTimeout(()=>Hn(e,void 0),120)},120)}function Hn(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Bn(e,t){function r(){hn(e),t()}return{set(n){n.orientation&&n.orientation!==e.orientation&&r(),rr(e,n),(n.fen?fe:he)(o=>wt(o,n),e)},state:e,getFen:()=>Pn(e.pieces),toggleOrientation:r,setPieces(n){fe(o=>gn(o,n),e)},selectSquare(n,o){n?fe(i=>Ve(i,n,o),e):e.selected&&(G(e),e.dom.redraw())},move(n,o){fe(i=>Zt(i,n,o),e)},newPiece(n,o){fe(i=>bt(i,n,o),e)},playPremove(){if(e.premovable.current){if(fe(yn,e))return!0;e.dom.redraw()}return!1},playPredrop(n){if(e.predroppable.current){let o=wn(e,n);return e.dom.redraw(),o}return!1},cancelPremove(){he(ie,e)},cancelPredrop(){he(se,e)},cancelMove(){he(n=>{Je(n),Me(n)},e)},stop(){he(n=>{Xt(n),Me(n)},e)},explode(n){On(e,n)},setAutoShapes(n){he(o=>o.drawable.autoShapes=n,e)},setShapes(n){he(o=>o.drawable.shapes=n,e)},getKeyAtDomPos(n){return ae(n,I(e),e.dom.bounds())},redrawAll:t,dragNewPiece(n,o,i){$n(e,n,o,i)},destroy(){Xt(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Dn(){return{pieces:yt(tr),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:un()}}var jn={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Un(){let e=N("defs"),t=j(N("filter"),{id:"cg-filter-blur"});return t.appendChild(j(N("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function Qn(e,t,r){var n;let o=e.drawable,i=o.current,s=i&&i.mouseSq?i:void 0,a=new Map,d=e.dom.bounds(),c=o.autoShapes.filter(b=>!b.piece);for(let b of o.shapes.concat(c).concat(s?[s]:[])){if(!b.dest)continue;let y=(n=a.get(b.dest))!==null&&n!==void 0?n:new Set,x=_t(Pt(E(b.orig),e.orientation),d),$=_t(Pt(E(b.dest),e.orientation),d);y.add(lr(x,$)),a.set(b.dest,y)}let h=o.shapes.concat(c).map(b=>({shape:b,current:!1,hash:Fn(b,ar(b.dest,a),!1,d)}));s&&h.push({shape:s,current:!0,hash:Fn(s,ar(s.dest,a),!0,d)});let g=h.map(b=>b.hash).join(";");if(g===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=g;let m=t.querySelector("defs");is(o,h,m),ss(h,t.querySelector("g"),r.querySelector("g"),b=>cs(e,b,o.brushes,a,d))}function is(e,t,r){var n;let o=new Map,i;for(let d of t.filter(c=>c.shape.dest&&c.shape.brush))i=Wn(e.brushes[d.shape.brush],d.shape.modifiers),!((n=d.shape.modifiers)===null||n===void 0)&&n.hilite&&o.set(kt(i).key,kt(i)),o.set(i.key,i);let s=new Set,a=r.firstElementChild;for(;a;)s.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(let[d,c]of o.entries())s.has(d)||r.appendChild(ps(c))}function ss(e,t,r,n){let o=new Map;for(let i of e)o.set(i.hash,!1);for(let i of[t,r]){let s=[],a=i.firstElementChild,d;for(;a;)d=a.getAttribute("cgHash"),o.has(d)?o.set(d,!0):s.push(a),a=a.nextElementSibling;for(let c of s)i.removeChild(c)}for(let i of e.filter(s=>!o.get(s.hash)))for(let s of n(i))s.isCustom?r.appendChild(s.el):t.appendChild(s.el)}function Fn({orig:e,dest:t,brush:r,piece:n,modifiers:o,customSvg:i,label:s},a,d,c){var h,g;return[c.width,c.height,d,e,t,r,a&&"-",n&&as(n),o&&ls(o),i&&`custom-${zn(i.html)},${(g=(h=i.center)===null||h===void 0?void 0:h[0])!==null&&g!==void 0?g:"o"}`,s&&`label-${zn(s.text)}`].filter(m=>m).join(",")}function as(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function ls(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function zn(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function cs(e,{shape:t,current:r,hash:n},o,i,s){var a,d;let c=_t(Pt(E(t.orig),e.orientation),s),h=t.dest?_t(Pt(E(t.dest),e.orientation),s):c,g=t.brush&&Wn(o[t.brush],t.modifiers),m=i.get(t.dest),b=[];if(g){let y=j(N("g"),{cgHash:n});b.push({el:y}),c[0]!==h[0]||c[1]!==h[1]?y.appendChild(us(t,g,c,h,r,ar(t.dest,i))):y.appendChild(ds(o[t.brush],c,r,s))}if(t.label){let y=t.label;(a=y.fill)!==null&&a!==void 0||(y.fill=t.brush&&o[t.brush].color);let x=t.brush?void 0:"tr";b.push({el:fs(y,n,c,h,m,x),isCustom:!0})}if(t.customSvg){let y=(d=t.customSvg.center)!==null&&d!==void 0?d:"orig",[x,$]=y==="label"?Zn(c,h,m).map(B=>B-.5):y==="dest"?h:c,z=j(N("g"),{transform:`translate(${x},${$})`,cgHash:n});z.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,b.push({el:z,isCustom:!0})}return b}function ds(e,t,r,n){let o=hs(),i=(n.width+n.height)/(4*Math.max(n.width,n.height));return j(N("circle"),{stroke:e.color,"stroke-width":o[r?0:1],fill:"none",opacity:Gn(e,r),cx:t[0],cy:t[1],r:i-o[1]/2})}function kt(e){return["#ffffff","#fff","white"].includes(e.color)?jn.hilitePrimary:jn.hiliteWhite}function us(e,t,r,n,o,i){var s;function a(h){var g;let m=ms(i&&!o),b=n[0]-r[0],y=n[1]-r[1],x=Math.atan2(y,b),$=Math.cos(x)*m,z=Math.sin(x)*m;return j(N("line"),{stroke:h?kt(t).color:t.color,"stroke-width":gs(t,o)+(h?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${h?kt(t).key:t.key})`,opacity:!((g=e.modifiers)===null||g===void 0)&&g.hilite?1:Gn(t,o),x1:r[0],y1:r[1],x2:n[0]-$,y2:n[1]-z})}if(!(!((s=e.modifiers)===null||s===void 0)&&s.hilite))return a(!1);let d=N("g"),c=j(N("g"),{filter:"url(#cg-filter-blur)"});return c.appendChild(bs(r,n)),c.appendChild(a(!0)),d.appendChild(c),d.appendChild(a(!1)),d}function ps(e){let t=j(N("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(j(N("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function fs(e,t,r,n,o,i){var s;let d=.4*.75**e.text.length,c=Zn(r,n,o),h=i==="tr"?.4:0,g=j(N("g"),{transform:`translate(${c[0]+h},${c[1]-h})`,cgHash:t});g.appendChild(j(N("circle"),{r:.4/2,"fill-opacity":i?1:.8,"stroke-opacity":i?1:.7,"stroke-width":.03,fill:(s=e.fill)!==null&&s!==void 0?s:"#666",stroke:"white"}));let m=j(N("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return m.innerHTML=e.text,g.appendChild(m),g}function Pt(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function ar(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function N(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function j(e,t){for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function Wn(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(r=>r).join("")}:e}function hs(){return[3/64,4/64]}function gs(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Gn(e,t){return(e.opacity||1)*(t?.9:1)}function ms(e){return(e?20:10)/64}function _t(e,t){let r=Math.min(1,t.width/t.height),n=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*n]}function bs(e,t){let r={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return j(N("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function lr(e,t,r=!0){let n=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(n*8/Math.PI)+16)%16:n}function vs(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((r,n)=>r+n*n,0))}function Zn(e,t,r){let n=vs(e,t),o=lr(e,t,!1);if(r&&(n-=33/64,r.size>1)){n-=10/64;let i=lr(e,t);(r.has((i+1)%16)||r.has((i+15)%16))&&i&1&&(n-=.4)}return[e[0]-Math.cos(o)*n,e[1]-Math.sin(o)*n].map(i=>i+.5)}function Vn(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(let d of an)e.classList.toggle("orientation-"+d,t.orientation===d);e.classList.toggle("manipulable",!t.viewOnly);let r=te("cg-container");e.appendChild(r);let n=te("cg-board");r.appendChild(n);let o,i,s;if(t.drawable.visible&&(o=j(N("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(Un()),o.appendChild(N("g")),i=j(N("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(N("g")),s=te("cg-auto-pieces"),r.appendChild(o),r.appendChild(i),r.appendChild(s)),t.coordinates){let d=t.orientation==="black"?" black":"",c=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){let h=t.orientation==="white"?g=>g+1:g=>8-g;Ae.forEach((g,m)=>r.appendChild(cr(Oe.map(b=>g+b),"squares rank"+h(m)+d+c)))}else r.appendChild(cr(Oe,"ranks"+d+c)),r.appendChild(cr(Ae,"files"+d))}let a;return t.draggable.enabled&&t.draggable.showGhost&&(a=te("piece","ghost"),Ge(a,!1),r.appendChild(a)),{board:n,container:r,wrap:e,ghost:a,svg:o,customSvg:i,autoPieces:s}}function cr(e,t){let r=te("coords",t),n;for(let o of e)n=te("coord"),n.textContent=o,r.appendChild(n);return r}function Jn(e,t){if(!e.dropmode.active)return;ie(e),se(e);let r=e.dropmode.piece;if(r){e.pieces.set("a0",r);let n=de(t),o=n&&ae(n,I(e),e.dom.bounds());o&&vt(e,"a0",o)}e.dom.redraw()}function Xn(e,t){let r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",o=>o.preventDefault()),e.viewOnly)return;let n=ys(e);r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("mousedown",n,{passive:!1})}function eo(e,t){let r=[];if("ResizeObserver"in window||r.push(Ye(document.body,"chessground.resize",t)),!e.viewOnly){let n=Yn(e,In,qn),o=Yn(e,Nn,An);for(let s of["touchmove","mousemove"])r.push(Ye(document,s,n));for(let s of["touchend","mouseup"])r.push(Ye(document,s,o));let i=()=>e.dom.bounds.clear();r.push(Ye(document,"scroll",i,{capture:!0,passive:!0})),r.push(Ye(window,"resize",i,{passive:!0}))}return()=>r.forEach(n=>n())}function Ye(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}var ys=e=>t=>{e.draggable.current?Me(e):e.drawable.current?ir(e):t.shiftKey||gt(t)?e.drawable.enabled&&En(e,t):e.viewOnly||(e.dropmode.active?Jn(e,t):Tn(e,t))},Yn=(e,t,r)=>n=>{e.drawable.current?e.drawable.enabled&&r(e,n):e.viewOnly||t(e,n)};function ro(e){let t=I(e),r=xe(e.dom.bounds()),n=e.dom.elements.board,o=e.pieces,i=e.animation.current,s=i?i.plan.anims:new Map,a=i?i.plan.fadings:new Map,d=e.draggable.current,c=ks(e),h=new Set,g=new Set,m=new Map,b=new Map,y,x,$,z,B,Se,Ne,V,Re,Ke;for(x=n.firstChild;x;){if(y=x.cgKey,oo(x))if($=o.get(y),B=s.get(y),Se=a.get(y),z=x.cgPiece,x.cgDragging&&(!d||d.orig!==y)&&(x.classList.remove("dragging"),ee(x,r(E(y),t)),x.cgDragging=!1),!Se&&x.cgFading&&(x.cgFading=!1,x.classList.remove("fading")),$){if(B&&x.cgAnimating&&z===Xe($)){let A=E(y);A[0]+=B[2],A[1]+=B[3],x.classList.add("anim"),ee(x,r(A,t))}else x.cgAnimating&&(x.cgAnimating=!1,x.classList.remove("anim"),ee(x,r(E(y),t)),e.addPieceZIndex&&(x.style.zIndex=dr(E(y),t)));z===Xe($)&&(!Se||!x.cgFading)?h.add(y):Se&&z===Xe(Se)?(x.classList.add("fading"),x.cgFading=!0):ur(m,z,x)}else ur(m,z,x);else if(io(x)){let A=x.className;c.get(y)===A?g.add(y):ur(b,A,x)}x=x.nextSibling}for(let[A,me]of c)if(!g.has(A)){Re=b.get(me),Ke=Re&&Re.pop();let U=r(E(A),t);if(Ke)Ke.cgKey=A,ee(Ke,U);else{let J=te("square",me);J.cgKey=A,ee(J,U),n.insertBefore(J,n.firstChild)}}for(let[A,me]of o)if(B=s.get(A),!h.has(A))if(Ne=m.get(Xe(me)),V=Ne&&Ne.pop(),V){V.cgKey=A,V.cgFading&&(V.classList.remove("fading"),V.cgFading=!1);let U=E(A);e.addPieceZIndex&&(V.style.zIndex=dr(U,t)),B&&(V.cgAnimating=!0,V.classList.add("anim"),U[0]+=B[2],U[1]+=B[3]),ee(V,r(U,t))}else{let U=Xe(me),J=te("piece",U),Ee=E(A);J.cgPiece=U,J.cgKey=A,B&&(J.cgAnimating=!0,Ee[0]+=B[2],Ee[1]+=B[3]),ee(J,r(Ee,t)),e.addPieceZIndex&&(J.style.zIndex=dr(Ee,t)),n.appendChild(J)}for(let A of m.values())to(e,A);for(let A of b.values())to(e,A)}function no(e){let t=I(e),r=xe(e.dom.bounds()),n=e.dom.elements.board.firstChild;for(;n;)(oo(n)&&!n.cgAnimating||io(n))&&ee(n,r(E(n.cgKey),t)),n=n.nextSibling}function pr(e){var t,r;let n=e.dom.elements.wrap.getBoundingClientRect(),o=e.dom.elements.container,i=n.height/n.width,s=Math.floor(n.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=s*i;o.style.width=s+"px",o.style.height=a+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",s+"px"),(r=e.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",a+"px")}var oo=e=>e.tagName==="PIECE",io=e=>e.tagName==="SQUARE";function to(e,t){for(let r of t)e.dom.elements.board.removeChild(r)}function dr(e,t){let n=e[1];return`${t?10-n:3+n}`}var Xe=e=>`${e.color} ${e.role}`;function ks(e){var t,r,n;let o=new Map;if(e.lastMove&&e.highlight.lastMove)for(let a of e.lastMove)ge(o,a,"last-move");if(e.check&&e.highlight.check&&ge(o,e.check,"check"),e.selected&&(ge(o,e.selected,"selected"),e.movable.showDests)){let a=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(a)for(let c of a)ge(o,c,"move-dest"+(e.pieces.has(c)?" oc":""));let d=(n=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(e.selected))!==null&&n!==void 0?n:e.premovable.dests;if(d)for(let c of d)ge(o,c,"premove-dest"+(e.pieces.has(c)?" oc":""))}let i=e.premovable.current;if(i)for(let a of i)ge(o,a,"current-premove");else e.predroppable.current&&ge(o,e.predroppable.current.key,"current-premove");let s=e.exploding;if(s)for(let a of s.keys)ge(o,a,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach((a,d)=>{ge(o,d,a)}),o}function ge(e,t,r){let n=e.get(t);n?e.set(t,`${n} ${r}`):e.set(t,r)}function ur(e,t,r){let n=e.get(t);n?n.push(r):e.set(t,[r])}function so(e,t,r){let n=new Map,o=[];for(let a of e)n.set(a.hash,!1);let i=t.firstElementChild,s;for(;i;)s=i.getAttribute("cgHash"),n.has(s)?n.set(s,!0):o.push(i),i=i.nextElementSibling;for(let a of o)t.removeChild(a);for(let a of e)n.get(a.hash)||t.appendChild(r(a))}function ao(e,t){let n=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:_s(o),current:!1}));so(n,t,o=>Ps(e,o,e.dom.bounds()))}function lo(e){var t;let r=I(e),n=xe(e.dom.bounds()),o=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;o;)Ut(o,n(E(o.cgKey),r),o.cgScale),o=o.nextSibling}function Ps(e,{shape:t,hash:r},n){var o,i,s;let a=t.orig,d=(o=t.piece)===null||o===void 0?void 0:o.role,c=(i=t.piece)===null||i===void 0?void 0:i.color,h=(s=t.piece)===null||s===void 0?void 0:s.scale,g=te("piece",`${d} ${c}`);return g.setAttribute("cgHash",r),g.cgKey=a,g.cgScale=h,Ut(g,xe(n)(E(a),I(e)),h),g}var _s=e=>{var t,r,n;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(r=e.piece)===null||r===void 0?void 0:r.color,(n=e.piece)===null||n===void 0?void 0:n.scale].join(",")};function co(e,t){let r=Dn();wt(r,t||{});function n(){let o="dom"in r?r.dom.unbind:void 0,i=Vn(e,r),s=dn(()=>i.board.getBoundingClientRect()),a=h=>{ro(c),i.autoPieces&&ao(c,i.autoPieces),!h&&i.svg&&Qn(c,i.svg,i.customSvg)},d=()=>{pr(c),no(c),i.autoPieces&&lo(c)},c=r;return c.dom={elements:i,bounds:s,redraw:Es(a),redrawNow:a,unbind:o},c.drawable.prevSvgHash="",pr(c),a(!1),Xn(c,d),o||(c.dom.unbind=eo(c,d)),c.events.insert&&c.events.insert(i),c}return Bn(n(),n)}function Es(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}function Cs(e){return e!==null?{comment:e,variations:[]}:{variations:[]}}function qs(e,t,r,n,o){let i={move:e,variations:o};return t&&(i.suffix=t),r&&(i.nag=r),n!==null&&(i.comment=n),i}function As(...e){let[t,...r]=e,n=t;for(let o of r)o!==null&&(n.variations=[o,...o.variations],o.variations=[],n=o);return t}function Ls(e,t){if(t.marker&&t.marker.comment){let r=t.root;for(;;){let n=r.variations[0];if(!n){r.comment=t.marker.comment;break}r=n}}return{headers:e,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function Ms(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function De(e,t,r,n){var o=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(o,De.prototype),o.expected=t,o.found=r,o.location=n,o.name="SyntaxError",o}Ms(De,Error);function fr(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,r+=r.repeat(t),e+r.slice(0,t))}De.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){r=e[n].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,i=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(o):o,s=this.location.source+":"+i.line+":"+i.column;if(r){var a=this.location.end,d=fr("",i.line.toString().length," "),c=r[o.line-1],h=o.line===a.line?a.column:c.length+1,g=h-o.column||1;t+=`
 --> `+s+`
`+d+` |
`+i.line+" | "+c+`
`+d+" | "+fr("",o.column-1," ")+fr("",g,"^")}else t+=`
 at `+s}return t};De.buildMessage=function(e,t){var r={literal:function(c){return'"'+o(c.text)+'"'},class:function(c){var h=c.parts.map(function(g){return Array.isArray(g)?i(g[0])+"-"+i(g[1]):i(g)});return"["+(c.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function n(c){return c.charCodeAt(0).toString(16).toUpperCase()}function o(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+n(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+n(h)})}function i(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+n(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+n(h)})}function s(c){return r[c.type](c)}function a(c){var h=c.map(s),g,m;if(h.sort(),h.length>0){for(g=1,m=1;g<h.length;g++)h[g-1]!==h[g]&&(h[m]=h[g],m++);h.length=m}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function d(c){return c?'"'+o(c)+'"':"end of input"}return"Expected "+a(e)+" but "+d(t)+" found."};function Ts(e,t){t=t!==void 0?t:{};var r={},n=t.grammarSource,o={pgn:Br},i=Br,s="[",a='"',d="]",c=".",h="O-O-O",g="O-O",m="0-0-0",b="0-0",y="$",x="{",$="}",z=";",B="(",Se=")",Ne="1-0",V="0-1",Re="1/2-1/2",Ke="*",A=/^[a-zA-Z]/,me=/^[^"]/,U=/^[0-9]/,J=/^[.]/,Ee=/^[a-zA-Z1-8\-=]/,Co=/^[+#]/,Er=/^[!?]/,Cr=/^[^}]/,qr=/^[^\r\n]/,Ar=/^[ \t\r\n]/,qo=X("tag pair"),Ao=H("[",!1),Lr=H('"',!1),Lo=H("]",!1),Mo=X("tag name"),$t=le([["a","z"],["A","Z"]],!1,!1),To=X("tag value"),Mr=le(['"'],!0,!1),$o=X("move number"),ot=le([["0","9"]],!1,!1),Io=H(".",!1),Tr=le(["."],!1,!1),No=X("standard algebraic notation"),Ro=H("O-O-O",!1),Ko=H("O-O",!1),Ho=H("0-0-0",!1),Oo=H("0-0",!1),$r=le([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Bo=le(["+","#"],!1,!1),Do=X("suffix annotation"),Ir=le(["!","?"],!1,!1),jo=X("NAG"),Fo=H("$",!1),zo=X("brace comment"),Uo=H("{",!1),Nr=le(["}"],!0,!1),Qo=H("}",!1),Wo=X("rest of line comment"),Go=H(";",!1),Rr=le(["\r",`
`],!0,!1),Zo=X("variation"),Vo=H("(",!1),Jo=H(")",!1),Yo=X("game termination marker"),Xo=H("1-0",!1),ei=H("0-1",!1),ti=H("1/2-1/2",!1),ri=H("*",!1),ni=X("whitespace"),Kr=le([" ","	","\r",`
`],!1,!1),oi=function(l,p){return Ls(l,p)},ii=function(l){return Object.fromEntries(l)},si=function(l,p){return[l,p]},ai=function(l,p){return{root:l,marker:p}},li=function(l,p){return As(Cs(l),...p.flat())},ci=function(l,p,f,k,P){return qs(l,p,f,k,P)},di=function(l){return l},ui=function(l){return l.replace(/[\r\n]+/g," ")},pi=function(l){return l.trim()},fi=function(l){return l},hi=function(l,p){return{result:l,comment:p}},u=t.peg$currPos|0,He=[{line:1,column:1}],ne=u,it=t.peg$maxFailExpected||[],v=t.peg$silentFails|0,je;if(t.startRule){if(!(t.startRule in o))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');i=o[t.startRule]}function H(l,p){return{type:"literal",text:l,ignoreCase:p}}function le(l,p,f){return{type:"class",parts:l,inverted:p,ignoreCase:f}}function gi(){return{type:"end"}}function X(l){return{type:"other",description:l}}function Hr(l){var p=He[l],f;if(p)return p;if(l>=He.length)f=He.length-1;else for(f=l;!He[--f];);for(p=He[f],p={line:p.line,column:p.column};f<l;)e.charCodeAt(f)===10?(p.line++,p.column=1):p.column++,f++;return He[l]=p,p}function Or(l,p,f){var k=Hr(l),P=Hr(p),C={source:n,start:{offset:l,line:k.line,column:k.column},end:{offset:p,line:P.line,column:P.column}};return C}function w(l){u<ne||(u>ne&&(ne=u,it=[]),it.push(l))}function mi(l,p,f){return new De(De.buildMessage(l,p),l,p,f)}function Br(){var l,p,f;return l=u,p=bi(),f=yi(),l=oi(p,f),l}function bi(){var l,p,f;for(l=u,p=[],f=Dr();f!==r;)p.push(f),f=Dr();return f=Q(),l=ii(p),l}function Dr(){var l,p,f,k,P,C,Ce;return v++,l=u,Q(),e.charCodeAt(u)===91?(p=s,u++):(p=r,v===0&&w(Ao)),p!==r?(Q(),f=vi(),f!==r?(Q(),e.charCodeAt(u)===34?(k=a,u++):(k=r,v===0&&w(Lr)),k!==r?(P=xi(),e.charCodeAt(u)===34?(C=a,u++):(C=r,v===0&&w(Lr)),C!==r?(Q(),e.charCodeAt(u)===93?(Ce=d,u++):(Ce=r,v===0&&w(Lo)),Ce!==r?l=si(f,P):(u=l,l=r)):(u=l,l=r)):(u=l,l=r)):(u=l,l=r)):(u=l,l=r),v--,l===r&&v===0&&w(qo),l}function vi(){var l,p,f;if(v++,l=u,p=[],f=e.charAt(u),A.test(f)?u++:(f=r,v===0&&w($t)),f!==r)for(;f!==r;)p.push(f),f=e.charAt(u),A.test(f)?u++:(f=r,v===0&&w($t));else p=r;return p!==r?l=e.substring(l,u):l=p,v--,l===r&&(p=r,v===0&&w(Mo)),l}function xi(){var l,p,f;for(v++,l=u,p=[],f=e.charAt(u),me.test(f)?u++:(f=r,v===0&&w(Mr));f!==r;)p.push(f),f=e.charAt(u),me.test(f)?u++:(f=r,v===0&&w(Mr));return l=e.substring(l,u),v--,p=r,v===0&&w(To),l}function yi(){var l,p,f;return l=u,p=jr(),Q(),f=Ei(),f===r&&(f=null),Q(),l=ai(p,f),l}function jr(){var l,p,f,k;for(l=u,p=It(),p===r&&(p=null),f=[],k=Fr();k!==r;)f.push(k),k=Fr();return l=li(p,f),l}function Fr(){var l,p,f,k,P,C,Ce,st;if(l=u,Q(),wi(),Q(),p=ki(),p!==r){for(f=Pi(),f===r&&(f=null),k=[],P=zr();P!==r;)k.push(P),P=zr();for(P=Q(),C=It(),C===r&&(C=null),Ce=[],st=Ur();st!==r;)Ce.push(st),st=Ur();l=ci(p,f,k,C,Ce)}else u=l,l=r;return l}function wi(){var l,p,f,k,P,C;for(v++,l=u,p=[],f=e.charAt(u),U.test(f)?u++:(f=r,v===0&&w(ot));f!==r;)p.push(f),f=e.charAt(u),U.test(f)?u++:(f=r,v===0&&w(ot));if(e.charCodeAt(u)===46?(f=c,u++):(f=r,v===0&&w(Io)),f!==r){for(k=Q(),P=[],C=e.charAt(u),J.test(C)?u++:(C=r,v===0&&w(Tr));C!==r;)P.push(C),C=e.charAt(u),J.test(C)?u++:(C=r,v===0&&w(Tr));p=[p,f,k,P],l=p}else u=l,l=r;return v--,l===r&&(p=r,v===0&&w($o)),l}function ki(){var l,p,f,k,P,C;if(v++,l=u,p=u,e.substr(u,5)===h?(f=h,u+=5):(f=r,v===0&&w(Ro)),f===r&&(e.substr(u,3)===g?(f=g,u+=3):(f=r,v===0&&w(Ko)),f===r&&(e.substr(u,5)===m?(f=m,u+=5):(f=r,v===0&&w(Ho)),f===r&&(e.substr(u,3)===b?(f=b,u+=3):(f=r,v===0&&w(Oo)),f===r))))if(f=u,k=e.charAt(u),A.test(k)?u++:(k=r,v===0&&w($t)),k!==r){if(P=[],C=e.charAt(u),Ee.test(C)?u++:(C=r,v===0&&w($r)),C!==r)for(;C!==r;)P.push(C),C=e.charAt(u),Ee.test(C)?u++:(C=r,v===0&&w($r));else P=r;P!==r?(k=[k,P],f=k):(u=f,f=r)}else u=f,f=r;return f!==r?(k=e.charAt(u),Co.test(k)?u++:(k=r,v===0&&w(Bo)),k===r&&(k=null),f=[f,k],p=f):(u=p,p=r),p!==r?l=e.substring(l,u):l=p,v--,l===r&&(p=r,v===0&&w(No)),l}function Pi(){var l,p,f;for(v++,l=u,p=[],f=e.charAt(u),Er.test(f)?u++:(f=r,v===0&&w(Ir));f!==r;)p.push(f),p.length>=2?f=r:(f=e.charAt(u),Er.test(f)?u++:(f=r,v===0&&w(Ir)));return p.length<1?(u=l,l=r):l=p,v--,l===r&&(p=r,v===0&&w(Do)),l}function zr(){var l,p,f,k,P;if(v++,l=u,Q(),e.charCodeAt(u)===36?(p=y,u++):(p=r,v===0&&w(Fo)),p!==r){if(f=u,k=[],P=e.charAt(u),U.test(P)?u++:(P=r,v===0&&w(ot)),P!==r)for(;P!==r;)k.push(P),P=e.charAt(u),U.test(P)?u++:(P=r,v===0&&w(ot));else k=r;k!==r?f=e.substring(f,u):f=k,f!==r?l=di(f):(u=l,l=r)}else u=l,l=r;return v--,l===r&&v===0&&w(jo),l}function It(){var l;return l=_i(),l===r&&(l=Si()),l}function _i(){var l,p,f,k,P;if(v++,l=u,e.charCodeAt(u)===123?(p=x,u++):(p=r,v===0&&w(Uo)),p!==r){for(f=u,k=[],P=e.charAt(u),Cr.test(P)?u++:(P=r,v===0&&w(Nr));P!==r;)k.push(P),P=e.charAt(u),Cr.test(P)?u++:(P=r,v===0&&w(Nr));f=e.substring(f,u),e.charCodeAt(u)===125?(k=$,u++):(k=r,v===0&&w(Qo)),k!==r?l=ui(f):(u=l,l=r)}else u=l,l=r;return v--,l===r&&(p=r,v===0&&w(zo)),l}function Si(){var l,p,f,k,P;if(v++,l=u,e.charCodeAt(u)===59?(p=z,u++):(p=r,v===0&&w(Go)),p!==r){for(f=u,k=[],P=e.charAt(u),qr.test(P)?u++:(P=r,v===0&&w(Rr));P!==r;)k.push(P),P=e.charAt(u),qr.test(P)?u++:(P=r,v===0&&w(Rr));f=e.substring(f,u),l=pi(f)}else u=l,l=r;return v--,l===r&&(p=r,v===0&&w(Wo)),l}function Ur(){var l,p,f,k;return v++,l=u,Q(),e.charCodeAt(u)===40?(p=B,u++):(p=r,v===0&&w(Vo)),p!==r?(f=jr(),f!==r?(Q(),e.charCodeAt(u)===41?(k=Se,u++):(k=r,v===0&&w(Jo)),k!==r?l=fi(f):(u=l,l=r)):(u=l,l=r)):(u=l,l=r),v--,l===r&&v===0&&w(Zo),l}function Ei(){var l,p,f;return v++,l=u,e.substr(u,3)===Ne?(p=Ne,u+=3):(p=r,v===0&&w(Xo)),p===r&&(e.substr(u,3)===V?(p=V,u+=3):(p=r,v===0&&w(ei)),p===r&&(e.substr(u,7)===Re?(p=Re,u+=7):(p=r,v===0&&w(ti)),p===r&&(e.charCodeAt(u)===42?(p=Ke,u++):(p=r,v===0&&w(ri))))),p!==r?(Q(),f=It(),f===r&&(f=null),l=hi(p,f)):(u=l,l=r),v--,l===r&&(p=r,v===0&&w(Yo)),l}function Q(){var l,p;for(v++,l=[],p=e.charAt(u),Ar.test(p)?u++:(p=r,v===0&&w(Kr));p!==r;)l.push(p),p=e.charAt(u),Ar.test(p)?u++:(p=r,v===0&&w(Kr));return v--,p=r,v===0&&w(ni),l}if(je=i(),t.peg$library)return{peg$result:je,peg$currPos:u,peg$FAILED:r,peg$maxFailExpected:it,peg$maxFailPos:ne};if(je!==r&&u===e.length)return je;throw je!==r&&u<e.length&&w(gi()),mi(it,ne<e.length?e.charAt(ne):null,ne<e.length?Or(ne,ne+1):Or(ne,ne))}var Et=0xffffffffffffffffn;function hr(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function uo(e,t){return e*t&Et}function $s(e){return function(){let t=BigInt(e&Et),r=BigInt(e>>64n&Et),n=uo(hr(uo(t,5n),7n),9n);return r^=t,t=(hr(t,24n)^r^r<<16n)&Et,r=hr(r,37n),e=r<<64n|t,n}}var At=$s(0xa187eb39cdcaed8f31c4b365b102e01en),Is=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>At()))),Ns=Array.from({length:8},()=>At()),Rs=Array.from({length:16},()=>At()),gr=At(),F="w",Y="b",R="p",yr="n",Ct="b",tt="r",ke="q",K="k",mr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Be=class{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(t,r){let{color:n,piece:o,from:i,to:s,flags:a,captured:d,promotion:c}=r,h=O(i),g=O(s);this.color=n,this.piece=o,this.from=h,this.to=g,this.san=t._moveToSan(r,t._moves({legal:!0})),this.lan=h+g,this.before=t.fen(),t._makeMove(r),this.after=t.fen(),t._undoMove(),this.flags="";for(let m in S)S[m]&a&&(this.flags+=Te[m]);d&&(this.captured=d),c&&(this.promotion=c,this.lan+=c)}isCapture(){return this.flags.indexOf(Te.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Te.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Te.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Te.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Te.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Te.BIG_PAWN)>-1}},D=-1,Te={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"};var S={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},wr={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Ks={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Hs={...wr,...Ks},_={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},br={b:[16,32,17,15],w:[-16,-32,-17,-15]},po={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Os=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Bs=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Ds={p:1,n:2,b:4,r:8,q:16,k:32},js="pnbrqkPNBRQK",fo=[yr,Ct,tt,ke],Fs=7,zs=6,Us=1,Qs=0,St={[K]:S.KSIDE_CASTLE,[ke]:S.QSIDE_CASTLE},ye={w:[{square:_.a1,flag:S.QSIDE_CASTLE},{square:_.h1,flag:S.KSIDE_CASTLE}],b:[{square:_.a8,flag:S.QSIDE_CASTLE},{square:_.h8,flag:S.KSIDE_CASTLE}]},Ws={b:Us,w:zs},vr="--";function $e(e){return e>>4}function rt(e){return e&15}function go(e){return"0123456789".indexOf(e)!==-1}function O(e){let t=rt(e),r=$e(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function et(e){return e===F?Y:F}function Gs(e){let t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let r=parseInt(t[5],10);if(isNaN(r)||r<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let n=parseInt(t[4],10);if(isNaN(n)||n<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let o=t[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let s=0;s<o.length;s++){let a=0,d=!1;for(let c=0;c<o[s].length;c++)if(go(o[s][c])){if(d)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(o[s][c],10),d=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[s][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,d=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};let i=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(let{color:s,regex:a}of i){if(!a.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${s} king`};if((t[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${s} kings`}}return Array.from(o[0]+o[7]).some(s=>s.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Zs(e,t){let r=e.from,n=e.to,o=e.piece,i=0,s=0,a=0;for(let d=0,c=t.length;d<c;d++){let h=t[d].from,g=t[d].to,m=t[d].piece;o===m&&r!==h&&n===g&&(i++,$e(r)===$e(h)&&s++,rt(r)===rt(h)&&a++)}return i>0?s>0&&a>0?O(r):a>0?O(r).charAt(1):O(r).charAt(0):""}function we(e,t,r,n,o,i=void 0,s=S.NORMAL){let a=$e(n);if(o===R&&(a===Fs||a===Qs))for(let d=0;d<fo.length;d++){let c=fo[d];e.push({color:t,from:r,to:n,piece:o,captured:i,promotion:c,flags:s|S.PROMOTION})}else e.push({color:t,from:r,to:n,piece:o,captured:i,flags:s})}function ho(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:R:(t=t.toLowerCase(),t==="o"?K:t)}function xr(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}var qt=class{_board=new Array(128);_turn=F;_header={};_kings={w:D,b:D};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(t=mr,{skipValidation:r=!1}={}){this.load(t,{skipValidation:r})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:D,b:D},this._turn=F,this._castling={w:0,b:0},this._epSquare=D,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Hs},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:r=!1,preserveHeaders:n=!1}={}){let o=t.split(/\s+/);if(o.length>=2&&o.length<6){let a=["-","-","0","1"];t=o.concat(a.slice(-(6-o.length))).join(" ")}if(o=t.split(/\s+/),!r){let{ok:a,error:d}=Gs(t);if(!a)throw new Error(d)}let i=o[0],s=0;this.clear({preserveHeaders:n});for(let a=0;a<i.length;a++){let d=i.charAt(a);if(d==="/")s+=8;else if(go(d))s+=parseInt(d,10);else{let c=d<"a"?F:Y;this._put({type:d.toLowerCase(),color:c},O(s)),s++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=S.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=S.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=S.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=S.QSIDE_CASTLE),this._epSquare=o[3]==="-"?D:_[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){let r=0,n="";for(let s=_.a8;s<=_.h1;s++){if(this._board[s]){r>0&&(n+=r,r=0);let{color:a,type:d}=this._board[s];n+=a===F?d.toUpperCase():d.toLowerCase()}else r++;s+1&136&&(r>0&&(n+=r),s!==_.h1&&(n+="/"),r=0,s+=8)}let o="";this._castling[F]&S.KSIDE_CASTLE&&(o+="K"),this._castling[F]&S.QSIDE_CASTLE&&(o+="Q"),this._castling[Y]&S.KSIDE_CASTLE&&(o+="k"),this._castling[Y]&S.QSIDE_CASTLE&&(o+="q"),o=o||"-";let i="-";if(this._epSquare!==D)if(t)i=O(this._epSquare);else{let s=this._epSquare+(this._turn===F?16:-16),a=[s+1,s-1];for(let d of a){if(d&136)continue;let c=this._turn;if(this._board[d]?.color===c&&this._board[d]?.type===R){this._makeMove({color:c,from:d,to:this._epSquare,piece:R,captured:R,flags:S.EP_CAPTURE});let h=!this._isKingAttacked(c);if(this._undoMove(),h){i=O(this._epSquare);break}}}}return[n,this._turn,o,i,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;let{color:r,type:n}=this._board[t],o={w:0,b:1}[r],i={p:0,n:1,b:2,r:3,q:4,k:5}[n];return Is[o][i][t]}_epKey(){return this._epSquare===D?0n:Ns[this._epSquare&7]}_castlingKey(){let t=this._castling.w>>5|this._castling.b>>3;return Rs[t]}_computeHash(){let t=0n;for(let r=_.a8;r<=_.h1;r++){if(r&136){r+=7;continue}this._board[r]&&(t^=this._pieceKey(r))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=gr),t}_updateSetup(t){this._history.length>0||(t!==mr?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(mr)}get(t){return this._board[_[t]]}findPiece(t){let r=[];for(let n=_.a8;n<=_.h1;n++){if(n&136){n+=7;continue}!this._board[n]||this._board[n]?.color!==t.color||this._board[n].color===t.color&&this._board[n].type===t.type&&r.push(O(n))}return r}put({type:t,color:r},n){return this._put({type:t,color:r},n)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,r){this._hash^=this._pieceKey(t),this._board[t]=r,this._hash^=this._pieceKey(t)}_put({type:t,color:r},n){if(js.indexOf(t.toLowerCase())===-1||!(n in _))return!1;let o=_[n];if(t==K&&!(this._kings[r]==D||this._kings[r]==o))return!1;let i=this._board[o];return i&&i.type===K&&(this._kings[i.color]=D),this._set(o,{type:t,color:r}),t===K&&(this._kings[r]=o),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){let r=this.get(t);return this._clear(_[t]),r&&r.type===K&&(this._kings[r.color]=D),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),r}_updateCastlingRights(){this._hash^=this._castlingKey();let t=this._board[_.e1]?.type===K&&this._board[_.e1]?.color===F,r=this._board[_.e8]?.type===K&&this._board[_.e8]?.color===Y;(!t||this._board[_.a1]?.type!==tt||this._board[_.a1]?.color!==F)&&(this._castling.w&=-65),(!t||this._board[_.h1]?.type!==tt||this._board[_.h1]?.color!==F)&&(this._castling.w&=-33),(!r||this._board[_.a8]?.type!==tt||this._board[_.a8]?.color!==Y)&&(this._castling.b&=-65),(!r||this._board[_.h8]?.type!==tt||this._board[_.h8]?.color!==Y)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===D)return;let t=this._epSquare+(this._turn===F?-16:16),r=this._epSquare+(this._turn===F?16:-16),n=[r+1,r-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||this._board[r]?.color!==et(this._turn)||this._board[r]?.type!==R){this._hash^=this._epKey(),this._epSquare=D;return}let o=i=>!(i&136)&&this._board[i]?.color===this._turn&&this._board[i]?.type===R;n.some(o)||(this._hash^=this._epKey(),this._epSquare=D)}_attacked(t,r,n){let o=[];for(let i=_.a8;i<=_.h1;i++){if(i&136){i+=7;continue}if(this._board[i]===void 0||this._board[i].color!==t)continue;let s=this._board[i],a=i-r;if(a===0)continue;let d=a+119;if(Os[d]&Ds[s.type]){if(s.type===R){if(a>0&&s.color===F||a<=0&&s.color===Y)if(n)o.push(O(i));else return!0;continue}if(s.type==="n"||s.type==="k")if(n){o.push(O(i));continue}else return!0;let c=Bs[d],h=i+c,g=!1;for(;h!==r;){if(this._board[h]!=null){g=!0;break}h+=c}if(!g)if(n){o.push(O(i));continue}else return!0}}return n?o:!1}attackers(t,r){return r?this._attacked(r,_[t],!0):this._attacked(this._turn,_[t],!0)}_isKingAttacked(t){let r=this._kings[t];return r===-1?!1:this._attacked(et(t),r)}hash(){return this._hash.toString(16)}isAttacked(t,r){return this._attacked(r,_[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){let t={b:0,n:0,r:0,q:0,k:0,p:0},r=[],n=0,o=0;for(let i=_.a8;i<=_.h1;i++){if(o=(o+1)%2,i&136){i+=7;continue}let s=this._board[i];s&&(t[s.type]=s.type in t?t[s.type]+1:1,s.type===Ct&&r.push(o),n++)}if(n===2)return!0;if(n===3&&(t[Ct]===1||t[yr]===1))return!0;if(n===t[Ct]+2){let i=0,s=r.length;for(let a=0;a<s;a++)i+=r[a];if(i===0||i===s)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:r=void 0,piece:n=void 0}={}){let o=this._moves({square:r,piece:n});return t?o.map(i=>new Be(this,i)):o.map(i=>this._moveToSan(i,o))}_moves({legal:t=!0,piece:r=void 0,square:n=void 0}={}){let o=n?n.toLowerCase():void 0,i=r?.toLowerCase(),s=[],a=this._turn,d=et(a),c=_.a8,h=_.h1,g=!1;if(o)if(o in _)c=h=_[o],g=!0;else return[];for(let b=c;b<=h;b++){if(b&136){b+=7;continue}if(!this._board[b]||this._board[b].color===d)continue;let{type:y}=this._board[b],x;if(y===R){if(i&&i!==y)continue;x=b+br[a][0],this._board[x]||(we(s,a,b,x,R),x=b+br[a][1],Ws[a]===$e(b)&&!this._board[x]&&we(s,a,b,x,R,void 0,S.BIG_PAWN));for(let $=2;$<4;$++)x=b+br[a][$],!(x&136)&&(this._board[x]?.color===d?we(s,a,b,x,R,this._board[x].type,S.CAPTURE):x===this._epSquare&&we(s,a,b,x,R,R,S.EP_CAPTURE))}else{if(i&&i!==y)continue;for(let $=0,z=po[y].length;$<z;$++){let B=po[y][$];for(x=b;x+=B,!(x&136);){if(!this._board[x])we(s,a,b,x,y);else{if(this._board[x].color===a)break;we(s,a,b,x,y,this._board[x].type,S.CAPTURE);break}if(y===yr||y===K)break}}}}if((i===void 0||i===K)&&(!g||h===this._kings[a])){if(this._castling[a]&S.KSIDE_CASTLE){let b=this._kings[a],y=b+2;!this._board[b+1]&&!this._board[y]&&!this._attacked(d,this._kings[a])&&!this._attacked(d,b+1)&&!this._attacked(d,y)&&we(s,a,this._kings[a],y,K,void 0,S.KSIDE_CASTLE)}if(this._castling[a]&S.QSIDE_CASTLE){let b=this._kings[a],y=b-2;!this._board[b-1]&&!this._board[b-2]&&!this._board[b-3]&&!this._attacked(d,this._kings[a])&&!this._attacked(d,b-1)&&!this._attacked(d,y)&&we(s,a,this._kings[a],y,K,void 0,S.QSIDE_CASTLE)}}if(!t||this._kings[a]===-1)return s;let m=[];for(let b=0,y=s.length;b<y;b++)this._makeMove(s[b]),this._isKingAttacked(a)||m.push(s[b]),this._undoMove();return m}move(t,{strict:r=!1}={}){let n=null;if(typeof t=="string")n=this._moveFromSan(t,r);else if(t===null)n=this._moveFromSan(vr,r);else if(typeof t=="object"){let i=this._moves();for(let s=0,a=i.length;s<a;s++)if(t.from===O(i[s].from)&&t.to===O(i[s].to)&&(!("promotion"in i[s])||t.promotion===i[s].promotion)){n=i[s];break}}if(!n)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&n.flags&S.NULL_MOVE)throw new Error("Null move not allowed when in check");let o=new Be(this,n);return this._makeMove(n),this._incPositionCount(),o}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,r){this._hash^=this._pieceKey(t),this._board[r]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(r)}_makeMove(t){let r=this._turn,n=et(r);if(this._push(t),t.flags&S.NULL_MOVE){r===Y&&this._moveNumber++,this._halfMoves++,this._turn=n,this._epSquare=D;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&S.EP_CAPTURE&&(this._turn===Y?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:r})),this._board[t.to].type===K){if(this._kings[r]=t.to,t.flags&S.KSIDE_CASTLE){let o=t.to-1,i=t.to+1;this._movePiece(i,o)}else if(t.flags&S.QSIDE_CASTLE){let o=t.to+1,i=t.to-2;this._movePiece(i,o)}this._castling[r]=0}if(this._castling[r]){for(let o=0,i=ye[r].length;o<i;o++)if(t.from===ye[r][o].square&&this._castling[r]&ye[r][o].flag){this._castling[r]^=ye[r][o].flag;break}}if(this._castling[n]){for(let o=0,i=ye[n].length;o<i;o++)if(t.to===ye[n][o].square&&this._castling[n]&ye[n][o].flag){this._castling[n]^=ye[n][o].flag;break}}if(this._hash^=this._castlingKey(),t.flags&S.BIG_PAWN){let o;r===Y?o=t.to-16:o=t.to+16,!(t.to-1&136)&&this._board[t.to-1]?.type===R&&this._board[t.to-1]?.color===n||!(t.to+1&136)&&this._board[t.to+1]?.type===R&&this._board[t.to+1]?.color===n?(this._epSquare=o,this._hash^=this._epKey()):this._epSquare=D}else this._epSquare=D;t.piece===R?this._halfMoves=0:t.flags&(S.CAPTURE|S.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,r===Y&&this._moveNumber++,this._turn=n,this._hash^=gr}undo(){let t=this._hash,r=this._undoMove();if(r){let n=new Be(this,r);return this._decPositionCount(t),n}return null}_undoMove(){let t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();let r=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=gr;let n=this._turn,o=et(n);if(r.flags&S.NULL_MOVE)return r;if(this._movePiece(r.to,r.from),r.piece&&(this._clear(r.from),this._set(r.from,{type:r.piece,color:n})),r.captured)if(r.flags&S.EP_CAPTURE){let i;n===Y?i=r.to-16:i=r.to+16,this._set(i,{type:R,color:o})}else this._set(r.to,{type:r.captured,color:o});if(r.flags&(S.KSIDE_CASTLE|S.QSIDE_CASTLE)){let i,s;r.flags&S.KSIDE_CASTLE?(i=r.to+1,s=r.to-1):(i=r.to-2,s=r.to+1),this._movePiece(s,i)}return r}pgn({newline:t=`
`,maxWidth:r=0}={}){let n=[],o=!1;for(let m in this._header)this._header[m]&&n.push(`[${m} "${this._header[m]}"]`+t),o=!0;o&&this._history.length&&n.push(t);let i=m=>{let b=this._comments[this.fen()];if(typeof b<"u"){let y=m.length>0?" ":"";m=`${m}${y}{${b}}`}return m},s=[];for(;this._history.length>0;)s.push(this._undoMove());let a=[],d="";for(s.length===0&&a.push(i(""));s.length>0;){d=i(d);let m=s.pop();if(!m)break;if(!this._history.length&&m.color==="b"){let b=`${this._moveNumber}. ...`;d=d?`${d} ${b}`:b}else m.color==="w"&&(d.length&&a.push(d),d=this._moveNumber+".");d=d+" "+this._moveToSan(m,this._moves({legal:!0})),this._makeMove(m)}if(d.length&&a.push(i(d)),a.push(this._header.Result||"*"),r===0)return n.join("")+a.join(" ");let c=function(){return n.length>0&&n[n.length-1]===" "?(n.pop(),!0):!1},h=function(m,b){for(let y of b.split(" "))if(y){if(m+y.length>r){for(;c();)m--;n.push(t),m=0}n.push(y),m+=y.length,n.push(" "),m++}return c()&&m--,m},g=0;for(let m=0;m<a.length;m++){if(g+a[m].length>r&&a[m].includes("{")){g=h(g,a[m]);continue}g+a[m].length>r&&m!==0?(n[n.length-1]===" "&&n.pop(),n.push(t),g=0):m!==0&&(n.push(" "),g++),n.push(a[m]),g+=a[m].length}return n.join("")}header(...t){for(let r=0;r<t.length;r+=2)typeof t[r]=="string"&&typeof t[r+1]=="string"&&(this._header[t[r]]=t[r+1]);return this._header}setHeader(t,r){return this._header[t]=r??wr[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=wr[t]||null,!0):!1}getHeaders(){let t={};for(let[r,n]of Object.entries(this._header))n!==null&&(t[r]=n);return t}loadPgn(t,{strict:r=!1,newlineChar:n=`\r?
`}={}){n!==`\r?
`&&(t=t.replace(new RegExp(n,"g"),`
`));let o=Ts(t);this.reset();let i=o.headers,s="";for(let c in i)c.toLowerCase()==="fen"&&(s=i[c]),this.header(c,i[c]);if(!r)s&&this.load(s,{preserveHeaders:!0});else if(i.SetUp==="1"){if(!("FEN"in i))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(i.FEN,{preserveHeaders:!0})}let a=o.root;for(;a;){if(a.move){let c=this._moveFromSan(a.move,r);if(c==null)throw new Error(`Invalid move in PGN: ${a.move}`);this._makeMove(c),this._incPositionCount()}a.comment!==void 0&&(this._comments[this.fen()]=a.comment),a=a.variations[0]}let d=o.result;d&&Object.keys(this._header).length&&this._header.Result!==d&&this.setHeader("Result",d)}_moveToSan(t,r){let n="";if(t.flags&S.KSIDE_CASTLE)n="O-O";else if(t.flags&S.QSIDE_CASTLE)n="O-O-O";else{if(t.flags&S.NULL_MOVE)return vr;if(t.piece!==R){let o=Zs(t,r);n+=t.piece.toUpperCase()+o}t.flags&(S.CAPTURE|S.EP_CAPTURE)&&(t.piece===R&&(n+=O(t.from)[0]),n+="x"),n+=O(t.to),t.promotion&&(n+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?n+="#":n+="+"),this._undoMove(),n}_moveFromSan(t,r=!1){let n=xr(t);if(r||(n==="0-0"?n="O-O":n==="0-0-0"&&(n="O-O-O")),n==vr)return{color:this._turn,from:0,to:0,piece:"k",flags:S.NULL_MOVE};let o=ho(n),i=this._moves({legal:!0,piece:o});for(let m=0,b=i.length;m<b;m++)if(n===xr(this._moveToSan(i[m],i)))return i[m];if(r)return null;let s,a,d,c,h,g=!1;if(a=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(s=a[1],d=a[2],c=a[3],h=a[4],d.length==1&&(g=!0)):(a=n.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(s=a[1],d=a[2],c=a[3],h=a[4],d.length==1&&(g=!0))),o=ho(n),i=this._moves({legal:!0,piece:s||o}),!c)return null;for(let m=0,b=i.length;m<b;m++)if(d){if((!s||s.toLowerCase()==i[m].piece)&&_[d]==i[m].from&&_[c]==i[m].to&&(!h||h.toLowerCase()==i[m].promotion))return i[m];if(g){let y=O(i[m].from);if((!s||s.toLowerCase()==i[m].piece)&&_[c]==i[m].to&&(d==y[0]||d==y[1])&&(!h||h.toLowerCase()==i[m].promotion))return i[m]}}else if(n===xr(this._moveToSan(i[m],i)).replace("x",""))return i[m];return null}ascii(){let t=`   +------------------------+
`;for(let r=_.a8;r<=_.h1;r++){if(rt(r)===0&&(t+=" "+"87654321"[$e(r)]+" |"),this._board[r]){let n=this._board[r].type,i=this._board[r].color===F?n.toUpperCase():n.toLowerCase();t+=" "+i+" "}else t+=" . ";r+1&136&&(t+=`|
`,r+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){let r=this._moves({legal:!1}),n=0,o=this._turn;for(let i=0,s=r.length;i<s;i++)this._makeMove(r[i]),this._isKingAttacked(o)||(t-1>0?n+=this.perft(t-1):n++),this._undoMove();return n}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){let t=[],r=[];for(let n=_.a8;n<=_.h1;n++)this._board[n]==null?r.push(null):r.push({square:O(n),type:this._board[n].type,color:this._board[n].color}),n+1&136&&(t.push(r),r=[],n+=8);return t}squareColor(t){if(t in _){let r=_[t];return($e(r)+rt(r))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){let r=[],n=[];for(;this._history.length>0;)r.push(this._undoMove());for(;;){let o=r.pop();if(!o)break;t?n.push(new Be(this,o)):n.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return n}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){let r=this._positionCount.get(t)??0;r===1?this._positionCount.delete(t):this._positionCount.set(t,r-1)}_pruneComments(){let t=[],r={},n=o=>{o in this._comments&&(r[o]=this._comments[o])};for(;this._history.length>0;)t.push(this._undoMove());for(n(this.fen());;){let o=t.pop();if(!o)break;this._makeMove(o),n(this.fen())}this._comments=r}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){let t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{let r=this._comments[t];return delete this._comments[t],{fen:t,comment:r}})}setCastlingRights(t,r){for(let o of[K,ke])r[o]!==void 0&&(r[o]?this._castling[t]|=St[o]:this._castling[t]&=~St[o]);this._updateCastlingRights();let n=this.getCastlingRights(t);return(r[K]===void 0||r[K]===n[K])&&(r[ke]===void 0||r[ke]===n[ke])}getCastlingRights(t){return{[K]:(this._castling[t]&St[K])!==0,[ke]:(this._castling[t]&St[ke])!==0}}moveNumber(){return this._moveNumber}};function mo(e,t){let n=t.split(" ")[1]==="b"?"black":"white";co(e,{fen:t,orientation:n,coordinates:!0,animation:{enabled:!1},movable:{free:!1,color:void 0},draggable:{enabled:!1},selectable:{enabled:!1},drawable:{enabled:!0,visible:!0,eraseOnClick:!1}})}function bo(e){try{return new qt(e),!0}catch{return!1}}var Lt=null,Pe=0,pe=new Set,Pr=!1,ue=!1,nt=null;function yo(e){if(!M?.cur){L("game-board");return}pe=new Set,Pr=!1,ue=!1;let{catIdx:t,qIdx:r}=M.cur,n=M.pack.categories[t],o=n.questions[r],i=o.image?rn(o.image):"";e.innerHTML=`
    <div class="flex flex-col items-center min-h-screen px-4 pt-6 pb-12">

      <!-- Category \xB7 Value -->
      <div class="text-center mb-3">
        <span class="text-gray-400 text-sm">${q(n.name)}</span>
        <span class="text-gray-400 text-sm"> \xB7 </span>
        <span class="text-yellow-400 font-black" style="font-size:2.5rem;vertical-align:middle">
          ${q(o.value)}
        </span>
      </div>

      <!-- Chess board -->
      ${o.fen?'<div class="cg-container mb-4" id="cg-wrap"></div>':""}

      <!-- URL image -->
      ${i?`
        <div class="mb-4">
          <img src="${i}" alt=""
               class="rounded-xl" style="max-width:min(100%,480px);max-height:320px">
        </div>`:""}

      <!-- Question text -->
      <div class="font-bold text-center mb-5"
           style="font-size:1.5rem;max-width:580px;line-height:1.3">
        ${q(o.question)}
      </div>

      <!-- Answer (hidden until revealed) -->
      <div id="answer-block"
           class="hidden text-center mb-5 px-6 py-4 rounded-xl w-full"
           style="max-width:580px;background:#1f2937">
        <div class="text-gray-400 text-sm mb-1">\u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442:</div>
        <div class="font-semibold text-green-400" style="font-size:1.15rem">
          ${q(o.answer)}
        </div>
      </div>

      <!-- Selection hint -->
      <div id="hint" class="text-gray-500 text-xs mb-2">
        \u041D\u0430\u0436\u043C\u0438 \u043D\u0430 \u0438\u0433\u0440\u043E\u043A\u0430 \u2014 \u0435\u043C\u0443 \u043D\u0430\u0447\u0438\u0441\u043B\u044F\u0442\u0441\u044F \u043E\u0447\u043A\u0438
      </div>

      <!-- Lock indicator -->
      <div id="lock-badge" class="hidden mb-2 px-3 py-1 rounded-full text-xs font-bold"
           style="background:#374151;color:#9ca3af">
        \u{1F512} \u0417\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u043E
      </div>

      <!-- Single row: players + timer + action buttons -->
      <div class="flex gap-3 justify-center items-center flex-nowrap overflow-x-auto pb-1 w-full">

        <!-- Player buttons (injected by buildPlayerButtons) -->
        <div id="player-btns" class="flex gap-3 shrink-0"></div>

        <!-- Timer (inline, hidden by default) -->
        <div id="q-timer"
             class="hidden text-yellow-400 font-black text-2xl bg-gray-800 px-5 py-3 rounded-xl min-w-[84px] text-center shrink-0">
        </div>

        <button id="btn-show-answer"
          class="text-xl px-4 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 border-0 cursor-pointer text-white shrink-0"
          title="\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442">\u{1F441}</button>

        <button id="btn-confirm"
          class="hidden text-xl px-4 py-3 rounded-xl bg-green-700 hover:bg-green-600 border-0 cursor-pointer font-bold text-white shrink-0"
          title="\u0417\u0430\u0441\u0447\u0438\u0442\u0430\u0442\u044C">\u2705</button>

        <button id="btn-skip"
          class="hidden text-xl px-4 py-3 rounded-xl bg-yellow-600 hover:bg-yellow-500 border-0 cursor-pointer text-white shrink-0"
          title="\u041F\u0440\u043E\u043F\u0443\u0441\u0442\u0438\u0442\u044C">\u23E9</button>

        <button id="btn-back"
          class="text-xl px-4 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 border-0 cursor-pointer text-white shrink-0"
          title="\u041D\u0430\u0437\u0430\u0434 \u043A \u043F\u043E\u043B\u044E">\u2B05</button>
      </div>
    </div>
  `,o.fen&&mo(e.querySelector("#cg-wrap"),o.fen),Vs(e),ta(e,o.value),ra(M.timerSecs,e),nt?.abort(),nt=new AbortController,document.addEventListener("keydown",s=>{(s.key==="l"||s.key==="L"||s.key==="\u0434"||s.key==="\u0414")&&na(e)},{signal:nt.signal})}function Vs(e){let t=e.querySelector("#player-btns");M.players.forEach((r,n)=>{let o=document.createElement("button");o.className="player-btn",o.dataset.idx=String(n),o.textContent=r.name,o.addEventListener("click",()=>Js(n,e)),t.appendChild(o)})}function Js(e,t){ue||(pe.has(e)?pe.delete(e):pe.add(e),Ys(t),Xs(t),ea(t))}function Ys(e){e.querySelectorAll("#player-btns button").forEach(t=>{let r=Number(t.dataset.idx);pe.has(r)?(t.style.background="#059669",t.style.borderColor="#34d399",t.style.boxShadow="0 0 0 3px rgba(52,211,153,0.35)"):(t.style.background="",t.style.borderColor="",t.style.boxShadow="")})}function Xs(e){let t=e.querySelector("#hint");if(pe.size===0)t.textContent="\u041D\u0430\u0436\u043C\u0438 \u043D\u0430 \u0438\u0433\u0440\u043E\u043A\u0430 \u2014 \u0435\u043C\u0443 \u043D\u0430\u0447\u0438\u0441\u043B\u044F\u0442\u0441\u044F \u043E\u0447\u043A\u0438";else{let r=[...pe].map(n=>M.players[n].name).join(", ");t.textContent=`\u041E\u0447\u043A\u0438 \u043F\u043E\u043B\u0443\u0447\u0430\u0442: ${r}`,t.style.color="#34d399"}}function ea(e){e.querySelector("#btn-confirm").classList.toggle("hidden",pe.size===0)}function ta(e,t){e.querySelector("#btn-show-answer").addEventListener("click",()=>{ue||wo(e)}),e.querySelector("#btn-confirm").addEventListener("click",()=>{ue||pe.size===0||(Ie(),pe.forEach(r=>{M.players[r].score+=t}),xo(),kr(),L("game-board"))}),e.querySelector("#btn-skip").addEventListener("click",()=>{ue||(Ie(),xo(),kr(),L("game-board"))}),e.querySelector("#btn-back").addEventListener("click",()=>{ue||(Ie(),kr(),L("game-board"))})}function wo(e){Pr=!0,e.querySelector("#answer-block").classList.remove("hidden"),e.querySelector("#btn-show-answer").classList.add("hidden"),e.querySelector("#btn-skip").classList.remove("hidden"),Ie()}function ra(e,t){if(Ie(),e<=0)return;Pe=e;let r=t.querySelector("#q-timer");r.classList.remove("hidden"),r.style.color="#ffd600",r.textContent=vo(Pe),Lt=setInterval(()=>{Pe--,r.textContent=Pe>0?vo(Pe):"\u23F0",Pe<=5&&Pe>0&&(r.style.color="#f87171"),Pe<=0&&(Ie(),!Pr&&document.contains(t)&&wo(t))},1e3)}function Ie(){Lt!==null&&(clearInterval(Lt),Lt=null)}function vo(e){let t=Math.floor(e/60),r=e%60;return t>0?`${t}:${String(r).padStart(2,"0")}`:String(e)}function na(e){ue=!ue,e.querySelector("#lock-badge").classList.toggle("hidden",!ue),["#btn-show-answer","#btn-confirm","#btn-skip","#btn-back","#player-btns"].forEach(r=>{let n=e.querySelector(r);n&&(n.style.opacity=ue?"0.4":"1")})}function xo(){if(!M?.cur)return;let e=`${M.cur.catIdx}-${M.cur.qIdx}`;M.answered.add(e),M.cur=null,ct(M);let t=M.pack.categories.reduce((r,n)=>r+n.questions.length,0);M.answered.size>=t&&L("results")}function kr(){Ie(),nt?.abort(),nt=null}function ko(e){M?.id&&lt(M.id);let t=(M?.players??[]).slice().sort((n,o)=>o.score-n.score),r=t[0]?.score??0;e.innerHTML=`
    <div class="flex flex-col items-center justify-center min-h-screen p-8">
      <h2 class="font-black text-yellow-400 mb-8" style="font-size:2.5rem">\u0418\u0442\u043E\u0433\u0438 \u0438\u0433\u0440\u044B</h2>

      <div class="flex flex-col gap-3 mb-8 w-full" style="max-width:420px">
        ${t.map((n,o)=>{let i=n.score===r&&n.score>0;return`
            <div class="flex items-center gap-4 rounded-xl px-5 py-4"
                 style="background:${i?"#1e3a22":"#1f2937"};
                        ${i?"border:1px solid #16a34a":""}">
              <span style="font-size:1.8rem;min-width:2rem">${i?"\u{1F451}":o===0?"":o===1?"\u{1F948}":o===2?"\u{1F949}":""}</span>
              <span class="flex-1 font-semibold" style="font-size:1.1rem">${q(n.name)}</span>
              <span class="font-black" style="font-size:1.4rem;color:${n.score>=0?"#ffd600":"#f87171"}">
                ${n.score}
              </span>
            </div>
          `}).join("")}
      </div>

      <div class="flex gap-3 flex-wrap justify-center">
        <button id="btn-restart"
          class="px-7 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl border-0
                 text-white font-bold text-base cursor-pointer transition-colors">
          \u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430
        </button>
        <button id="btn-home"
          class="px-7 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl border-0
                 text-white font-bold text-base cursor-pointer transition-colors">
          \u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E
        </button>
      </div>
    </div>
  `,e.querySelector("#btn-restart").addEventListener("click",()=>L("setup")),e.querySelector("#btn-home").addEventListener("click",()=>L("home"))}var T=Po(),re=-1;function Po(){return{title:"",categories:[{name:"",questions:[{value:100,question:"",answer:""}]}]}}function _o(e){Tt(e)}function Tt(e){let t=oe();e.innerHTML=`
    <div class="min-h-screen p-6" style="max-width:820px;margin:0 auto">

      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</h2>
        <button id="btn-back"
          class="text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer">
          \u2190 \u041D\u0430\u0437\u0430\u0434
        </button>
      </div>

      <div class="flex gap-3 mb-6 flex-wrap">
        <button id="btn-new-pack"
          class="px-4 py-2.5 bg-blue-600 hover:bg-blue-500 rounded-xl border-0 text-white
                 font-bold text-sm cursor-pointer transition-colors">
          + \u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440
        </button>
        <button id="btn-import-list"
          class="px-4 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-xl border-0 text-white
                 text-sm cursor-pointer transition-colors">
          \u0418\u043C\u043F\u043E\u0440\u0442 JSON
        </button>
        <input type="file" id="file-input-list" accept=".json" class="hidden" />
      </div>

      <div id="pack-list" class="space-y-2">
        ${t.length===0?`<p class="text-gray-500 text-center py-8">
               \u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D\u043D\u044B\u0445 \u043D\u0430\u0431\u043E\u0440\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043D\u043E\u0432\u044B\u0439 \u0438\u043B\u0438 \u0438\u043C\u043F\u043E\u0440\u0442\u0438\u0440\u0443\u0439\u0442\u0435 JSON.
             </p>`:t.map((r,n)=>`
              <div class="bg-gray-800 rounded-xl p-4 flex items-center justify-between gap-4">
                <div class="min-w-0">
                  <div class="font-bold text-base truncate">${q(r.title||"\u0411\u0435\u0437 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F")}</div>
                  <div class="text-gray-400 text-sm">
                    ${r.categories.length} \u043A\u0430\u0442. /
                    ${r.categories.reduce((o,i)=>o+i.questions.length,0)} \u0432\u043E\u043F\u0440.
                  </div>
                </div>
                <div class="flex gap-2 shrink-0">
                  <button data-edit="${n}"
                    class="bg-blue-600 hover:bg-blue-500 px-3 py-2 rounded-lg text-sm
                           border-0 cursor-pointer text-white transition-colors">\u0420\u0435\u0434.</button>
                  <button data-export="${n}"
                    class="bg-gray-600 hover:bg-gray-500 px-3 py-2 rounded-lg text-sm
                           border-0 cursor-pointer text-white transition-colors">JSON</button>
                  <button data-del="${n}"
                    class="bg-red-700/80 hover:bg-red-600 px-3 py-2 rounded-lg text-sm
                           border-0 cursor-pointer text-white transition-colors">\u0423\u0434.</button>
                </div>
              </div>
            `).join("")}
      </div>
    </div>
  `,e.querySelector("#btn-back").addEventListener("click",()=>L("home")),e.querySelector("#btn-new-pack").addEventListener("click",()=>{T=Po(),re=-1,_r(e)}),e.querySelector("#btn-import-list").addEventListener("click",()=>{e.querySelector("#file-input-list").click()}),e.querySelector("#file-input-list").addEventListener("change",r=>{let n=r.target.files?.[0];if(!n)return;let o=new FileReader;o.onload=()=>{try{let i=JSON.parse(o.result);if(!i.title||!Array.isArray(i.categories))throw new Error("\u041D\u0435\u0442 \u043F\u043E\u043B\u0435\u0439 title/categories");T=i,re=-1,_r(e)}catch(i){Qe(`\u041E\u0448\u0438\u0431\u043A\u0430 JSON: ${i.message}`)}},o.readAsText(n),r.target.value=""}),e.querySelectorAll("[data-edit]").forEach(r=>{r.addEventListener("click",()=>{let n=+r.dataset.edit;T=JSON.parse(JSON.stringify(oe()[n])),re=n,_r(e)})}),e.querySelectorAll("[data-export]").forEach(r=>{r.addEventListener("click",()=>{let n=oe()[+r.dataset.export];So(n)})}),e.querySelectorAll("[data-del]").forEach(r=>{r.addEventListener("click",()=>{be("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440?",()=>{Vr(+r.dataset.del),Tt(e)},{confirmLabel:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})})})}function _r(e){e.innerHTML=`
    <div class="min-h-screen p-6" style="max-width:820px;margin:0 auto">

      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">
          ${re>=0?"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430":"\u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440"}
        </h2>
        <button id="btn-to-list"
          class="text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer">
          \u2190 \u041A \u0441\u043F\u0438\u0441\u043A\u0443
        </button>
      </div>

      <!-- Pack title -->
      <div class="mb-4">
        <label class="block text-sm text-gray-400 mb-1">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430</label>
        <input id="pack-title" type="text" value="${q(T.title)}"
          class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white
                 focus:border-blue-500 focus:outline-none"
          placeholder="\u041D\u0430\u043F\u0440\u0438\u043C\u0435\u0440: \u0428\u0430\u0445\u043C\u0430\u0442\u043D\u044B\u0435 \u0437\u0430\u0434\u0430\u0447\u0438" />
      </div>

      <!-- Categories -->
      <div id="categories-container" class="space-y-4 mb-4"></div>

      <!-- Add category -->
      <button id="btn-add-cat"
        class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg border-0 text-white
               text-sm cursor-pointer mb-6 transition-colors">
        + \u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F
      </button>

      <!-- Bottom actions -->
      <div class="flex gap-3 pt-4 border-t border-gray-800 flex-wrap">
        <button id="btn-save"
          class="px-6 py-3 bg-emerald-600 hover:bg-emerald-500 rounded-xl border-0 text-white
                 font-bold cursor-pointer transition-colors">
          \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C
        </button>
        <button id="btn-play"
          class="px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-xl border-0 text-white
                 font-bold cursor-pointer transition-colors">
          \u25B6 \u0418\u0433\u0440\u0430\u0442\u044C
        </button>
        <button id="btn-export-pack"
          class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl border-0 text-white
                 font-bold cursor-pointer transition-colors">
          \u0421\u043A\u0430\u0447\u0430\u0442\u044C JSON
        </button>
        <button id="btn-cancel"
          class="px-6 py-3 bg-gray-800 hover:bg-gray-700 rounded-xl border-0 text-white
                 cursor-pointer transition-colors">
          \u041E\u0442\u043C\u0435\u043D\u0430
        </button>
      </div>

      <div id="status" class="mt-3 text-sm"></div>
    </div>
  `,_e(e),e.querySelector("#pack-title").addEventListener("input",t=>{T.title=t.target.value}),e.querySelector("#btn-to-list").addEventListener("click",()=>Tt(e)),e.querySelector("#btn-add-cat").addEventListener("click",()=>{T.categories.push({name:"",questions:[{value:100,question:"",answer:""}]}),_e(e)}),e.querySelector("#btn-save").addEventListener("click",()=>{let t=Sr(T);if(t){Mt(e,`\u2717 ${t}`,!1);return}Kt(T,re>=0?re:void 0),re<0&&(re=oe().length-1),Mt(e,"\u2713 \u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043E",!0)}),e.querySelector("#btn-play").addEventListener("click",()=>{let t=Sr(T);if(t){Mt(e,`\u2717 ${t}`,!1);return}Kt(T,re>=0?re:void 0);let r=oe(),n=re>=0?re:r.length-1;Ue(Jr+n),L("setup")}),e.querySelector("#btn-export-pack").addEventListener("click",()=>{let t=Sr(T);if(t){Mt(e,`\u2717 ${t}`,!1);return}So(T)}),e.querySelector("#btn-cancel").addEventListener("click",()=>Tt(e))}function _e(e){let t=e.querySelector("#categories-container");t.innerHTML=T.categories.map((r,n)=>oa(r,n)).join(""),sa(e)}function oa(e,t){return`
    <div class="rounded-xl p-4 space-y-3"
         style="background:rgba(31,41,55,0.5);border:1px solid rgba(55,65,81,0.5)">

      <div class="flex items-center gap-3">
        <input data-cat-name="${t}" type="text" value="${q(e.name)}"
          class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white font-bold
                 focus:border-blue-500 focus:outline-none"
          placeholder="\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438" />
        <button data-remove-cat="${t}"
          class="text-red-400 hover:text-red-300 bg-transparent border-0 cursor-pointer
                 text-sm transition-colors whitespace-nowrap">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</button>
      </div>

      <div data-questions="${t}" class="space-y-2">
        ${e.questions.map((r,n)=>ia(e,r,t,n)).join("")}
      </div>

      <button data-add-q="${t}"
        class="text-sm text-blue-400 hover:text-blue-300 bg-transparent border-0
               cursor-pointer transition-colors">+ \u0412\u043E\u043F\u0440\u043E\u0441</button>
    </div>
  `}function ia(e,t,r,n){return`
    <div class="rounded-lg p-3 space-y-2" style="background:rgba(17,24,39,0.6)">
      <div class="flex gap-2 items-center">
        <div class="flex flex-col gap-0.5 shrink-0">
          <button data-move-up="${r}-${n}" ${n===0?"disabled":""}
            class="text-gray-400 hover:text-white text-xs leading-none px-1
                   disabled:opacity-20 cursor-pointer bg-transparent border-0 transition-colors">\u25B2</button>
          <button data-move-down="${r}-${n}" ${n===e.questions.length-1?"disabled":""}
            class="text-gray-400 hover:text-white text-xs leading-none px-1
                   disabled:opacity-20 cursor-pointer bg-transparent border-0 transition-colors">\u25BC</button>
        </div>
        <input data-q-value="${r}-${n}" type="number" value="${t.value}" step="100" min="0"
          class="w-24 bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-yellow-400
                 text-center font-bold focus:border-blue-500 focus:outline-none" />
        <input data-q-question="${r}-${n}" type="text" value="${q(t.question)}"
          class="flex-1 bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-white
                 focus:border-blue-500 focus:outline-none"
          placeholder="\u0412\u043E\u043F\u0440\u043E\u0441" />
        <button data-duplicate-q="${r}-${n}"
          class="text-blue-400 hover:text-blue-300 bg-transparent border-0 cursor-pointer
                 text-xs shrink-0 transition-colors" title="\u0414\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u0442\u044C">\u29C9</button>
        <button data-remove-q="${r}-${n}"
          class="text-red-400 hover:text-red-300 bg-transparent border-0 cursor-pointer
                 text-xs shrink-0 transition-colors">\u2715</button>
      </div>
      <input data-q-answer="${r}-${n}" type="text" value="${q(t.answer)}"
        class="w-full bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-emerald-400
               focus:border-blue-500 focus:outline-none"
        placeholder="\u041E\u0442\u0432\u0435\u0442" />
      <input data-q-image="${r}-${n}" type="text" value="${q(t.image??"")}"
        class="w-full bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-blue-400 text-sm
               focus:border-blue-500 focus:outline-none"
        placeholder="URL \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438 (https://...)" />
      <input data-q-fen="${r}-${n}" type="text" value="${q(t.fen??"")}"
        class="w-full bg-gray-800 border border-gray-700 rounded px-2 py-1.5 text-purple-400
               text-sm font-mono focus:border-blue-500 focus:outline-none"
        placeholder="FEN \u043F\u043E\u0437\u0438\u0446\u0438\u0438 (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)" />
    </div>
  `}function sa(e){let t=e.querySelector("#categories-container");t.querySelectorAll("[data-cat-name]").forEach(r=>{r.addEventListener("input",()=>{T.categories[+r.dataset.catName].name=r.value})}),t.querySelectorAll("[data-remove-cat]").forEach(r=>{r.addEventListener("click",()=>{be("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E?",()=>{T.categories.splice(+r.dataset.removeCat,1),_e(e)},{confirmLabel:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})})}),t.querySelectorAll("[data-q-value]").forEach(r=>{r.addEventListener("input",()=>{let[n,o]=r.dataset.qValue.split("-").map(Number);T.categories[n].questions[o].value=Number(r.value)||0})}),t.querySelectorAll("[data-q-question]").forEach(r=>{r.addEventListener("input",()=>{let[n,o]=r.dataset.qQuestion.split("-").map(Number);T.categories[n].questions[o].question=r.value})}),t.querySelectorAll("[data-q-answer]").forEach(r=>{r.addEventListener("input",()=>{let[n,o]=r.dataset.qAnswer.split("-").map(Number);T.categories[n].questions[o].answer=r.value})}),t.querySelectorAll("[data-q-image]").forEach(r=>{r.addEventListener("input",()=>{let[n,o]=r.dataset.qImage.split("-").map(Number);T.categories[n].questions[o].image=r.value.trim()||void 0})}),t.querySelectorAll("[data-q-fen]").forEach(r=>{r.addEventListener("input",()=>{let[n,o]=r.dataset.qFen.split("-").map(Number);T.categories[n].questions[o].fen=r.value.trim()||void 0})}),t.querySelectorAll("[data-move-up]").forEach(r=>{r.addEventListener("click",()=>{let[n,o]=r.dataset.moveUp.split("-").map(Number);if(o===0)return;let i=T.categories[n].questions;[i[o-1],i[o]]=[i[o],i[o-1]],_e(e)})}),t.querySelectorAll("[data-move-down]").forEach(r=>{r.addEventListener("click",()=>{let[n,o]=r.dataset.moveDown.split("-").map(Number),i=T.categories[n].questions;o>=i.length-1||([i[o],i[o+1]]=[i[o+1],i[o]],_e(e))})}),t.querySelectorAll("[data-duplicate-q]").forEach(r=>{r.addEventListener("click",()=>{let[n,o]=r.dataset.duplicateQ.split("-").map(Number),i=T.categories[n].questions;i.splice(o+1,0,JSON.parse(JSON.stringify(i[o]))),_e(e)})}),t.querySelectorAll("[data-remove-q]").forEach(r=>{r.addEventListener("click",()=>{let[n,o]=r.dataset.removeQ.split("-").map(Number),i=T.categories[n].questions,s=()=>{i.splice(o,1),_e(e)};i.length<=1?be("\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439 \u0432\u043E\u043F\u0440\u043E\u0441. \u0423\u0434\u0430\u043B\u0438\u0442\u044C?",s,{confirmLabel:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"}):s()})}),t.querySelectorAll("[data-add-q]").forEach(r=>{r.addEventListener("click",()=>{let n=+r.dataset.addQ,o=T.categories[n].questions,i=o.at(-1)?.value??0;o.push({value:i+100,question:"",answer:""}),_e(e)})})}function Sr(e){if(!e.title.trim())return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430";if(!e.categories.length)return"\u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B \u043E\u0434\u043D\u0443 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E";for(let[t,r]of e.categories.entries()){if(!r.name.trim())return`\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F ${t+1}: \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435`;if(!r.questions.length)return`"${r.name}": \u0434\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B \u043E\u0434\u0438\u043D \u0432\u043E\u043F\u0440\u043E\u0441`;for(let[n,o]of r.questions.entries()){if(!o.question.trim())return`"${r.name}"[${n+1}]: \u043D\u0435\u0442 \u0442\u0435\u043A\u0441\u0442\u0430 \u0432\u043E\u043F\u0440\u043E\u0441\u0430`;if(!o.answer.trim())return`"${r.name}"[${n+1}]: \u043D\u0435\u0442 \u043E\u0442\u0432\u0435\u0442\u0430`;if(o.fen&&!bo(o.fen))return`"${r.name}"[${n+1}]: \u043D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u044B\u0439 FEN`}}return null}function Mt(e,t,r){let n=e.querySelector("#status");n.textContent=t,n.style.color=r?"#4ade80":"#f87171"}function So(e){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=`${e.title||"pack"}.json`,r.click()}var Eo=document.getElementById("app");if(!Eo)throw new Error("#app element not found");var aa={home:Dt,setup:Ft,"game-board":sn,question:yo,results:ko,editor:_o};Wr(Eo,aa);L("home");})();
/*! Bundled license information:

chess.js/dist/esm/chess.js:
  (**
   * @license
   * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice,
   *    this list of conditions and the following disclaimer.
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   *    this list of conditions and the following disclaimer in the documentation
   *    and/or other materials provided with the distribution.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
   * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
   * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
   * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
   * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
   * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
   * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   * POSSIBILITY OF SUCH DAMAGE.
   *)
*/
//# sourceMappingURL=bundle.js.map
